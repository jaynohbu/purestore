function config($stateProvider,$urlRouterProvider,toastrConfig,$authProvider,tooltipsConfProvider,tmhDynamicLocaleProvider,$httpProvider,$translateProvider,LOCALES){$httpProvider.defaults.useXDomain=!0,$httpProvider.interceptors.push("httpRequestInterceptor"),$translateProvider.useStaticFilesLoader({prefix:"resources/locale-",suffix:".json"}),$translateProvider.preferredLanguage(LOCALES.preferredLocale);var preferredLocale=function(){$translateProvider.determinePreferredLanguage();var userlang_country=$translateProvider.preferredLanguage().split("_");for(key in LOCALES.locales)if((lang_country=key.split("-"))[0]==userlang_country[0]&&lang_country[1]==userlang_country[1])return key;for(key in LOCALES.locales){var lang_country;if((lang_country=key.split("-"))[0]==userlang_country[0])return key}}();$translateProvider.preferredLanguage(preferredLocale),tooltipsConfProvider.configure({speed:"fast"}),$urlRouterProvider.otherwise("/login_oms"),$apiBaseDomain="https://apigateway.mentor.edriving.com",$apiCommonDb="https://vrm-cdb-api.vrm-mentor.com/api",$apiFleetInternal="http://fleet-provision.mentor.internal:8080/api",$apiBaseUrl=$apiBaseDomain,$authProvider.httpInterceptor=!0,$authProvider.loginOnSignup=!0,$authProvider.baseUrl=$apiBaseUrl,$authProvider.loginUrl="/v1/auth",$authProvider.signupUrl="/users",$authProvider.unlinkUrl="/auth/unlink",$authProvider.tokenName="token",$authProvider.tokenPrefix="satellizer",$authProvider.authHeader="Authorization",$authProvider.authToken="Bearer",$authProvider.storageType="localStorage",angular.extend(toastrConfig,{positionClass:"toast-top-full-width",target:"body"}),$stateProvider.state("login_oms",{url:"/login_oms?email",templateUrl:"views/login_oms.html",controller:"LoginOmsCtrl",data:{pageTitle:"Login",specialClass:"gray-bg login"}}).state("login_csr",{url:"/login_csr?email",templateUrl:"views/login_csr.html",controller:"LoginCsrCtrl",data:{pageTitle:"Login",specialClass:"gray-bg login"}}).state("login_csr_cognito",{url:"/login_csr_cognito?code",controller:"LoginCsrCognitoCtrl",data:{pageTitle:"Login",specialClass:"gray-bg login"}}).state("password_reset",{url:"/password_reset?email",templateUrl:"views/password_reset.html",controller:"PasswordResetCtrl",data:{pageTitle:"Reset Password",specialClass:"login-page",requiredLogin:!1}}).state("password_update",{url:"/password_update?token",templateUrl:"views/password_update.html",controller:"PasswordUpdateCtrl",data:{pageTitle:"Reset Password",specialClass:"login-page",requiredLogin:!1}}).state("fleet_activation",{url:"/fleet_activation?token",templateUrl:"views/fleet_user_activation.html",controller:"FleetUserActivationCtrl",data:{pageTitle:"Welcome to Mentor for Business",specialClass:"login-page",requiredLogin:!1}}).state("logout",{url:"/logout?loginUrl",template:null,controller:"LogoutCtrl"}).state("driver",{abstract:!0,url:"/driver",templateUrl:"views/layout/driver/content.html"}).state("login_fleet_amzl",{url:"/login_fleet_amzl?email",templateUrl:"views/fleet_amzl_login.html",controller:"FleetLoginCtrl",data:{pageTitle:"Login",specialClass:"login-page"}}).state("fleet_amzl",{abstract:!0,controller:"FleetMainCtrl",url:"/fleet_amzl",templateUrl:"views/layout/manager_amzl/content.html",data:{requiredLogin:!0}}).state("fleet_amzl.report-daily",{url:"/fleet-report-period/amzl/daily",controller:"FleetReportOnPeriodCtrl",templateUrl:"views/fleet_report_on_period.html",params:{client:"amzl",period:"daily"},data:{pageTitle:"Driver Performance",requiredLogin:!1,specialClass:"fleet-manager fleet-weekly-report"}}).state("fleet_amzl.report-weekly",{url:"/fleet-report-period/amzl/weekly",controller:"FleetReportOnPeriodCtrl",templateUrl:"views/fleet_report_on_period.html",params:{client:"amzl",period:"weekly"},data:{pageTitle:"Driver Performance",requiredLogin:!1,specialClass:"fleet-manager fleet-weekly-report"}}).state("fleet_amzl.report-monthly",{url:"/fleet-report-period/amzl/monthly",controller:"FleetReportOnPeriodCtrl",templateUrl:"views/fleet_report_on_period.html",params:{client:"amzl",period:"monthly"},data:{pageTitle:"Driver Performance",requiredLogin:!1,specialClass:"fleet-manager fleet-monthly-report"}}).state("fleet_amzl.report-trend",{url:"/fleet-report-trend/:companyId/:groupId/:userId",controller:"FleetReportTrendCtrl",templateUrl:"views/fleet_report_trend.html",data:{pageTitle:"Performance Trend",requiredLogin:!1,specialClass:"fleet-manager fleet-monthly-report"}}).state("fleet_amzl.report-group",{url:"/fleet-report-period/amzl/group",controller:"FleetReportOnPeriodGroupCtrl",templateUrl:"views/fleet_report_on_period_group.html",params:{client:"amzl",period:"weekly"},data:{pageTitle:"Station Performance",requiredLogin:!1,specialClass:"fleet-manager fleet-weekly-report"}}).state("fleet_amzl.report-grid-group",{url:"/fleet-report-grid-group",controller:"FleetReportGridGroupsCtrl",templateUrl:"views/fleet_report_grid_group.html",data:{pageTitle:"Station Performance",requiredLogin:!1}}).state("fleet_amzl.report-dvcr",{url:"/fleet-report-dvcr",controller:"FleetDvcrReportCtrl",templateUrl:"views/fleet_report_dvcr.html",params:{client:"amzl",period:"daily"},data:{pageTitle:"DVCR",requiredLogin:!1,specialClass:"fleet-manager fleet-weekly-report"}}).state("fleet_amzl.report-dvcr-audit",{url:"/fleet-report-dvcr-audit",controller:"FleetDvcrAuditReportCtrl",templateUrl:"views/fleet_report_dvcr_audit.html",params:{client:"amzl",period:"daily"},data:{pageTitle:"DVCR",requiredLogin:!1,specialClass:"fleet-manager fleet-weekly-report"}}).state("fleet_amzl.setupUsers",{url:"/newusers",controller:"FleetProvisionNewUserCtrl",templateUrl:"views/fleet_provision_new_user.html",data:{pageTitle:"Add Driver",requiredLogin:!1,specialClass:"fleet-manager fleet-weekly-report"}}).state("fleet_amzl.group",{url:"/fleet-group",controller:"FleetGroupCtrl",templateUrl:"views/fleet_group.html",data:{pageTitle:"Stations",requiredLogin:!1,specialClass:"fleet-manager fleet-weekly-report"}}).state("fleet_amzl.provisionWizard",{url:"/fleet-provisionwizard",controller:"FleetProvisionWizardCtrl",templateUrl:"views/fleet_provision_wizard.html",data:{pageTitle:"Provision",requiredLogin:!1,specialClass:"fleet-manager fleet-weekly-report"}}).state("fleet_amzl.provisionWizard.groupNew",{url:"/fleet-provisionwizard-newgroup",controller:"newEditGroupCtrl",templateUrl:"views/fleet_provision_group_new_edit.html",data:{pageTitle:"My Account",requiredLogin:!1,specialClass:"fleet-manager fleet-weekly-report"}}).state("fleet_amzl.provisionWizard.groupEdit",{url:"/fleet-provisionwizard-editgroup/:id",controller:"newEditGroupCtrl",templateUrl:"views/fleet_provision_group_new_edit.html",data:{pageTitle:"My Account",requiredLogin:!1}}).state("fleet_amzl.userSignup",{url:"/userSignup",controller:"userSignupCtrl",templateUrl:"views/csr_create_user.html",data:{pageTitle:"Add New User",requiredLogin:!1,specialClass:"fleet-manager fleet-weekly-report"}}).state("fleet_amzl.users",{url:"/fleet-users",controller:"FleetAccountCtrl",templateUrl:"views/fleet_users.html",data:{pageTitle:"Users",requiredLogin:!0,specialClass:"fleet-manager fleet-weekly-report"}}).state("fleet_amzl.companyUserPage",{url:"/users/:companyUserId",controller:"companyUserUpdateCtrl",templateUrl:"views/fleet_userUpdate.html",data:{pageTitle:"Edit User",requiredLogin:!1,specialClass:"fleet-manager fleet-weekly-report"}}).state("fleet_amzl.manager-resource",{url:"/resources",controller:"FleetResourcesAmzlCtrl",templateUrl:"views/fleet_resources.html",data:{pageTitle:"Resource Library",requiredLogin:!0,specialClass:"fleet-manager"}}).state("fleet_amzl.analytics",{url:"/analytics",controller:"FleetAnalyticsCtrl",controllerAs:"$ctrl",templateUrl:"views/fleet_analytics.html",params:{client:"fleet_amzl"},data:{pageTitle:"Analytics",requiredLogin:!0,specialClass:"fleet-manager"}}).state("fleet_amzl.analytics__details",{url:"/analytics/details",controller:"FleetAnalytics__detailsCtrl",controllerAs:"$ctrl",templateUrl:"views/fleet_analytics__details.html",params:{client:"fleet_amzl",dsp:null,value:null,startDate:null,endDate:null},data:{pageTitle:"Analytics",requiredLogin:!0,specialClass:"fleet-manager"}}).state("login_fleet",{url:"/login_fleet?email",templateUrl:"views/fleet_login.html",controller:"FleetLoginCtrl",data:{pageTitle:"Login",specialClass:"login-page"}}).state("fleet",{abstract:!0,controller:"FleetMainCtrl",url:"/fleet",templateUrl:"views/layout/manager/content.html",data:{requiredLogin:!0,specialClass:"fleet-manager"}}).state("fleet.account",{url:"/fleetaccount",controller:"FleetAccountCtrl",templateUrl:"views/fleet_account.html",data:{pageTitle:"Account",requiredLogin:!1}}).state("userActivationSuccess",{url:"/AccountActivationSuccess",templateUrl:"views/fleet_user_activation_success.html",data:{specialClass:"body-bg"}}).state("userActivationFailed",{url:"/AccountActivationFailed",templateUrl:"views/fleet_user_activation_error.html",data:{specialClass:"body-bg"}}).state("fleet.report-trend",{url:"/fleet-report-trend/:companyId/:groupId/:userId",controller:"FleetReportTrendCtrl",templateUrl:"views/fleet_report_trend.html",data:{pageTitle:"Trend",requiredLogin:!1}}).state("fleet.report-grid",{url:"/fleet-report-grid",controller:"FleetReportGridCtrl",templateUrl:"views/fleet_report_grid.html",data:{pageTitle:"Driver Performance",requiredLogin:!1}}).state("fleet.report-grid2",{url:"/fleet-report-grid2",controller:"FleetReportGrid2Ctrl",templateUrl:"views/fleet_report_grid2.html",data:{pageTitle:"Driver Performance",requiredLogin:!1,specialClass:"fleet-manager fleet-weekly-report"}}).state("fleet.report-weekly",{url:"/fleet-report-weekly",controller:"FleetReportOnPeriodCtrl",templateUrl:"views/fleet_report_on_period.html",data:{pageTitle:"Weekly Report",requiredLogin:!0,specialClass:"fleet-manager fleet-weekly-report"}}).state("fleet.report-group",{url:"/fleet-report-period/group",controller:"FleetReportOnPeriodGroupCtrl",templateUrl:"views/fleet_report_on_period_group.html",params:{period:"weekly"},data:{pageTitle:"Drivers",requiredLogin:!1,specialClass:"fleet-manager fleet-weekly-report"}}).state("fleet.report-period-client",{url:"/fleet-report-period/:client/:period",controller:"FleetReportOnPeriodCtrl",templateUrl:"views/fleet_report_on_period.html",data:{pageTitle:"Report",requiredLogin:!0,specialClass:"fleet-manager fleet-period-report"}}).state("fleet.report-period",{url:"/fleet-report-period",controller:"FleetReportOnPeriodCtrl",templateUrl:"views/fleet_report_on_period.html",data:{pageTitle:"Report",requiredLogin:!0,specialClass:"fleet-manager fleet-period-report"}}).state("fleet.manager-resource",{url:"/resources",controller:"FleetResourcesCtrl",templateUrl:"views/fleet_resources.html",data:{pageTitle:"Resource Library",requiredLogin:!0}}).state("fleet.users",{url:"/fleet-users",controller:"FleetAccountCtrl",templateUrl:"views/fleet_users.html",data:{pageTitle:"Users",requiredLogin:!0}}).state("fleet.vouchers",{url:"/vouchers",templateUrl:"views/fleet_vouchers.html",data:{pageTitle:"Vouchers",requiredLogin:!0}}).state("fleet.userActivities",{url:"/user-log/:userId",controller:"activitiesCtrl",templateUrl:"views/fleet_user_log.html",data:{pageTitle:"userActivities",requiredLogin:!1}}).state("fleet.companyUserPage",{url:"/users/:companyUserId",controller:"companyUserUpdateCtrl",templateUrl:"views/fleet_userUpdate.html",data:{pageTitle:"User Setting",requiredLogin:!1}}).state("fleet.userSignup",{url:"/userSignup",controller:"userSignupCtrl",templateUrl:"views/csr_create_user.html",data:{pageTitle:"New User",requiredLogin:!1}}).state("fleet.setupUsers",{url:"/newusers",controller:"FleetProvisionNewUserCtrl",templateUrl:"views/fleet_provision_new_user.html",data:{pageTitle:"Add Driver",requiredLogin:!1}}).state("fleet.group",{url:"/fleet-group",controller:"FleetGroupCtrl",templateUrl:"views/fleet_group.html",data:{pageTitle:"Groups",requiredLogin:!1}}).state("fleet.provisionWizard",{url:"/fleet-provisionwizard",controller:"FleetProvisionWizardCtrl",templateUrl:"views/fleet_provision_wizard.html",data:{pageTitle:"Provision",requiredLogin:!1}}).state("fleet.provisionWizard.orders",{url:"/fleet-provisionwizard-orders",controller:"FleetAccountCtrl",templateUrl:"views/fleet_account.html",data:{pageTitle:"Account",requiredLogin:!1}}).state("fleet.provisionWizard.company",{url:"/company",controller:"FleetCompanySummaryCtrl",templateUrl:"views/fleet_company_summary.html",data:{pageTitle:"Company",requiredLogin:!1}}).state("fleet.provisionWizard.groups",{url:"/fleet-provisionwizard-group",controller:"FleetGroupCtrl",templateUrl:"views/fleet_group.html",data:{pageTitle:"My Account",requiredLogin:!1}}).state("fleet.provisionWizard.groupNew",{url:"/fleet-provisionwizard-newgroup",controller:"newEditGroupCtrl",templateUrl:"views/fleet_provision_group_new_edit.html",data:{pageTitle:"My Account",requiredLogin:!1}}).state("fleet.provisionWizard.groupEdit",{url:"/fleet-provisionwizard-editgroup/:id",controller:"newEditGroupCtrl",templateUrl:"views/fleet_provision_group_new_edit.html",data:{pageTitle:"My Account",requiredLogin:!1}}).state("fleet.provisionWizard.drivers",{url:"/fleet-provisionwizard-driver",controller:"FleetProvisionNewUserCtrl",templateUrl:"views/fleet_provision_new_user.html",data:{pageTitle:"Upload New Users",requiredLogin:!1}}).state("login_fleetdriver",{url:"/login_fleetdriver?email",templateUrl:"views/fleetdriver_login.html",controller:"FleetdriverLoginCtrl",data:{pageTitle:"Login",specialClass:"gray-bg login"}}).state("fleetdriver",{abstract:!0,controller:"FleetdriverMainCtrl",url:"/fleetdriver",templateUrl:"views/layout/fleetdriver/content.html",data:{requiredLogin:!0}}).state("fleetdriver.oms",{url:"/oms",controller:"FleetdriverOmsCtrl",templateUrl:"views/fleetdriver_oms.html",data:{pageTitle:"One More Second",requiredLogin:!0}}).state("fleetdriver.playlist",{url:"/playlist",controller:"playlistCtrl",templateUrl:"views/playlist.html",data:{pageTitle:"Coaching Playlist"},resolve:{loginRequired:loginRequired}}).state("fleetdriver.dashboard",{url:"/dashboard",templateUrl:"views/fleetdriver_dashboard.html",data:{pageTitle:"Dashboard"},resolve:{loginRequired:loginRequired}}).state("fleetdriver.culturepacks",{url:"/culturepacks",controller:"culturepackListCtrl",templateUrl:"views/culturepacks.html",data:{pageTitle:"Culture Pack"},resolve:{loginRequired:loginRequired}}).state("fleetdriver.culturepack",{url:"/culturepacks/:chapterIndex",controller:"culturepackCtrl",templateUrl:"views/culturepack.html",data:{pageTitle:"Culture Pack"},resolve:{loginRequired:loginRequired}}).state("login_distributor",{url:"/login_distributor?noRedirect",templateUrl:"views/distributor_login.html",controller:"LoginDistributorCtrl",data:{pageTitle:"Login",specialClass:"gray-bg login-page"}}).state("login_amzl_cognito",{url:"/login_amzl_cognito?code",controller:"LoginAmzlCognitoCtrl",data:{pageTitle:"Login",specialClass:"gray-bg login"}}).state("distributor",{abstract:!0,controller:"DistributorMainCtrl",url:"/distributor",templateUrl:"views/layout/distributor/content.html",data:{pageTitle:"V2 Accounts",requiredLogin:!0}}).state("distributor.report",{url:"/distributor-report",controller:"DistributorReportCtrl",templateUrl:"views/distributor_report_on_period.html",params:{client:"amzldistributor",period:"weekly"},data:{pageTitle:"Report",requiredLogin:!1,specialClass:"fleet-manager fleet-monthly-report"}}).state("distributor.report-trend",{url:"/fleet-report-trend/:companyId/:groupId/:userId",controller:"FleetReportTrendCtrl",templateUrl:"views/fleet_report_trend.html",data:{pageTitle:"Trend",requiredLogin:!1,specialClass:"fleet-manager fleet-monthly-report"}}).state("distributor.report-dvcr",{url:"/fleet-report-dvcr",controller:"FleetDvcrReportCtrl",templateUrl:"views/fleet_report_dvcr.html",params:{client:"distributor",period:"daily"},data:{pageTitle:"DVCR",requiredLogin:!1,specialClass:"fleet-manager fleet-weekly-report"}}).state("distributor.analytics",{url:"/analytics",controller:"FleetAnalyticsCtrl",controllerAs:"$ctrl",templateUrl:"views/fleet_analytics.html",params:{client:"distributor"},data:{pageTitle:"Analytics",requiredLogin:!0,specialClass:"fleet-manager"}}).state("distributor.analytics__details",{url:"/analytics/details",controller:"FleetAnalytics__detailsCtrl",controllerAs:"$ctrl",templateUrl:"views/fleet_analytics__details.html",params:{client:"distributor",dsp:null,value:null,startDate:null,endDate:null},data:{pageTitle:"Analytics",requiredLogin:!0,specialClass:"fleet-manager"}}).state("csr",{abstract:!0,controller:"CsrMainCtrl",url:"/csr",templateUrl:"views/layout/csr/content.html",data:{pageTitle:"V2 Accounts",requiredLogin:!0}}).state("csr.welcome",{url:"/welcome",templateUrl:"views/csr_welcome.html",data:{pageTitle:"Welcome",requiredLogin:!0}}).state("csr.companies",{url:"/companies",controller:"CsrCompanyListCtrl",templateUrl:"views/csr_company_list.html",data:{pageTitle:"V2 Accounts",requiredLogin:!1}}).state("csr.companies_v1",{url:"/companies_v1",templateUrl:"views/csr_company_list_v1.html",data:{pageTitle:"V1 Accounts",requiredLogin:!1}}).state("csr.search",{url:"/usersearch",controller:"CsrSearchCtrl",templateUrl:"views/csr_user_search.html",data:{pageTitle:"Search User",requiredLogin:!0}}).state("csr.company",{url:"/company",controller:"FleetCompanySummaryCtrl",templateUrl:"views/fleet_company_summary.html",data:{pageTitle:"Company",requiredLogin:!1}}).state("csr.company_v1",{url:"/company_v1",controller:"FleetCompanySummaryCtrl",templateUrl:"views/csr_company_summary_v1.html",data:{pageTitle:"Company",requiredLogin:!1}}).state("csr.users",{url:"/csr-users",controller:"CsrFleetAccountCtrl",templateUrl:"views/csr_users.html",data:{pageTitle:"Users",requiredLogin:!0}}).state("csr.storeTrans",{url:"/fleetStoreTransactions",controller:"CsrFleetStoreTransCtrl",templateUrl:"views/csr_store_trans.html",data:{pageTitle:"Store Trans",requiredLogin:!0}}).state("csr.report-weekly",{url:"/csr-report-weekly",controller:"FleetReportOnPeriodCtrl",params:{client:"amzl",period:"monthly"},templateUrl:"views/fleet_report_on_period.html",data:{pageTitle:"Weekly Report",requiredLogin:!0,specialClass:"fleet-manager fleet-weekly-report"}}).state("csr.report-dvcr",{url:"/csr-report-dvcr",controller:"FleetDvcrReportCtrl",templateUrl:"views/fleet_report_dvcr.html",params:{client:"amzl",period:"daily"},data:{pageTitle:"DVCR",requiredLogin:!1,specialClass:"fleet-manager fleet-weekly-report"}}).state("csr.report-dvcr-audit",{url:"/csr-report-dvcr-audit",controller:"FleetDvcrAuditReportCtrl",templateUrl:"views/fleet_report_dvcr_audit.html",data:{pageTitle:"DVCR",requiredLogin:!1,specialClass:"fleet-manager fleet-weekly-report"}}).state("csr.users_v1",{url:"/fleet-users_v1",controller:"CsrFleetAccountCtrl",templateUrl:"views/csr_users_v1.html",data:{pageTitle:"Users",requiredLogin:!0}}).state("csr.vouchers",{url:"/vouchers",controller:"VoucherCtrl",templateUrl:"views/fleet_vouchers.html",data:{pageTitle:"Vouchers",requiredLogin:!0}}).state("csr.newVouchers",{url:"/newVouchers",controller:"VoucherCtrl",templateUrl:"views/csr_new_vouchers.html",data:{pageTitle:"Vouchers",requiredLogin:!0}}).state("csr.userActivities",{url:"/userActivities/:userId",controller:"activitiesCtrl",templateUrl:"views/fleet_user_log.html",data:{pageTitle:"userActivities",requiredLogin:!1}}).state("csr.companyUserPage",{url:"/companyUsers/:companyUserId",controller:"companyUserUpdateCtrl",templateUrl:"views/fleet_userUpdate.html",data:{pageTitle:"companyUserProfile",requiredLogin:!1}}).state("csr.updateUserEmail",{url:"/updateUserEmail/:companyUserId",controller:"updateUserEmailCtrl",templateUrl:"views/fleet_emailUpdate.html",data:{pageTitle:"Update User Email",requiredLogin:!1}}).state("csr.userSignup",{url:"/userSignup",controller:"userSignupCtrl",templateUrl:"views/csr_create_user.html",data:{pageTitle:"Signup User",requiredLogin:!1}}).state("csr.setupUsers",{url:"/newusers",controller:"FleetProvisionNewUserCtrl",templateUrl:"views/fleet_provision_new_user.html",data:{pageTitle:"Add Driver",requiredLogin:!1}}).state("csr.group",{url:"/csr-group",controller:"FleetGroupCtrl",templateUrl:"views/csr_group.html",data:{pageTitle:"My Account",requiredLogin:!1}}).state("csr.group_v1",{url:"/fleet-group-v1",controller:"FleetGroupCtrl",templateUrl:"views/csr_group_v1.html",data:{pageTitle:"My Account",requiredLogin:!1}}).state("csr.provisionWizard",{url:"/fleet-provisionwizard",controller:"FleetProvisionWizardCtrl",templateUrl:"views/fleet_provision_wizard.html",data:{pageTitle:"Provision",requiredLogin:!1}}).state("csr.provisionWizard.company",{url:"/fleetsignup",controller:"FleetSignupCtrl",templateUrl:"views/csr_create_company.html",data:{pageTitle:"Signup Fleet",requiredLogin:!1}}).state("csr.provisionWizard.companyEdit",{url:"/companyEdit/:companyId",controller:"FleetEditCtrl",templateUrl:"views/csr_edit_company.html",data:{pageTitle:"Edit Company",requiredLogin:!1}}).state("csr.provisionWizard.groups",{url:"/fleet-provisionwizard-group",controller:"FleetGroupCtrl",templateUrl:"views/csr_group.html",data:{pageTitle:"My Account",requiredLogin:!1}}).state("csr.provisionWizard.groupNew",{url:"/fleet-provisionwizard-newgroup",controller:"newEditGroupCtrl",templateUrl:"views/fleet_provision_group_new_edit.html",data:{pageTitle:"My Account",requiredLogin:!1}}).state("csr.provisionWizard.groupEdit",{url:"/fleet-provisionwizard-editgroup/:id",controller:"newEditGroupCtrl",templateUrl:"views/fleet_provision_group_new_edit.html",data:{pageTitle:"My Account",requiredLogin:!1}}).state("csr.provisionWizard.drivers",{url:"/fleet-provisionwizard-driver",controller:"FleetProvisionNewUserCtrl",templateUrl:"views/fleet_provision_new_user.html",data:{pageTitle:"Add Driver",requiredLogin:!1}}).state("csr.provisionWizard.managers",{url:"/fleet-provisionwizard-manager",controller:"FleetProvisionNewManagerCtrl",templateUrl:"views/fleet_provision_new_manager.html",data:{pageTitle:"Add Manager",requiredLogin:!1}}).state("csr.feedbacks",{url:"/feedbacks",controller:"CsrFeedbacksCtrl",templateUrl:"views/csr_feedbacks.html",data:{pageTitle:"Feedback",requiredLogin:!0}}).state("csr.feedbackmap",{url:"/feedbackmap",controller:"CsrFeedbackMapCtrl",templateUrl:"views/csr_feedbackmap.html",data:{pageTitle:"Feedback Map",requiredLogin:!1}}).state("csr.speedDisputeProcessingDetail",{url:"/speedDisputeProcessingDetail/:zendeskTicketId",controller:"CsrZendeskSearchCtrl",templateUrl:"views/csr_zendesk_search.html",data:{pageTitle:"Speed Dispute Processing",requiredLogin:!0}}).state("csr.dvcr",{url:"/dvcr",controller:"CsrDvcrSearchCtrl",templateUrl:"views/csr_dvcr_search.html",data:{pageTitle:"DVCR Search",requiredLogin:!0}}).state("csr.circle",{url:"/circle",controller:"CsrCircleSearchCtrl",templateUrl:"views/csr_circle_search.html",data:{pageTitle:"Circle Search",requiredLogin:!0}}).state("csr.rulesengine-mgmt-sequence",{url:"/rulesengine-sequence",controller:"CsrRulesEngineMgmtCtrl",templateUrl:"views/csr_rules_engine_mgmt_sequence.html",data:{pageTitle:"Feedback",requiredLogin:!0}}).state("csr.rulesengine-mgmt-ulms",{url:"/rulesengine-ulms-modules",controller:"CsrRulesEngineMgmtCtrl",templateUrl:"views/csr_rules_engine_mgmt_ulms.html",data:{pageTitle:"Feedback",requiredLogin:!0}})}function skipIfLoggedIn($q,$auth){var deferred=$q.defer();return $auth.isAuthenticated()?deferred.reject():deferred.resolve(),deferred.promise}function loginRequired($q,$location,$auth){var deferred=$q.defer();return $auth.isAuthenticated()?deferred.resolve():$location.path("/login_oms"),deferred.promise}$(function(){function fix_height(){var heightWithoutNavbar=$("body > #wrapper").height()-61;$(".sidebard-panel").css("min-height",heightWithoutNavbar+"px");var navbarHeigh=$("nav.navbar-default").height(),wrapperHeigh=$("#page-wrapper").height();navbarHeigh>wrapperHeigh&&$("#page-wrapper").css("min-height",$(window).height()+"px"),navbarHeigh<wrapperHeigh&&$("#page-wrapper").css("min-height",$(window).height()+"px"),$("body").hasClass("fixed-nav")}$(window).bind("load resize scroll",function(){$("body").hasClass("body-small")||fix_height()}),setTimeout(function(){fix_height()})}),$(function(){$(window).bind("load resize",function(){$(this).width()<769?$("body").addClass("body-small"):$("body").removeClass("body-small")})}),angular.module("edriving",["ngAria","ui.router","ui.bootstrap","angular.filter","edriving.shared.filters","ngCookies","ngResource","ngMessages","ngAnimate","toastr","oitozero.ngSweetAlert","satellizer","angularMoment","ui.tree","ui.grid","ui.grid.exporter","tmh.dynamicLocale","angular-jwt","toggle-switch","720kb.datepicker","720kb.tooltips","ngCsv","ngSanitize","darthwade.dwLoading","pascalprecht.translate","ui.grid.pagination","daterangepicker"]).constant("LOCALES",{locales:{"en-US":"English","pt-BR":"Língua","es-419":"Idioma","de-DE":"German for Germany","it-IT":"Italian for Italy","es-ES":"Spanish for Spain","fr-FR":"French for France","zh-CN":"????"},preferredLocale:"en-US"}),angular.module("edriving").config(config).run(function($rootScope,$state){$rootScope.$state=$state,$rootScope.$on("$stateChangeSuccess",function(event,toState){$rootScope.app=toState.name.split(".")[0]})}),angular.module("edriving").constant("TIME_ZONE",{select:{optgroup:[{label:"US (Common)",option:[{value:"America/Puerto_Rico",text:"Puerto Rico (Atlantic)"},{value:"America/New_York",text:"New York (Eastern)"},{value:"America/Chicago",text:"Chicago (Central)"},{value:"America/Denver",text:"Denver (Mountain)"},{value:"America/Phoenix",text:"Phoenix (MST)"},{value:"America/Los_Angeles",text:"Los Angeles (Pacific)"},{value:"America/Anchorage",text:"Anchorage (Alaska)"},{value:"Pacific/Honolulu",text:"Honolulu (Hawaii)"}]},{label:"America",option:[{value:"America/Adak",text:"Adak"},{value:"America/Anchorage",text:"Anchorage"},{value:"America/Anguilla",text:"Anguilla"},{value:"America/Antigua",text:"Antigua"},{value:"America/Araguaina",text:"Araguaina"},{value:"America/Argentina/Buenos_Aires",text:"Argentina - Buenos Aires"},{value:"America/Argentina/Catamarca",text:"Argentina - Catamarca"},{value:"America/Argentina/ComodRivadavia",text:"Argentina - ComodRivadavia"},{value:"America/Argentina/Cordoba",text:"Argentina - Cordoba"},{value:"America/Argentina/Jujuy",text:"Argentina - Jujuy"},{value:"America/Argentina/La_Rioja",text:"Argentina - La Rioja"},{value:"America/Argentina/Mendoza",text:"Argentina - Mendoza"},{value:"America/Argentina/Rio_Gallegos",text:"Argentina - Rio Gallegos"},{value:"America/Argentina/Salta",text:"Argentina - Salta"},{value:"America/Argentina/San_Juan",text:"Argentina - San Juan"},{value:"America/Argentina/San_Luis",text:"Argentina - San Luis"},{value:"America/Argentina/Tucuman",text:"Argentina - Tucuman"},{value:"America/Argentina/Ushuaia",text:"Argentina - Ushuaia"},{value:"America/Aruba",text:"Aruba"},{value:"America/Asuncion",text:"Asuncion"},{value:"America/Atikokan",text:"Atikokan"},{value:"America/Atka",text:"Atka"},{value:"America/Bahia",text:"Bahia"},{value:"America/Barbados",text:"Barbados"},{value:"America/Belem",text:"Belem"},{value:"America/Belize",text:"Belize"},{value:"America/Blanc-Sablon",text:"Blanc-Sablon"},{value:"America/Boa_Vista",text:"Boa Vista"},{value:"America/Bogota",text:"Bogota"},{value:"America/Boise",text:"Boise"},{value:"America/Buenos_Aires",text:"Buenos Aires"},{value:"America/Cambridge_Bay",text:"Cambridge Bay"},{value:"America/Campo_Grande",text:"Campo Grande"},{value:"America/Cancun",text:"Cancun"},{value:"America/Caracas",text:"Caracas"},{value:"America/Catamarca",text:"Catamarca"},{value:"America/Cayenne",text:"Cayenne"},{value:"America/Cayman",text:"Cayman"},{value:"America/Chicago",text:"Chicago"},{value:"America/Chihuahua",text:"Chihuahua"},{value:"America/Coral_Harbour",text:"Coral Harbour"},{value:"America/Cordoba",text:"Cordoba"},{value:"America/Costa_Rica",text:"Costa Rica"},{value:"America/Cuiaba",text:"Cuiaba"},{value:"America/Curacao",text:"Curacao"},{value:"America/Danmarkshavn",text:"Danmarkshavn"},{value:"America/Dawson",text:"Dawson"},{value:"America/Dawson_Creek",text:"Dawson Creek"},{value:"America/Denver",text:"Denver"},{value:"America/Detroit",text:"Detroit"},{value:"America/Dominica",text:"Dominica"},{value:"America/Edmonton",text:"Edmonton"},{value:"America/Eirunepe",text:"Eirunepe"},{value:"America/El_Salvador",text:"El Salvador"},{value:"America/Ensenada",text:"Ensenada"},{value:"America/Fortaleza",text:"Fortaleza"},{value:"America/Fort_Wayne",text:"Fort Wayne"},{value:"America/Glace_Bay",text:"Glace Bay"},{value:"America/Godthab",text:"Godthab"},{value:"America/Goose_Bay",text:"Goose Bay"},{value:"America/Grand_Turk",text:"Grand Turk"},{value:"America/Grenada",text:"Grenada"},{value:"America/Guadeloupe",text:"Guadeloupe"},{value:"America/Guatemala",text:"Guatemala"},{value:"America/Guayaquil",text:"Guayaquil"},{value:"America/Guyana",text:"Guyana"},{value:"America/Halifax",text:"Halifax"},{value:"America/Havana",text:"Havana"},{value:"America/Hermosillo",text:"Hermosillo"},{value:"America/Indiana/Indianapolis",text:"Indiana - Indianapolis"},{value:"America/Indiana/Knox",text:"Indiana - Knox"},{value:"America/Indiana/Marengo",text:"Indiana - Marengo"},{value:"America/Indiana/Petersburg",text:"Indiana - Petersburg"},{value:"America/Indiana/Tell_City",text:"Indiana - Tell City"},{value:"America/Indiana/Vevay",text:"Indiana - Vevay"},{value:"America/Indiana/Vincennes",text:"Indiana - Vincennes"},{value:"America/Indiana/Winamac",text:"Indiana - Winamac"},{value:"America/Indianapolis",text:"Indianapolis"},{value:"America/Inuvik",text:"Inuvik"},{value:"America/Iqaluit",text:"Iqaluit"},{value:"America/Jamaica",text:"Jamaica"},{value:"America/Jujuy",text:"Jujuy"},{value:"America/Juneau",text:"Juneau"},{value:"America/Kentucky/Louisville",text:"Kentucky - Louisville"},{value:"America/Kentucky/Monticello",text:"Kentucky - Monticello"},{value:"America/Knox_IN",text:"Knox IN"},{value:"America/La_Paz",text:"La Paz"},{value:"America/Lima",text:"Lima"},{value:"America/Los_Angeles",text:"Los Angeles"},{value:"America/Louisville",text:"Louisville"},{value:"America/Maceio",text:"Maceio"},{value:"America/Managua",text:"Managua"},{value:"America/Manaus",text:"Manaus"},{value:"America/Marigot",text:"Marigot"},{value:"America/Martinique",text:"Martinique"},{value:"America/Matamoros",text:"Matamoros"},{value:"America/Mazatlan",text:"Mazatlan"},{value:"America/Mendoza",text:"Mendoza"},{value:"America/Menominee",text:"Menominee"},{value:"America/Merida",text:"Merida"},{value:"America/Mexico_City",text:"Mexico City"},{value:"America/Miquelon",text:"Miquelon"},{value:"America/Moncton",text:"Moncton"},{value:"America/Monterrey",text:"Monterrey"},{value:"America/Montevideo",text:"Montevideo"},{value:"America/Montreal",text:"Montreal"},{value:"America/Montserrat",text:"Montserrat"},{value:"America/Nassau",text:"Nassau"},{value:"America/New_York",text:"New York"},{value:"America/Nipigon",text:"Nipigon"},{value:"America/Nome",text:"Nome"},{value:"America/Noronha",text:"Noronha"},{value:"America/North_Dakota/Center",text:"North Dakota - Center"},{value:"America/North_Dakota/New_Salem",text:"North Dakota - New Salem"},{value:"America/Ojinaga",text:"Ojinaga"},{value:"America/Panama",text:"Panama"},{value:"America/Pangnirtung",text:"Pangnirtung"},{value:"America/Paramaribo",text:"Paramaribo"},{value:"America/Phoenix",text:"Phoenix"},{value:"America/Port-au-Prince",text:"Port-au-Prince"},{value:"America/Porto_Acre",text:"Porto Acre"},{value:"America/Port_of_Spain",text:"Port of Spain"},{value:"America/Porto_Velho",text:"Porto Velho"},{value:"America/Puerto_Rico",text:"Puerto Rico"},{value:"America/Rainy_River",text:"Rainy River"},{value:"America/Rankin_Inlet",text:"Rankin Inlet"},{value:"America/Recife",text:"Recife"},{value:"America/Regina",text:"Regina"},{value:"America/Resolute",text:"Resolute"},{value:"America/Rio_Branco",text:"Rio Branco"},{value:"America/Rosario",text:"Rosario"},{value:"America/Santa_Isabel",text:"Santa Isabel"},{value:"America/Santarem",text:"Santarem"},{value:"America/Santiago",text:"Santiago"},{value:"America/Santo_Domingo",text:"Santo Domingo"},{value:"America/Sao_Paulo",text:"Sao Paulo"},{value:"America/Scoresbysund",text:"Scoresbysund"},{value:"America/Shiprock",text:"Shiprock"},{value:"America/St_Barthelemy",text:"St Barthelemy"},{value:"America/St_Johns",text:"St Johns"},{value:"America/St_Kitts",text:"St Kitts"},{value:"America/St_Lucia",text:"St Lucia"},{value:"America/St_Thomas",text:"St Thomas"},{value:"America/St_Vincent",text:"St Vincent"},{value:"America/Swift_Current",text:"Swift Current"},{value:"America/Tegucigalpa",text:"Tegucigalpa"},{value:"America/Thule",text:"Thule"},{value:"America/Thunder_Bay",text:"Thunder Bay"},{value:"America/Tijuana",text:"Tijuana"},{value:"America/Toronto",text:"Toronto"},{value:"America/Tortola",text:"Tortola"},{value:"America/Vancouver",text:"Vancouver"},{value:"America/Virgin",text:"Virgin"},{value:"America/Whitehorse",text:"Whitehorse"},{value:"America/Winnipeg",text:"Winnipeg"},{value:"America/Yakutat",text:"Yakutat"},{value:"America/Yellowknife",text:"Yellowknife"}]},{label:"Europe",option:[{value:"Europe/Amsterdam",text:"Amsterdam"},{value:"Europe/Andorra",text:"Andorra"},{value:"Europe/Athens",text:"Athens"},{value:"Europe/Belfast",text:"Belfast"},{value:"Europe/Belgrade",text:"Belgrade"},{value:"Europe/Berlin",text:"Berlin"},{value:"Europe/Bratislava",text:"Bratislava"},{value:"Europe/Brussels",text:"Brussels"},{value:"Europe/Bucharest",text:"Bucharest"},{value:"Europe/Budapest",text:"Budapest"},{value:"Europe/Chisinau",text:"Chisinau"},{value:"Europe/Copenhagen",text:"Copenhagen"},{value:"Europe/Dublin",text:"Dublin"},{value:"Europe/Gibraltar",text:"Gibraltar"},{value:"Europe/Guernsey",text:"Guernsey"},{value:"Europe/Helsinki",text:"Helsinki"},{value:"Europe/Isle_of_Man",text:"Isle of Man"},{value:"Europe/Istanbul",text:"Istanbul"},{value:"Europe/Jersey",text:"Jersey"},{value:"Europe/Kaliningrad",text:"Kaliningrad"},{value:"Europe/Kiev",text:"Kiev"},{value:"Europe/Lisbon",text:"Lisbon"},{value:"Europe/Ljubljana",text:"Ljubljana"},{value:"Europe/London",text:"London"},{value:"Europe/Luxembourg",text:"Luxembourg"},{value:"Europe/Madrid",text:"Madrid"},{value:"Europe/Malta",text:"Malta"},{value:"Europe/Mariehamn",text:"Mariehamn"},{value:"Europe/Minsk",text:"Minsk"},{value:"Europe/Monaco",text:"Monaco"},{value:"Europe/Moscow",text:"Moscow"},{value:"Europe/Nicosia",text:"Nicosia"},{value:"Europe/Oslo",text:"Oslo"},{value:"Europe/Paris",text:"Paris"},{value:"Europe/Podgorica",text:"Podgorica"},{value:"Europe/Prague",text:"Prague"},{value:"Europe/Riga",text:"Riga"},{value:"Europe/Rome",text:"Rome"},{value:"Europe/Samara",text:"Samara"},{value:"Europe/San_Marino",text:"San Marino"},{value:"Europe/Sarajevo",text:"Sarajevo"},{value:"Europe/Simferopol",text:"Simferopol"},{value:"Europe/Skopje",text:"Skopje"},{value:"Europe/Sofia",text:"Sofia"},{value:"Europe/Stockholm",text:"Stockholm"},{value:"Europe/Tallinn",text:"Tallinn"},{value:"Europe/Tirane",text:"Tirane"},{value:"Europe/Tiraspol",text:"Tiraspol"},{value:"Europe/Uzhgorod",text:"Uzhgorod"},{value:"Europe/Vaduz",text:"Vaduz"},{value:"Europe/Vatican",text:"Vatican"},{value:"Europe/Vienna",text:"Vienna"},{value:"Europe/Vilnius",text:"Vilnius"},{value:"Europe/Volgograd",text:"Volgograd"},{value:"Europe/Warsaw",text:"Warsaw"},{value:"Europe/Zagreb",text:"Zagreb"},{value:"Europe/Zaporozhye",text:"Zaporozhye"},{value:"Europe/Zurich",text:"Zurich"}]},{label:"Asia",option:[{value:"Asia/Aden",text:"Aden"},{value:"Asia/Almaty",text:"Almaty"},{value:"Asia/Amman",text:"Amman"},{value:"Asia/Anadyr",text:"Anadyr"},{value:"Asia/Aqtau",text:"Aqtau"},{value:"Asia/Aqtobe",text:"Aqtobe"},{value:"Asia/Ashgabat",text:"Ashgabat"},{value:"Asia/Ashkhabad",text:"Ashkhabad"},{value:"Asia/Baghdad",text:"Baghdad"},{value:"Asia/Bahrain",text:"Bahrain"},{value:"Asia/Baku",text:"Baku"},{value:"Asia/Bangkok",text:"Bangkok"},{value:"Asia/Beirut",text:"Beirut"},{value:"Asia/Bishkek",text:"Bishkek"},{value:"Asia/Brunei",text:"Brunei"},{value:"Asia/Calcutta",text:"Calcutta"},{value:"Asia/Choibalsan",text:"Choibalsan"},{value:"Asia/Chongqing",text:"Chongqing"},{value:"Asia/Chungking",text:"Chungking"},{value:"Asia/Colombo",text:"Colombo"},{value:"Asia/Dacca",text:"Dacca"},{value:"Asia/Damascus",text:"Damascus"},{value:"Asia/Dhaka",text:"Dhaka"},{value:"Asia/Dili",text:"Dili"},{value:"Asia/Dubai",text:"Dubai"},{value:"Asia/Dushanbe",text:"Dushanbe"},{value:"Asia/Gaza",text:"Gaza"},{value:"Asia/Harbin",text:"Harbin"},{value:"Asia/Ho_Chi_Minh",text:"Ho Chi Minh"},{value:"Asia/Hong_Kong",text:"Hong Kong"},{value:"Asia/Hovd",text:"Hovd"},{value:"Asia/Irkutsk",text:"Irkutsk"},{value:"Asia/Istanbul",text:"Istanbul"},{value:"Asia/Jakarta",text:"Jakarta"},{value:"Asia/Jayapura",text:"Jayapura"},{value:"Asia/Jerusalem",text:"Jerusalem"},{value:"Asia/Kabul",text:"Kabul"},{value:"Asia/Kamchatka",text:"Kamchatka"},{value:"Asia/Karachi",text:"Karachi"},{value:"Asia/Kashgar",text:"Kashgar"},{value:"Asia/Kathmandu",text:"Kathmandu"},{value:"Asia/Katmandu",text:"Katmandu"},{value:"Asia/Kolkata",text:"Kolkata"},{value:"Asia/Krasnoyarsk",text:"Krasnoyarsk"},{value:"Asia/Kuala_Lumpur",text:"Kuala Lumpur"},{value:"Asia/Kuching",text:"Kuching"},{value:"Asia/Kuwait",text:"Kuwait"},{value:"Asia/Macao",text:"Macao"},{value:"Asia/Macau",text:"Macau"},{value:"Asia/Magadan",text:"Magadan"},{value:"Asia/Makassar",text:"Makassar"},{value:"Asia/Manila",text:"Manila"},{value:"Asia/Muscat",text:"Muscat"},{value:"Asia/Nicosia",text:"Nicosia"},{value:"Asia/Novokuznetsk",text:"Novokuznetsk"},{value:"Asia/Novosibirsk",text:"Novosibirsk"},{value:"Asia/Omsk",text:"Omsk"},{value:"Asia/Oral",text:"Oral"},{value:"Asia/Phnom_Penh",text:"Phnom Penh"},{value:"Asia/Pontianak",text:"Pontianak"},{value:"Asia/Pyongyang",text:"Pyongyang"},{value:"Asia/Qatar",text:"Qatar"},{value:"Asia/Qyzylorda",text:"Qyzylorda"},{value:"Asia/Rangoon",text:"Rangoon"},{value:"Asia/Riyadh",text:"Riyadh"},{value:"Asia/Saigon",text:"Saigon"},{value:"Asia/Sakhalin",text:"Sakhalin"},{value:"Asia/Samarkand",text:"Samarkand"},{value:"Asia/Seoul",text:"Seoul"},{value:"Asia/Shanghai",text:"Shanghai"},{value:"Asia/Singapore",text:"Singapore"},{value:"Asia/Taipei",text:"Taipei"},{value:"Asia/Tashkent",text:"Tashkent"},{value:"Asia/Tbilisi",text:"Tbilisi"},{value:"Asia/Tehran",text:"Tehran"},{value:"Asia/Tel_Aviv",text:"Tel Aviv"},{value:"Asia/Thimbu",text:"Thimbu"},{value:"Asia/Thimphu",text:"Thimphu"},{value:"Asia/Tokyo",text:"Tokyo"},{value:"Asia/Ujung_Pandang",text:"Ujung Pandang"},{value:"Asia/Ulaanbaatar",text:"Ulaanbaatar"},{value:"Asia/Ulan_Bator",text:"Ulan Bator"},{value:"Asia/Urumqi",text:"Urumqi"},{value:"Asia/Vientiane",text:"Vientiane"},{value:"Asia/Vladivostok",text:"Vladivostok"},{value:"Asia/Yakutsk",text:"Yakutsk"},{value:"Asia/Yekaterinburg",text:"Yekaterinburg"},{value:"Asia/Yerevan",text:"Yerevan"}]},{label:"Africa",option:[{value:"Africa/Abidjan",text:"Abidjan"},{value:"Africa/Accra",text:"Accra"},{value:"Africa/Addis_Ababa",text:"Addis Ababa"},{value:"Africa/Algiers",text:"Algiers"},{value:"Africa/Asmara",text:"Asmara"},{value:"Africa/Asmera",text:"Asmera"},{value:"Africa/Bamako",text:"Bamako"},{value:"Africa/Bangui",text:"Bangui"},{value:"Africa/Banjul",text:"Banjul"},{value:"Africa/Bissau",text:"Bissau"},{value:"Africa/Blantyre",text:"Blantyre"},{value:"Africa/Brazzaville",text:"Brazzaville"},{value:"Africa/Bujumbura",text:"Bujumbura"},{value:"Africa/Cairo",text:"Cairo"},{value:"Africa/Casablanca",text:"Casablanca"},{value:"Africa/Ceuta",text:"Ceuta"},{value:"Africa/Conakry",text:"Conakry"},{value:"Africa/Dakar",text:"Dakar"},{value:"Africa/Dar_es_Salaam",text:"Dar es Salaam"},{value:"Africa/Djibouti",text:"Djibouti"},{value:"Africa/Douala",text:"Douala"},{value:"Africa/El_Aaiun",text:"El Aaiun"},{value:"Africa/Freetown",text:"Freetown"},{value:"Africa/Gaborone",text:"Gaborone"},{value:"Africa/Harare",text:"Harare"},{value:"Africa/Johannesburg",text:"Johannesburg"},{value:"Africa/Kampala",text:"Kampala"},{value:"Africa/Khartoum",text:"Khartoum"},{value:"Africa/Kigali",text:"Kigali"},{value:"Africa/Kinshasa",text:"Kinshasa"},{value:"Africa/Lagos",text:"Lagos"},{value:"Africa/Libreville",text:"Libreville"},{value:"Africa/Lome",text:"Lome"},{value:"Africa/Luanda",text:"Luanda"},{value:"Africa/Lubumbashi",text:"Lubumbashi"},{value:"Africa/Lusaka",text:"Lusaka"},{value:"Africa/Malabo",text:"Malabo"},{value:"Africa/Maputo",text:"Maputo"},{value:"Africa/Maseru",text:"Maseru"},{value:"Africa/Mbabane",text:"Mbabane"},{value:"Africa/Mogadishu",text:"Mogadishu"},{value:"Africa/Monrovia",text:"Monrovia"},{value:"Africa/Nairobi",text:"Nairobi"},{value:"Africa/Ndjamena",text:"Ndjamena"},{value:"Africa/Niamey",text:"Niamey"},{value:"Africa/Nouakchott",text:"Nouakchott"},{value:"Africa/Ouagadougou",text:"Ouagadougou"},{value:"Africa/Porto-Novo",text:"Porto-Novo"},{value:"Africa/Sao_Tome",text:"Sao Tome"},{value:"Africa/Timbuktu",text:"Timbuktu"},{value:"Africa/Tripoli",text:"Tripoli"},{value:"Africa/Tunis",text:"Tunis"},{value:"Africa/Windhoek",text:"Windhoek"}]},{label:"Australia",option:[{value:"Australia/ACT",text:"ACT"},{value:"Australia/Adelaide",text:"Adelaide"},{value:"Australia/Brisbane",text:"Brisbane"},{value:"Australia/Broken_Hill",text:"Broken Hill"},{value:"Australia/Canberra",text:"Canberra"},{value:"Australia/Currie",text:"Currie"},{value:"Australia/Darwin",text:"Darwin"},{value:"Australia/Eucla",text:"Eucla"},{value:"Australia/Hobart",text:"Hobart"},{value:"Australia/LHI",text:"LHI"},{value:"Australia/Lindeman",text:"Lindeman"},{value:"Australia/Lord_Howe",text:"Lord Howe"},{value:"Australia/Melbourne",text:"Melbourne"},{value:"Australia/North",text:"North"},{value:"Australia/NSW",text:"NSW"},{value:"Australia/Perth",text:"Perth"},{value:"Australia/Queensland",text:"Queensland"},{value:"Australia/South",text:"South"},{value:"Australia/Sydney",text:"Sydney"},{value:"Australia/Tasmania",text:"Tasmania"},{value:"Australia/Victoria",text:"Victoria"},{value:"Australia/West",text:"West"},{value:"Australia/Yancowinna",text:"Yancowinna"}]},{label:"Indian",option:[{value:"Indian/Antananarivo",text:"Antananarivo"},{value:"Indian/Chagos",text:"Chagos"},{value:"Indian/Christmas",text:"Christmas"},{value:"Indian/Cocos",text:"Cocos"},{value:"Indian/Comoro",text:"Comoro"},{value:"Indian/Kerguelen",text:"Kerguelen"},{value:"Indian/Mahe",text:"Mahe"},{value:"Indian/Maldives",text:"Maldives"},{value:"Indian/Mauritius",text:"Mauritius"},{value:"Indian/Mayotte",text:"Mayotte"},{value:"Indian/Reunion",text:"Reunion"}]},{label:"Atlantic",option:[{value:"Atlantic/Azores",text:"Azores"},{value:"Atlantic/Bermuda",text:"Bermuda"},{value:"Atlantic/Canary",text:"Canary"},{value:"Atlantic/Cape_Verde",text:"Cape Verde"},{value:"Atlantic/Faeroe",text:"Faeroe"},{value:"Atlantic/Faroe",text:"Faroe"},{value:"Atlantic/Jan_Mayen",text:"Jan Mayen"},{value:"Atlantic/Madeira",text:"Madeira"},{value:"Atlantic/Reykjavik",text:"Reykjavik"},{value:"Atlantic/South_Georgia",text:"South Georgia"},{value:"Atlantic/Stanley",text:"Stanley"},{value:"Atlantic/St_Helena",text:"St Helena"}]},{label:"Pacific",option:[{value:"Pacific/Apia",text:"Apia"},{value:"Pacific/Auckland",text:"Auckland"},{value:"Pacific/Chatham",text:"Chatham"},{value:"Pacific/Easter",text:"Easter"},{value:"Pacific/Efate",text:"Efate"},{value:"Pacific/Enderbury",text:"Enderbury"},{value:"Pacific/Fakaofo",text:"Fakaofo"},{value:"Pacific/Fiji",text:"Fiji"},{value:"Pacific/Funafuti",text:"Funafuti"},{value:"Pacific/Galapagos",text:"Galapagos"},{value:"Pacific/Gambier",text:"Gambier"},{value:"Pacific/Guadalcanal",text:"Guadalcanal"},{value:"Pacific/Guam",text:"Guam"},{value:"Pacific/Honolulu",text:"Honolulu"},{value:"Pacific/Johnston",text:"Johnston"},{value:"Pacific/Kiritimati",text:"Kiritimati"},{value:"Pacific/Kosrae",text:"Kosrae"},{value:"Pacific/Kwajalein",text:"Kwajalein"},{value:"Pacific/Majuro",text:"Majuro"},{value:"Pacific/Marquesas",text:"Marquesas"},{value:"Pacific/Midway",text:"Midway"},{value:"Pacific/Nauru",text:"Nauru"},{value:"Pacific/Niue",text:"Niue"},{value:"Pacific/Norfolk",text:"Norfolk"},{value:"Pacific/Noumea",text:"Noumea"},{value:"Pacific/Pago_Pago",text:"Pago Pago"},{value:"Pacific/Palau",text:"Palau"},{value:"Pacific/Pitcairn",text:"Pitcairn"},{value:"Pacific/Ponape",text:"Ponape"},{value:"Pacific/Port_Moresby",text:"Port Moresby"},{value:"Pacific/Rarotonga",text:"Rarotonga"},{value:"Pacific/Saipan",text:"Saipan"},{value:"Pacific/Samoa",text:"Samoa"},{value:"Pacific/Tahiti",text:"Tahiti"},{value:"Pacific/Tarawa",text:"Tarawa"},{value:"Pacific/Tongatapu",text:"Tongatapu"},{value:"Pacific/Truk",text:"Truk"},{value:"Pacific/Wake",text:"Wake"},{value:"Pacific/Wallis",text:"Wallis"},{value:"Pacific/Yap",text:"Yap"}]},{label:"Antarctica",option:[{value:"Antarctica/Casey",text:"Casey"},{value:"Antarctica/Davis",text:"Davis"},{value:"Antarctica/DumontDUrville",text:"DumontDUrville"},{value:"Antarctica/Macquarie",text:"Macquarie"},{value:"Antarctica/Mawson",text:"Mawson"},{value:"Antarctica/McMurdo",text:"McMurdo"},{value:"Antarctica/Palmer",text:"Palmer"},{value:"Antarctica/Rothera",text:"Rothera"},{value:"Antarctica/South_Pole",text:"South Pole"},{value:"Antarctica/Syowa",text:"Syowa"},{value:"Antarctica/Vostok",text:"Vostok"}]},{label:"Arctic",option:{value:"Arctic/Longyearbyen",text:"Longyearbyen"}},{label:"UTC",option:{value:"UTC",text:"UTC"}},{label:"Manual Offsets",option:[{value:"UTC-12",text:"UTC-12"},{value:"UTC-11",text:"UTC-11"},{value:"UTC-10",text:"UTC-10"},{value:"UTC-9",text:"UTC-9"},{value:"UTC-8",text:"UTC-8"},{value:"UTC-7",text:"UTC-7"},{value:"UTC-6",text:"UTC-6"},{value:"UTC-5",text:"UTC-5"},{value:"UTC-4",text:"UTC-4"},{value:"UTC-3",text:"UTC-3"},{value:"UTC-2",text:"UTC-2"},{value:"UTC-1",text:"UTC-1"},{value:"UTC+0",text:"UTC+0"},{value:"UTC+1",text:"UTC+1"},{value:"UTC+2",text:"UTC+2"},{value:"UTC+3",text:"UTC+3"},{value:"UTC+4",text:"UTC+4"},{value:"UTC+5",text:"UTC+5"},{value:"UTC+6",text:"UTC+6"},{value:"UTC+7",text:"UTC+7"},{value:"UTC+8",text:"UTC+8"},{value:"UTC+9",text:"UTC+9"},{value:"UTC+10",text:"UTC+10"},{value:"UTC+11",text:"UTC+11"},{value:"UTC+12",text:"UTC+12"},{value:"UTC+13",text:"UTC+13"},{value:"UTC+14",text:"UTC+14"}]}]}});const VERSION_DEF={Mentor002:{CATEGORIES:{"BODY-FRONT_DRIVER_SIDE":"","BODY-REAR_DRIVER_SIDE":"","BODY-FRONT_PASSENGER_SIDE":"","BODY-REAR_PASSENGER_SIDE":"","BODY-FRONT_SIDE":"","BODY-REAR_SIDE":"","BODY-UNDERCARRIAGE":"","BRAKE-SERVICE":"","BRAKE-PARKING":"","BRANDING-EXTERIOR":"","CAMERA-DISPLAY":"","CAMERA-EXTERIOR_CAMERA":"",DASHBOARD:"","DELIVERY-INTERIOR":"","DOORS-DRIVER_SIDE":"","DOORS-PASSENGER_SIDE":"","DOORS-REAR_SIDE":"","DOORS-SLIDING_DOOR":"",HORN:"","LICENSE-FRONT_BUMPER":"","LICENSE-REAR_BUMPER":"","LIGHTS-FRONT_DRIVER_SIDE":"","LIGHTS-REAR_DRIVER_SIDE":"","LIGHTS-FRONT_PASSENGER_SIDE":"","LIGHTS-REAR_PASSENGER_SIDE":"","LIGHTS-INTERIOR":"","SEATBELT-DRIVER_SIDE":"","SEATBELT-PASSENGER_SIDE":"","SIDE_MIRROR-DRIVER_SIDE":"","SIDE_MIRROR-PASSENGER_SIDE":"","WINDSHIELD-DRIVER_SIDE":"","WINDSHIELD-PASSENGER_SIDE":"","WIPER-FRONT_SIDE":"","WIPER-DRIVER_SIDE":"","WIPER-REAR_SIDE":"","TIRE-FRONT_DRIVER_SIDE":"","TIRE-REAR_DRIVER_SIDE":"","TIRE-FRONT_PASSENGER_SIDE":"","TIRE-REAR_PASSENGER_SIDE":""},COMMENTS:{"BODY-HOLE":{priority:1,desc:"Hole/puncture are present."},"BODY-ITEM_HANGING_DOWN":{priority:1,desc:"Items attached to the body of the vehicle are loose or missing."},"BODY-SCRATCH_LARGER_THAN_BILL":{priority:2,desc:"Scratch/Dent/Chips are present and larger than the width of dollar bill or credit card."},"BRAKE-PARKING-LOOSE":{priority:1,desc:"Parking brake is loose or no braking occurs."},"BRAKE-SERVICE-GRINDING":{priority:1,desc:"There is grinding."},"BRAKE-SERVICE-NOT_STOP":{priority:1,desc:"Vehicle does not stop properly."},"BRAKE-SERVICE-SINK_TO_FLOORMAT":{priority:1,desc:"It sinks all the way to the floor mat."},"BRAKE-SERVICE-SQUEAKING":{priority:2,desc:"There is squeaking."},"BRANDING-BADGE":{priority:2,desc:"Amazon Prime Badge is not visible or not in good condition."},"BRANDING-DIRTY":{priority:2,desc:"Amazon Van is dirty."},"CAMERA-BACKUP_MISSING":{priority:1,desc:"The external back-up camera is missing."},"CAMERA-DISPLAY":{priority:1,desc:"The rear-view display monitor is mirror imaged."},"CAMERA-NOT_TURN_ON":{priority:1,desc:"The rear-view display monitor does not come on."},"DASHBOARD-DEF_ADBLUE":{priority:1,desc:"DEF AdBlue indicator light stays on."},"DASHBOARD-ENGINE":{priority:1,desc:"Check engine light stays on."},"DASHBOARD-OTHER":{priority:1,desc:"Other warning lights stay on."},"DELIVERY-DAMAGED":{priority:1,desc:"Cradle is damaged."},"DELIVERY-MISSING":{priority:1,desc:"Cradle is missing."},DOORS:{priority:1,desc:"Any doors can't open/close/lock from the outside."},HORN:{priority:1,desc:"Horn not functional."},"LICENSE-PLATE_DAMAGED":{priority:1,desc:"License plates/temp tags are damaged or missing."},"LICENSE-PLATE_DIRTY":{priority:2,desc:"License plates/temp tags are dirty and not visible."},"LICENSE-PLATE_EXPIRED":{priority:1,desc:"License plates/temp tags have expired."},"LIGHTS-BRAKE_LIGHT":{priority:1,desc:"Brake Lights do not come on."},"LIGHTS-COVER":{priority:1,desc:"Reflectors/light covers are broken."},"LIGHTS-HEADLIGHTS":{priority:1,desc:"Headlights are out."},"LIGHTS-INTERNAL":{priority:1,desc:"Internal or rear compartment lights do not come on."},"LIGHTS-TURN_LIGHT":{priority:1,desc:"Turn Signals are not working."},"LIGHTS-HAZARD":{priority:1,desc:"Hazard Light is not working."},"LIGHTS-LICENSE":{priority:1,desc:"License Plate light is not working."},SEATBELT:{priority:1,desc:"Seat belt does not buckle or is missing."},"SIDE_MIRROR-NOT_OBSTRUCTED":{priority:2,desc:"Damage does not obstruct the driver�s line of sight."},"SIDE_MIRROR-OBSTRUCTED":{priority:1,desc:"Missing mirror, distortion, or damage obstructs the driver�s line of sight."},"TIRE-FLAT":{priority:1,desc:"Tire is losing air or visibly flat."},"TIRE-HAS_OBJECTS":{priority:1,desc:"Tire has objects, sidewall bulges, or cuts to tire tread/surface"},"TIRE-TREAD_BELOW_INDICATOR":{priority:1,desc:"Tread is below the tread indicator."},"WINDSHIELD-CRACKS":{priority:1,desc:"3 or more cracks/chips are present."},"WINDSHIELD-NOT_OBSTRUCTED":{priority:2,desc:"Damage does not obstruct the driver�s line of sight."},"WINDSHIELD-OBSTRUCTED":{priority:1,desc:"Damage obstructs the driver�s line of sight."},"WINDSHIELD-CRACKS":{priority:1,desc:"3 or more cracks/chips are present."},"WIPER-DAMAGE":{priority:1,desc:"Wipers are damaged, missing or do not turn on."},"WIPER-DEFROSTER":{priority:1,desc:"Windshield Wiper/Washer System is not functional."},"WIPER-WASHER":{priority:1,desc:"Defroster is not functional."},OTHER:{priority:1,desc:""}}},Audit002:{CATEGORIES:{"BODY-FRONT_DRIVER_SIDE":"","BODY-REAR_DRIVER_SIDE":"","BODY-FRONT_PASSENGER_SIDE":"","BODY-REAR_PASSENGER_SIDE":"","BODY-FRONT_SIDE":"","BODY-REAR_SIDE":"","BODY-UNDERCARRIAGE":"","BRAKE-SERVICE":"","BRAKE-PARKING":"","BRANDING-EXTERIOR":"","CAMERA-DISPLAY":"","CAMERA-EXTERIOR_CAMERA":"",DASHBOARD:"","DELIVERY-INTERIOR":"","DOORS-DRIVER_SIDE":"","DOORS-PASSENGER_SIDE":"","DOORS-REAR_SIDE":"","DOORS-SLIDING_DOOR":"",HORN:"","LICENSE-FRONT_BUMPER":"","LICENSE-REAR_BUMPER":"","LIGHTS-FRONT_DRIVER_SIDE":"","LIGHTS-REAR_DRIVER_SIDE":"","LIGHTS-FRONT_PASSENGER_SIDE":"","LIGHTS-REAR_PASSENGER_SIDE":"","LIGHTS-INTERIOR":"","SEATBELT-DRIVER_SIDE":"","SEATBELT-PASSENGER_SIDE":"","SIDE_MIRROR-DRIVER_SIDE":"","SIDE_MIRROR-PASSENGER_SIDE":"","WINDSHIELD-DRIVER_SIDE":"","WINDSHIELD-PASSENGER_SIDE":"","WIPER-FRONT_SIDE":"","WIPER-DRIVER_SIDE":"","WIPER-REAR_SIDE":"","TIRE-FRONT_DRIVER_SIDE":"","TIRE-REAR_DRIVER_SIDE":"","TIRE-FRONT_PASSENGER_SIDE":"","TIRE-REAR_PASSENGER_SIDE":"","LIGHT_C&R-FRONT_DRIVER_SIDE":"","LIGHT_C&R-REAR_DRIVER_SIDE":"","LIGHT_C&R-FRONT_PASSENGER_SIDE":"","LIGHT_C&R-REAR_PASSENGER_SIDE":"","LIGHT_C&R-INTERIOR":"",PACKAGES:"",UNIFORMS:"","CREDENTIALS-ALL_MATCH":"","CREDENTIALS-DRIVERS_LICENSE":"",AC_HEATING:""},COMMENTS:{"WINDSHIELD-CRACKS_OVER":{priority:1,desc:"Cracks over the steering wheels."},"WIPER-NOT_PRESENT":{priority:1,desc:"Wipers are not present."},"SIDE_MIRROR-NOT_PRESENT":{priority:1,desc:"Side mirrors are not present."},"SIDE_MIRROR-CRACKS":{priority:1,desc:"Side mirrors have cracks."},"BODY-ITEMS_LOOSE":{priority:1,desc:"Items attached to the body (such as Side Mirrors, Steps, Bumpers etc.) of the vehicle are loose hanging or held with a zip tie or tape."},"BODY-LARGE_DENTS":{priority:1,desc:"Large dents in the hood, fender or door."},"LIGHT_C&R-BROKEN":{priority:1,desc:"Light Covers or Reflectors are broken."},"LIGHTS-HEADLIGHTS_NO":{priority:1,desc:"Headlights are not operational."},"LIGHTS-FLASHERS_NO":{priority:1,desc:"Emergency Flashers are not operational."},"TIRE-TREAD":{priority:1,desc:"Tread depth is less than 2/32"},"TIRE-OBJECTS":{priority:1,desc:"Objects/cuts/buldge to the surface or Tread."},"TIRE-VISIBILY_FLAT":{priority:1,desc:"Tire is visibly flat."},"PACKAGES-MISPLACED":{priority:1,desc:"Packages on seat or dashboard."},"UNIFORMS-TOP":{priority:2,desc:"The DA does not have a branded Top."},"UNIFORMS-BOT":{priority:2,desc:"The DA does not have a branded Bottom."},"CREDENTIALS-FACE_ID":{priority:2,desc:"Face does not match ID."},"CREDENTIALS-FACE_BADGE":{priority:2,desc:"Face does not match badge."},"CREDENTIALS-FACE_RABBIT":{priority:2,desc:"Face does not match Rabbit app."},"CREDENTIALS-ID_RABBIT":{priority:2,desc:"ID does not match Rabbit app."},"CREDENTIALS-ID_BADGE":{priority:2,desc:"ID does not match badge."},"CREDENTIALS-BADGE_RABBIT":{priority:2,desc:"Badge does not match Rabbit app."},"CREDENTIALS-ALL":{priority:2,desc:"Face, ID, badge and Rabbit app do not match."},"AC_HEATING-AC":{priority:1,desc:"AC is not working properly."},"AC_HEATING-HEATING":{priority:1,desc:"Heating is not working properly."},OTHER_AUDIT:{priority:2,desc:""}}},Audit003:{CATEGORIES:{"BODY-FRONT_DRIVER_SIDE":"","BODY-REAR_DRIVER_SIDE":"","BODY-FRONT_PASSENGER_SIDE":"","BODY-REAR_PASSENGER_SIDE":"","BODY-FRONT_SIDE":"","BODY-REAR_SIDE":"","BODY-UNDERCARRIAGE":"",BRAKES:"","BRANDING-EXTERIOR":"","CAMERA-DISPLAY":"","CAMERA-EXTERIOR_CAMERA":"",DASHBOARD:"","DELIVERY-INTERIOR":"","DOORS-DRIVER_SIDE":"","DOORS-PASSENGER_SIDE":"","DOORS-REAR_SIDE":"","DOORS-SLIDING_DOOR":"",HORN:"","LICENSE-FRONT_BUMPER":"","LICENSE-REAR_BUMPER":"","LIGHTS-FRONT_DRIVER_SIDE":"","LIGHTS-REAR_DRIVER_SIDE":"","LIGHTS-FRONT_PASSENGER_SIDE":"","LIGHTS-REAR_PASSENGER_SIDE":"","LIGHTS-INTERIOR":"","SEATBELT-DRIVER_SIDE":"","SEATBELT-PASSENGER_SIDE":"","SIDE_MIRROR-DRIVER_SIDE":"","SIDE_MIRROR-PASSENGER_SIDE":"","WINDSHIELD-DRIVER_SIDE":"","WINDSHIELD-PASSENGER_SIDE":"","WIPER-FRONT_SIDE":"","WIPER-DRIVER_SIDE":"","WIPER-REAR_SIDE":"","TIRE-FRONT_DRIVER_SIDE":"","TIRE-REAR_DRIVER_SIDE":"","TIRE-FRONT_PASSENGER_SIDE":"","TIRE-REAR_PASSENGER_SIDE":"","LIGHT_C&R-FRONT_DRIVER_SIDE":"","LIGHT_C&R-REAR_DRIVER_SIDE":"","LIGHT_C&R-FRONT_PASSENGER_SIDE":"","LIGHT_C&R-REAR_PASSENGER_SIDE":"","LIGHT_C&R-INTERIOR":"",SAFETY_ACC:"",AC_HEATING:"",PACKAGES:"",UNIFORMS:"","CREDENTIALS-ALL_MATCH":"","CREDENTIALS-DRIVERS_LICENSE":""},COMMENTS:{"WINDSHIELD-CRACKS_OVER":{priority:1,desc:"Cracks over the steering wheels."},"WINDSHIELD-OTHER":{priority:1,desc:"Other."},"WIPER-NOT_PRESENT":{priority:1,desc:"Wipers are not present."},"WIPER-OTHER":{priority:1,desc:"Other."},"SIDE_MIRROR-NOT_PRESENT":{priority:1,desc:"Side mirrors are not present."},"SIDE_MIRROR-CRACKS":{priority:1,desc:"Side mirrors have cracks."},"SIDE_MIRROR-OTHER":{priority:1,desc:"Other."},"BRAKES-PEDAL":{priority:1,desc:"Foot/Service brake pedal is not operational."},"BRAKES-OTHER":{priority:1,desc:"Other."},"SAFETY_ACC-DDC":{priority:1,desc:"Delivery Device Cradle is not present or broken."},"SAFETY_ACC-OTHER":{priority:1,desc:"Other."},"BODY-ITEMS_LOOSE":{priority:1,desc:"Items attached to the body (such as Side Mirrors, Steps, Bumpers etc.) of the vehicle are loose hanging or held with a zip tie or tape."},"BODY-LARGE_DENTS":{priority:1,desc:"Large dents in the hood, fender or door."},"BODY-OTHER":{priority:1,desc:"Other."},"LIGHT_C&R-BROKEN":{priority:1,desc:"Light Covers or Reflectors are broken."},"LIGHT_C&R-OTHER":{priority:1,desc:"Other."},"LIGHTS-HEADLIGHTS_NO":{priority:1,desc:"Headlights are not operational."},"LIGHTS-FLASHERS_NO":{priority:1,desc:"Emergency Flashers are not operational."},"LIGHTS-OTHER":{priority:1,desc:"Other."},"TIRE-TREAD":{priority:1,desc:"Tread depth is less than 2/32"},"TIRE-OBJECTS":{priority:1,desc:"Objects/cuts/buldge to the surface or Tread."},"TIRE-VISIBILY_FLAT":{priority:1,desc:"Tire is visibly flat."},"TIRE-OTHER":{priority:1,desc:"Other."},"AC_HEATING-AC":{priority:1,desc:"AC is not working properly."},"AC_HEATING-HEATING":{priority:1,desc:"Heating is not working properly."},"AC_HEATING-OTHER":{priority:1,desc:"Other."},"PACKAGES-MISPLACED":{priority:1,desc:"Packages on seat or dashboard."},"PACKAGES-OTHER":{priority:1,desc:"Other."},"UNIFORMS-TOP":{priority:2,desc:"The DA does not have a branded Top."},"UNIFORMS-BOT":{priority:2,desc:"The DA does not have a branded Bottom."},"UNIFORMS-OTHER":{priority:2,desc:"Other."},"CREDENTIALS-FACE_ID":{priority:2,desc:"Face does not match ID."},"CREDENTIALS-FACE_BADGE":{priority:2,desc:"Face does not match badge."},"CREDENTIALS-FACE_RABBIT":{priority:2,desc:"Face does not match Rabbit app."},"CREDENTIALS-ID_RABBIT":{priority:2,desc:"ID does not match Rabbit app."},"CREDENTIALS-ID_BADGE":{priority:2,desc:"ID does not match badge."},"CREDENTIALS-BADGE_RABBIT":{priority:2,desc:"Badge does not match Rabbit app."},"CREDENTIALS-ALL":{priority:2,desc:"Face, ID, badge and Rabbit app do not match."},"CREDENTIALS-OTHER":{priority:2,desc:"Other."}}},NO_VERSION:{CATEGORIES:{Windshield:"","Side Mirrors-Driver Side":"","Side Mirrors-Passenger Side":"","Tires-Front Driver Side":"","Tires-Rear Driver Side":"","Tires-Front Passenger Side":"","Tires-Rear Passenger Side":"","Body Damage-Front Side":"","Body Damage-Rear Side":"","Body Damage-Front Driver Side":"","Body Damage-Rear Driver Side":"","Body Damage-Front Passenger Side":"","Body Damage-Rear Passenger Side":"","Fire Extinguisher":"","Lights-Front Driver Side":"","Lights-Rear Driver Side":"","Lights-Front Passenger Side":"","Lights-Rear Passenger Side":"",Wipers:"",Brakes:"","BODY-FRONT_DRIVER_SIDE":"","BODY-REAR_DRIVER_SIDE":"","BODY-FRONT_PASSENGER_SIDE":"","BODY-REAR_PASSENGER_SIDE":"","BODY-FRONT_SIDE":"","BODY-REAR_SIDE":"","BODY-UNDERCARRIAGE":"","BRAKE-SERVICE":"","BRAKE-PARKING":"","BRANDING-EXTERIOR":"","CAMERA-DISPLAY":"","CAMERA-EXTERIOR_CAMERA":"",DASHBOARD:"","DELIVERY-INTERIOR":"","DOORS-DRIVER_SIDE":"","DOORS-PASSENGER_SIDE":"","DOORS-REAR_SIDE":"","DOORS-SLIDING_DOOR":"",HORN:"","LICENSE-FRONT_BUMPER":"","LICENSE-REAR_BUMPER":"","LIGHTS-FRONT_DRIVER_SIDE":"","LIGHTS-REAR_DRIVER_SIDE":"","LIGHTS-FRONT_PASSENGER_SIDE":"","LIGHTS-REAR_PASSENGER_SIDE":"","LIGHTS-INTERIOR":"","SEATBELT-DRIVER_SIDE":"","SEATBELT-PASSENGER_SIDE":"","SIDE_MIRROR-DRIVER_SIDE":"","SIDE_MIRROR-PASSENGER_SIDE":"","WINDSHIELD-DRIVER_SIDE":"","WINDSHIELD-PASSENGER_SIDE":"","WIPER-FRONT_SIDE":"","WIPER-DRIVER_SIDE":"","WIPER-REAR_SIDE":"","TIRE-FRONT_DRIVER_SIDE":"","TIRE-REAR_DRIVER_SIDE":"","TIRE-FRONT_PASSENGER_SIDE":"","TIRE-REAR_PASSENGER_SIDE":"","TIRE-DRIVER_SIDE":"","TIRE-PASSENGER_SIDE":"","LIGHT_C&R-FRONT_DRIVER_SIDE":"","LIGHT_C&R-REAR_DRIVER_SIDE":"","LIGHT_C&R-FRONT_PASSENGER_SIDE":"","LIGHT_C&R-REAR_PASSENGER_SIDE":"","LIGHT_C&R-INTERIOR":"",PACKAGES:"",UNIFORMS:"","CREDENTIALS-ALL_MATCH":"","CREDENTIALS-DRIVERS_LICENSE":"",AC_HEATING:""},COMMENTS:{"BODY-HOLE":{priority:1,desc:""},"BODY-ITEM_HANGING_DOWN":{priority:1,desc:""},"BODY-SCRATCH_LARGER_THAN_BILL":{priority:3,desc:""},"BRAKE-PARKING-LOOSE":{priority:1,desc:""},"BRAKE-SERVICE-GRINDING":{priority:2,desc:""},"BRAKE-SERVICE-NOT_STOP":{priority:2,desc:""},"BRAKE-SERVICE-SINK_TO_FLOORMAT":{priority:1,desc:""},"BRAKE-SERVICE-SQUEAKING":{priority:3,desc:""},"BRANDING-BADGE":{priority:3,desc:""},"BRANDING-DIRTY":{priority:3,desc:""},"CAMERA-BACKUP_MISSING":{priority:2,desc:""},"CAMERA-DISPLAY":{priority:3,desc:""},"CAMERA-NOT_TURN_ON":{priority:2,desc:""},"DASHBOARD-DEF_ADBLUE":{priority:3,desc:""},"DASHBOARD-ENGINE":{priority:2,desc:""},"DASHBOARD-OTHER":{priority:2,desc:""},DELIVERY:{priority:2,desc:""},DOORS:{priority:1,desc:""},HORN:{priority:1,desc:""},"LICENSE-PLATE_DAMAGED":{priority:2,desc:""},"LICENSE-PLATE_DIRTY":{priority:3,desc:""},"LICENSE-PLATE_EXPIRED":{priority:1,desc:""},"LIGHTS-BRAKE_LIGHT":{priority:1,desc:""},"LIGHTS-COVER":{priority:1,desc:""},"LIGHTS-HEADLIGHTS":{priority:1,desc:""},"LIGHTS-INTERNAL":{priority:3,desc:""},"LIGHTS-TURN_LIGHT":{priority:1,desc:""},SEATBELT:{priority:1,desc:""},"SIDE_MIRROR-NOT_OBSTRUCTED":{priority:3,desc:""},"SIDE_MIRROR-OBSTRUCTED":{priority:1,desc:""},"TIRE-FLAT":{priority:1,desc:""},"TIRE-HAS_OBJECTS":{priority:1,desc:""},"TIRE-TREAD_BELOW_INDICATOR":{priority:1,desc:""},"WINDSHIELD-CRACKS":{priority:2,desc:""},"WINDSHIELD-NOT_OBSTRUCTED":{priority:3,desc:""},"WINDSHIELD-OBSTRUCTED":{priority:1,desc:""},"WIPER-DAMAGE":{priority:1,desc:""},"WIPER-DEFROSTER":{priority:1,desc:""},"WIPER-WASHER":{priority:1,desc:""},OTHER:{priority:3,desc:""},"WINDSHIELD-CRACKS_OVER":{priority:1,desc:""},"WIPER-NOT_PRESENT":{priority:1,desc:""},"SIDE_MIRROR-NOT_PRESENT":{priority:1,desc:""},"SIDE_MIRROR-CRACKS":{priority:1,desc:""},"BODY-ITEMS_LOOSE":{priority:1,desc:""},"BODY-LARGE_DENTS":{priority:1,desc:""},"LIGHT_C&R-BROKEN":{priority:1,desc:""},"LIGHTS-HEADLIGHTS_NO":{priority:1,desc:""},"LIGHTS-FLASHERS_NO":{priority:1,desc:""},"TIRE-TREAD":{priority:1,desc:""},"TIRE-OBJECTS":{priority:1,desc:""},"TIRE-VISIBILY_FLAT":{priority:1,desc:""},"PACKAGES-MISPLACED":{priority:1,desc:""},"UNIFORMS-MISSING":{priority:1,desc:""},"CREDENTIALS-ID":{priority:1,desc:""},OTHER_AUDIT:{priority:1,desc:""}}}};function pageTitle($rootScope,$timeout){return{link:function(scope,element){$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){var title="";toState.data&&toState.data.pageTitle&&(title=toState.data.pageTitle,$timeout(function(){element.text(title)}))})}}}function sideNavigation($timeout){return{restrict:"A",link:function(scope,element){$timeout(function(){element.metisMenu()})}}}function responsiveVideo(){return{restrict:"A",link:function(scope,element){var figure=element,video=element.children();video.attr("data-aspectRatio",video.height()/video.width()).removeAttr("height").removeAttr("width"),$(window).resize(function(){var newWidth=figure.width();video.width(newWidth).height(newWidth*video.attr("data-aspectRatio"))}).resize()}}}function iboxTools($timeout){return{restrict:"A",scope:!0,templateUrl:"views/common/ibox_tools.html",controller:function($scope,$element){$scope.showhide=function(){var ibox=$element.closest("div.ibox"),icon=$element.find("i:first");ibox.find("div.ibox-content").slideToggle(200),icon.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),ibox.toggleClass("").toggleClass("border-bottom"),$timeout(function(){ibox.resize(),ibox.find("[id^=map-]").resize()},50)},$scope.closebox=function(){$element.closest("div.ibox").remove()}}}}function iboxToolsFullScreen($timeout){return{restrict:"A",scope:!0,templateUrl:"views/common/ibox_tools_full_screen.html",controller:function($scope,$element){$scope.showhide=function(){var ibox=$element.closest("div.ibox"),icon=$element.find("i:first");ibox.find("div.ibox-content").slideToggle(200),icon.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),ibox.toggleClass("").toggleClass("border-bottom"),$timeout(function(){ibox.resize(),ibox.find("[id^=map-]").resize()},50)},$scope.closebox=function(){$element.closest("div.ibox").remove()},$scope.fullscreen=function(){var ibox=$element.closest("div.ibox"),button=$element.find("i.fa-expand");$("body").toggleClass("fullscreen-ibox-mode"),button.toggleClass("fa-expand").toggleClass("fa-compress"),ibox.toggleClass("fullscreen"),setTimeout(function(){$(window).trigger("resize")},100)}}}}function minimalizaSidebar($timeout){return{restrict:"A",template:'<a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="" ng-click="minimalize()"><i class="fa fa-bars"></i></a>',controller:function($scope,$element){$scope.minimalize=function(){$("body").toggleClass("mini-navbar"),!$("body").hasClass("mini-navbar")||$("body").hasClass("body-small")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(200)},100)):$("body").hasClass("fixed-sidebar")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(200)},300)):($("#side-menu").removeAttr("style"),$("body.mini-navbar .navbar-static-side").css("height",$(window).height()+"px"))}}}}function closeSidebar(){return{restrict:"A",link:function(scope,element){$(".nav-label").click(function(){$("body").removeClass("mini-navbar")})}}}function closeOffCanvas(){return{restrict:"A",template:'<a class="close-canvas-menu" ng-click="closeOffCanvas()"><i class="fa fa-times"></i></a>',controller:function($scope,$element){$scope.closeOffCanvas=function(){$("body").toggleClass("mini-navbar")}}}}function vectorMap(){return{restrict:"A",scope:{myMapData:"="},link:function(scope,element,attrs){element.vectorMap({map:"world_mill_en",backgroundColor:"transparent",regionStyle:{initial:{fill:"#e4e4e4","fill-opacity":.9,stroke:"none","stroke-width":0,"stroke-opacity":0}},series:{regions:[{values:scope.myMapData,scale:["#1ab394","#22d6b1"],normalizeFunction:"polynomial"}]}})}}}function sparkline(){return{restrict:"A",scope:{sparkData:"=",sparkOptions:"="},link:function(scope,element,attrs){scope.$watch(scope.sparkData,function(){render()},!0),scope.$watch(scope.sparkOptions,function(){render()});var render=function(){$(element).sparkline(scope.sparkData,scope.sparkOptions)}}}}function icheck($timeout){return{restrict:"A",require:"ngModel",link:function($scope,element,$attrs,ngModel){return $timeout(function(){var value;return value=$attrs.value,$scope.$watch($attrs.ngModel,function(newValue){$(element).iCheck("update")}),$(element).iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green"}).on("ifChanged",function(event){if("checkbox"===$(element).attr("type")&&$attrs.ngModel&&$scope.$apply(function(){return ngModel.$setViewValue(event.target.checked)}),"radio"===$(element).attr("type")&&$attrs.ngModel)return $scope.$apply(function(){return ngModel.$setViewValue(value)})})})}}}function ionRangeSlider(){return{restrict:"A",scope:{rangeOptions:"="},link:function(scope,elem,attrs){elem.ionRangeSlider(scope.rangeOptions)}}}function dropZone(){return function(scope,element,attrs){element.dropzone({url:"/upload",maxFilesize:100,paramName:"uploadfile",maxThumbnailFilesize:5,init:function(){scope.files.push({file:"added"}),this.on("success",function(file,json){}),this.on("addedfile",function(file){scope.$apply(function(){alert(file),scope.files.push({file:"added"})})}),this.on("drop",function(file){alert("file")})}})}}function chatSlimScroll($timeout){return{restrict:"A",link:function(scope,element){$timeout(function(){element.slimscroll({height:"234px",railOpacity:.4})})}}}function customValid(){return{require:"ngModel",link:function(scope,ele,attrs,c){scope.$watch(attrs.ngModel,function(){"Co-Pilot"==scope.extras?c.$setValidity("cvalid",!0):c.$setValidity("cvalid",!1)})}}}function fullScroll($timeout){return{restrict:"A",link:function(scope,element){$timeout(function(){element.slimscroll({height:"100%",railOpacity:.9})})}}}function slimScroll($timeout){return{restrict:"A",scope:{boxHeight:"@"},link:function(scope,element){$timeout(function(){element.slimscroll({height:scope.boxHeight,railOpacity:.9})})}}}function clockPicker(){return{restrict:"A",link:function(scope,element){element.clockpicker()}}}function landingScrollspy(){return{restrict:"A",link:function(scope,element,attrs){element.scrollspy({target:".navbar-fixed-top",offset:80})}}}function fitHeight(){return{restrict:"A",link:function(scope,element){element.css("height",$(window).height()+"px"),element.css("min-height",$(window).height()+"px")}}}function categoryHeader(){return{templateUrl:"scripts/directives/category_header.html",link:function(scope){var cols=scope.gridOptions.columnDefs;!function(){scope.headerRowHeight=30,scope.catHeaderRowHeight=scope.headerRowHeight+"px",scope.categories=[];var lastDisplayName="",totalWidth=0,left=0;cols=scope.gridOptions.columnDefs;for(var i=0;i<cols.length;i++){totalWidth+=Number(cols[i].width);var displayName=void 0===cols[i].categoryDisplayName?" ":cols[i].categoryDisplayName;displayName!==lastDisplayName&&(scope.categories.push({displayName:lastDisplayName,width:totalWidth-Number(cols[i].width),widthPx:totalWidth-Number(cols[i].width)+"px",left:left,leftPx:left+"px"}),left+=totalWidth-Number(cols[i].width),totalWidth=Number(cols[i].width),lastDisplayName=displayName)}totalWidth>0&&scope.categories.push({displayName:lastDisplayName,width:totalWidth,widthPx:totalWidth+"px",left:left,leftPx:left+"px"})}()}}}angular.module("edriving").constant("VERSION_DEF",VERSION_DEF),angular.module("edriving").constant("PREDEFINED_COMMENTS",{PREDEFINED_COMMENTS_HIGHPRIORITY:{"BODY-HOLE":1,"BODY-ITEM_HANGING_DOWN":1,"BODY-SCRATCH_LARGER_THAN_BILL":2,"BRAKE-PARKING-LOOSE":1,"BRAKE-SERVICE-GRINDING":1,"BRAKE-SERVICE-NOT_STOP":1,"BRAKE-SERVICE-SINK_TO_FLOORMAT":1,"BRAKE-SERVICE-SQUEAKING":2,"BRANDING-BADGE":2,"BRANDING-DIRTY":2,"CAMERA-BACKUP_MISSING":1,"CAMERA-DISPLAY":1,"CAMERA-NOT_TURN_ON":1,"DASHBOARD-DEF_ADBLUE":1,"DASHBOARD-ENGINE":1,"DASHBOARD-OTHER":1,DELIVERY:2,"DELIVERY-DAMAGED":1,"DELIVERY-MISSING":1,DOORS:1,HORN:1,"LICENSE-PLATE_DAMAGED":1,"LICENSE-PLATE_DIRTY":2,"LICENSE-PLATE_EXPIRED":1,"LIGHTS-BRAKE_LIGHT":1,"LIGHTS-COVER":1,"LIGHTS-HEADLIGHTS":1,"LIGHTS-INTERNAL":1,"LIGHTS-TURN_LIGHT":1,"LIGHTS-HAZARD":1,"LIGHTS-LICENCE":1,SEATBELT:1,"SIDE_MIRROR-NOT_OBSTRUCTED":2,"SIDE_MIRROR-OBSTRUCTED":1,"TIRE-FLAT":1,"TIRE-HAS_OBJECTS":1,"TIRE-TREAD_BELOW_INDICATOR":1,"WINDSHIELD-CRACKS":1,"WINDSHIELD-NOT_OBSTRUCTED":2,"WINDSHIELD-OBSTRUCTED":1,"WIPER-DAMAGE":1,"WIPER-DEFROSTER":1,"WIPER-WASHER":1,"WINDSHIELD-CRACKS_OVER":1,"WIPER-NOT_PRESENT":1,"SIDE_MIRROR-NOT_PRESENT":1,"SIDE_MIRROR-CRACKS":1,"BODY-ITEMS_LOOSE":1,"BODY-LARGE_DENTS":1,"LIGHT_C&R-BROKEN":1,"LIGHTS-HEADLIGHTS_NO":1,"LIGHTS-FLASHERS_NO":1,"TIRE-TREAD":1,"TIRE-OBJECTS":1,"TIRE-VISIBILY_FLAT":1,"PACKAGES-MISPLACED":1,"UNIFORMS-MISSING":2,"CREDENTIALS-ID":2,"UNIFORMS-TOP":2,"UNIFORMS-BOT":2,"CREDENTIALS-FACE_ID":2,"CREDENTIALS-FACE_BADGE":2,"CREDENTIALS-FACE_RABBIT":2,"CREDENTIALS-ID_RABBIT":2,"CREDENTIALS-ID_BADGE":2,"CREDENTIALS-BADGE_RABBIT":2,"CREDENTIALS-ALL":2,"AC_HEATING-AC":1,"AC_HEATING-HEATING":1,"SAFETY_ACC-DDC":1,"SAFETY_ACC-OTHER":1,"BRAKES-PEDAL":1,"BRAKES-OTHER":1},PREDEFINED_COMMENTS_TEXT:{"BODY-HOLE":"Hole/puncture are present","BODY-ITEM_HANGING_DOWN":"Items attached to the body of the vehicle are loose or missing.","BODY-SCRATCH_LARGER_THAN_BILL":"Scratch/Dent/Chips are present and larger than a dollar bill or credit card.","BRAKE-PARKING-LOOSE":"Parking brake is loose or no braking occurs.","BRAKE-SERVICE-GRINDING":"There is grinding.","BRAKE-SERVICE-NOT_STOP":"Vehicle does not stop properly.","BRAKE-SERVICE-SINK_TO_FLOORMAT":" It sinks all the way to the floor mat.","BRAKE-SERVICE-SQUEAKING":"There is squeaking.","BRANDING-BADGE":"Amazon Prime Badge is not visible or not in good condition.","BRANDING-DIRTY":"Amazon Van is dirty.","CAMERA-BACKUP_MISSING":"The external back-up camera is missing.","CAMERA-DISPLAY":"The rear-view display monitor is mirror imaged.","CAMERA-NOT_TURN_ON":"The rear-view display monitor does not come on.","DASHBOARD-DEF_ADBLUE":"DEF AdBlue indicator light stays on.","DASHBOARD-ENGINE":"Check engine light stays on.","DASHBOARD-OTHER":"Other warning lights stay on.",DELIVERY:"Cradle is damaged or missing.",DOORS:"Any doors can't open/close/lock from the outside.",HORN:"Horn not functional.","LICENSE-PLATE_DAMAGED":"License plates/temp tags are damaged or missing.","LICENSE-PLATE_DIRTY":"License plates/tmp tags are dirty","LICENSE-PLATE_EXPIRED":"License plates/temp tags have expired.","LIGHTS-BRAKE_LIGHT":"Some or no Brake lights come on.","LIGHTS-COVER":"Reflectors/light covers are broken.","LIGHTS-HEADLIGHTS":"One or any headlights are out.","LIGHTS-INTERNAL":"Internal or rear compartment lights do not come on.","LIGHTS-TURN_LIGHT":" One or any turn/indicator signals are not working.",SEATBELT:"Seat belt does not buckle or is missing.","SIDE_MIRROR-NOT_OBSTRUCTED":"Damage does not obstruct the driver’s line of sight.","SIDE_MIRROR-OBSTRUCTED":"Missing mirror, distortion, or damage obstructs the driver’s line of sight.","TIRE-FLAT":"Tire is losing air or visibly flat.","TIRE-HAS_OBJECTS":"Tire has objects, sidewall bulges, or cuts to tire tread/surface.","TIRE-TREAD_BELOW_INDICATOR":"Tread is below the tread indicator.","WINDSHIELD-CRACKS":"3 or more cracks/chips are present","WINDSHIELD-NOT_OBSTRUCTED":"Damage does not obstruct the driver’s line of sight.","WINDSHIELD-OBSTRUCTED":"Damage obstructs the driver’s line of sight.","WIPER-DAMAGE":"Wipers are damaged, missing or do not turn on.","WIPER-DEFROSTER":"Defroster is not functional.","WIPER-WASHER":"Windshield Wiper/Washer System is not functional."},CATEGORY_NAME_20190312:{"BODY-FRONT_DRIVER_SIDE":"Body Damage, Front Driver Side","BODY-REAR_DRIVER_SIDE":"Body Damage, Rear Driver Side","BODY-FRONT_PASSENGER_SIDE":"Body Damage, Front Passenger Side","BODY-REAR_PASSENGER_SIDE":"Body Damage, Rear Passenger Side","BODY-FRONT_SIDE":"Body Damage, Front Side","BODY-REAR_SIDE":"Body Damage, Rear Side","BODY-UNDERCARRIAGE":"Body Damage, Under Carriage","BRAKE-SERVICE":"Brakes, Service Brake","BRAKE-PARKING":"Brakes, Parking Brake,","BRANDING-EXTERIOR":"Branding, Exterior","CAMERA-DISPLAY":"Camera, Display Monitor","CAMERA-EXTERIOR_CAMERA":"Camera, Exterior Camera",DASHBOARD:"Dashboard Indicator Lights, Dashboard","DELIVERY-INTERIOR":" Delivery Device Cradle, Interior","DOORS-DRIVER_SIDE":"Doors, Driver Side","DOORS-PASSENGER_SIDE":"Doors, Passenger Side","DOORS-REAR_SIDE":"Doors, Rear Side","DOORS-SLIDING_DOOR":"Doors, Sibling Side",HORN:"Horn, Horn","LICENSE-FRONT_BUMPER":"License Plates/Temporary Tags,  Front Bumper","LICENSE-REAR_BUMPER":"License Plates/Temporary Tags,  Rear Bumper","LIGHTS-FRONT_DRIVER_SIDE":"Lights, Front Driver Side","LIGHTS-REAR_DRIVER_SIDE":"Lights, Rear Driver Side","LIGHTS-FRONT_PASSENGER_SIDE":"Lights, Front Passenger Side","LIGHTS-REAR_PASSENGER_SIDE":"Lights, Rear Passenger Side","LIGHTS-INTERIOR":"Lights, Interior","SEATBELT-DRIVER_SIDE":"Safety/Seat Belts, Driver Side","SEATBELT-PASSENGER_SIDE":"Safety/Seat Belts, Passenger Side","SIDE_MIRROR-DRIVER_SIDE":"Side Mirror,  Driver Side","SIDE_MIRROR-PASSENGER_SIDE":"Side Mirror,  Passenger Side","TIRE-FRONT_DRIVER_SIDE":"Tire,  Front Driver Side","TIRE-REAR_DRIVER_SIDE":"Tire,  Rear Driver Side","TIRE-FRONT_PASSENGER_SIDE":"Tire, Front Passenger Side","TIRE-REAR_PASSENGER_SIDE":"Tire,  Front Passenger Side","WINDSHIELD-DRIVER_SIDE":"Windshield,  Driver Side","WINDSHIELD-PASSENGER_SIDE":"Windshield,  Passenger Side","WIPER-FRONT_SIDE":"Wiper, Front Side","WIPER-DRIVER_SIDE":"Wiper, Driver Side","WIPER-REAR_SIDE":"Wiper, Rear Side"},PREDEFINED_COMMENTS_TEXT_AUDIT:{"WINDSHIELD-CRACKS_OVER":"Cracks over the steering wheels.","WIPER-NOT_PRESENT":"Wipers are not present.","SIDE_MIRROR-NOT_PRESENT":"Side mirrors are not present.","SIDE_MIRROR-CRACKS":"Side mirrors have cracks.","BODY-ITEMS_LOOSE":"Items attached to the body (such as Side Mirrors, Steps, Bumpers etc.) of the vehicle are loose hanging or held with a zip tie or tape.","BODY-LARGE_DENTS":"Large dents in the hood, fender or door.","LIGHT_C&R-BROKEN":"Light Covers or Reflectors are broken.","LIGHTS-HEADLIGHTS_NO":"Headlights are not operational.","LIGHTS-FLASHERS_NO":"Emergency Flashers are not operational.","TIRE-TREAD":"Tread depth is less than 2/32","TIRE-OBJECTS":"Objects/cuts/buldge to the surface or Tread.","TIRE-VISIBILY_FLAT":"Tire is visibly flat.","PACKAGES-MISPLACED":"Packages on seat or dashboard.","UNIFORMS-MISSING":"The DA does not have on a branded Top and Bottom.","UNIFORMS-TOP":"The DA does not have a branded Top.","UNIFORMS-BOT":"The DA does not have a branded Bottom.","CREDENTIALS-ID":"Driver's face, ID and Rabbit Device login all matches.","CREDENTIALS-FACE_ID":"Face does not match ID.","CREDENTIALS-FACE_BADGE":"Face does not match badge.","CREDENTIALS-FACE_RABBIT":"Face does not match Rabbit app.","CREDENTIALS-ID_RABBIT":"ID does not match Rabbit app.","CREDENTIALS-ID_BADGE":"ID does not match badge.","CREDENTIALS-BADGE_RABBIT":"Badge does not match Rabbit app.","CREDENTIALS-ALL":"Face, ID, badge and Rabbit app do not match.","AC_HEATING-AC":"AC is not working properly.","AC_HEATING-HEATING":"Heating is not working properly.","SAFETY_ACC-DDC":"Delivery Device Cradle is not present or broken.","SAFETY_ACC-OTHER":"","BRAKES-PEDAL":"Foot/Service brake pedal is not operational.","BRAKES-OTHER":"",OTHER_AUDIT:""},CATEGORY_NAME_AUDIT:{"BODY-FRONT_DRIVER_SIDE":"Body Damage, Front Driver Side","BODY-REAR_DRIVER_SIDE":"Body Damage, Rear Driver Side","BODY-FRONT_PASSENGER_SIDE":"Body Damage, Front Passenger Side","BODY-REAR_PASSENGER_SIDE":"Body Damage, Rear Passenger Side","BODY-FRONT_SIDE":"Body Damage, Front Side","BODY-REAR_SIDE":"Body Damage, Rear Side","BODY-UNDERCARRIAGE":"Body Damage, Under Carriage","BRAKE-SERVICE":"Brakes, Service Brake","BRAKE-PARKING":"Brakes, Parking Brake,","BRANDING-EXTERIOR":"Branding, Exterior","CAMERA-DISPLAY":"Camera, Display Monitor","CAMERA-EXTERIOR_CAMERA":"Camera, Exterior Camera",DASHBOARD:"Dashboard Indicator Lights, Dashboard","DELIVERY-INTERIOR":" Delivery Device Cradle, Interior","DOORS-DRIVER_SIDE":"Doors, Driver Side","DOORS-PASSENGER_SIDE":"Doors, Passenger Side","DOORS-REAR_SIDE":"Doors, Rear Side","DOORS-SLIDING_DOOR":"Doors, Sibling Side",HORN:"Horn, Horn","LICENSE-FRONT_BUMPER":"License Plates/Temporary Tags,  Front Bumper","LICENSE-REAR_BUMPER":"License Plates/Temporary Tags,  Rear Bumper","LIGHTS-FRONT_DRIVER_SIDE":"Lights, Front Driver Side","LIGHTS-REAR_DRIVER_SIDE":"Lights, Rear Driver Side","LIGHTS-FRONT_PASSENGER_SIDE":"Lights, Front Passenger Side","LIGHTS-REAR_PASSENGER_SIDE":"Lights, Rear Passenger Side","LIGHTS-INTERIOR":"Lights, Interior","SEATBELT-DRIVER_SIDE":"Safety/Seat Belts, Driver Side","SEATBELT-PASSENGER_SIDE":"Safety/Seat Belts, Passenger Side","SIDE_MIRROR-DRIVER_SIDE":"Side Mirror,  Driver Side","SIDE_MIRROR-PASSENGER_SIDE":"Side Mirror,  Passenger Side","TIRE-FRONT_DRIVER_SIDE":"Tire/Tyre,  Front Driver Side","TIRE-REAR_DRIVER_SIDE":"Tire/Tyre,  Rear Driver Side","TIRE-FRONT_PASSENGER_SIDE":"Tire/Tyre, Front Passenger Side","TIRE-REAR_PASSENGER_SIDE":"Tire/Tyre,  Front Passenger Side","WINDSHIELD-DRIVER_SIDE":"Windshield,  Driver Side","WINDSHIELD-PASSENGER_SIDE":"Windshield,  Passenger Side","WIPER-FRONT_SIDE":"Wiper, Front Side","WIPER-DRIVER_SIDE":"Wiper, Driver Side","WIPER-REAR_SIDE":"Wiper, Rear Side","TIRE-DRIVER_SIDE":"Tire, Driver Side","TIRE-PASSENGER_SIDE":"Tire, Passenger Side","LIGHT_C&R-FRONT_DRIVER_SIDE":"Light covers and reflectors, Front Driver Side","LIGHT_C&R-REAR_DRIVER_SIDE":"Light covers and reflectors, Rear Driver Side","LIGHT_C&R-FRONT_PASSENGER_SIDE":"Light covers and reflectors, Front Passenger Side","LIGHT_C&R-REAR_PASSENGER_SIDE":"Light covers and reflectors, Rear Passenger Side","LIGHT_C&R-INTERIOR":"Light covers and reflectors, Interior",PACKAGES:"Packages",UNIFORMS:"Uniforms",CREDENTIALS:"Credentials","CREDENTIALS-ALL_MATCH":"Credentials, Does the face/badge/ID and Rabbit app all match?","CREDENTIALS-DRIVERS_LICENSE":"Credentials, Is the driver's license valid?",AC_HEATING:"AC/Heating",SAFETY_ACC:"Safety Accessories",BRAKES:"Brakes"}}),angular.module("edriving").directive("pageTitle",pageTitle).directive("sideNavigation",sideNavigation).directive("closeSidebar",closeSidebar).directive("iboxTools",iboxTools).directive("minimalizaSidebar",minimalizaSidebar).directive("vectorMap",vectorMap).directive("sparkline",sparkline).directive("icheck",icheck).directive("ionRangeSlider",ionRangeSlider).directive("dropZone",dropZone).directive("responsiveVideo",responsiveVideo).directive("chatSlimScroll",chatSlimScroll).directive("customValid",customValid).directive("fullScroll",fullScroll).directive("closeOffCanvas",closeOffCanvas).directive("clockPicker",clockPicker).directive("landingScrollspy",landingScrollspy).directive("fitHeight",fitHeight).directive("iboxToolsFullScreen",iboxToolsFullScreen).directive("slimScroll",slimScroll).directive("categoryHeader",categoryHeader),angular.module("edriving").directive("passwordStrength",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModel){var indicator=element.children(),dots=Array.prototype.slice.call(indicator.children()),weakest=dots.slice(-1)[0],weak=dots.slice(-2),strong=dots.slice(-3),strongest=dots.slice(-4);element.after(indicator),element.bind("keyup",function(){var tmp,matches={positive:{},negative:{}},counts={positive:{},negative:{}},strength=0;angular.forEach(dots,function(el){el.style.backgroundColor="#ebeef1"}),ngModel.$viewValue&&(matches.positive.lower=ngModel.$viewValue.match(/[a-z]/g),matches.positive.upper=ngModel.$viewValue.match(/[A-Z]/g),matches.positive.numbers=ngModel.$viewValue.match(/\d/g),matches.positive.symbols=ngModel.$viewValue.match(/[$-/:-?{-~!^_`\[\]]/g),matches.positive.middleNumber=ngModel.$viewValue.slice(1,-1).match(/\d/g),matches.positive.middleSymbol=ngModel.$viewValue.slice(1,-1).match(/[$-/:-?{-~!^_`\[\]]/g),counts.positive.lower=matches.positive.lower?matches.positive.lower.length:0,counts.positive.upper=matches.positive.upper?matches.positive.upper.length:0,counts.positive.numbers=matches.positive.numbers?matches.positive.numbers.length:0,counts.positive.symbols=matches.positive.symbols?matches.positive.symbols.length:0,counts.positive.numChars=ngModel.$viewValue.length,tmp+=counts.positive.numChars>=8?1:0,counts.positive.requirements=tmp>=3?tmp:0,counts.positive.middleNumber=matches.positive.middleNumber?matches.positive.middleNumber.length:0,counts.positive.middleSymbol=matches.positive.middleSymbol?matches.positive.middleSymbol.length:0,matches.negative.consecLower=ngModel.$viewValue.match(/(?=([a-z]{2}))/g),matches.negative.consecUpper=ngModel.$viewValue.match(/(?=([A-Z]{2}))/g),matches.negative.consecNumbers=ngModel.$viewValue.match(/(?=(\d{2}))/g),matches.negative.onlyNumbers=ngModel.$viewValue.match(/^[0-9]*$/g),matches.negative.onlyLetters=ngModel.$viewValue.match(/^([a-z]|[A-Z])*$/g),counts.negative.consecLower=matches.negative.consecLower?matches.negative.consecLower.length:0,counts.negative.consecUpper=matches.negative.consecUpper?matches.negative.consecUpper.length:0,counts.negative.consecNumbers=matches.negative.consecNumbers?matches.negative.consecNumbers.length:0,strength+=4*counts.positive.numChars,counts.positive.upper&&(strength+=2*(counts.positive.numChars-counts.positive.upper)),counts.positive.lower&&(strength+=2*(counts.positive.numChars-counts.positive.lower)),(counts.positive.upper||counts.positive.lower)&&(strength+=4*counts.positive.numbers),strength+=6*counts.positive.symbols,strength+=2*(counts.positive.middleSymbol+counts.positive.middleNumber),strength+=2*counts.positive.requirements,strength-=2*counts.negative.consecLower,strength-=2*counts.negative.consecUpper,strength-=2*counts.negative.consecNumbers,matches.negative.onlyNumbers&&(strength-=counts.positive.numChars),matches.negative.onlyLetters&&(strength-=counts.positive.numChars),(strength=Math.max(0,Math.min(100,Math.round(strength))))>85?angular.forEach(strongest,function(el){el.style.backgroundColor="#008cdd"}):strength>65?angular.forEach(strong,function(el){el.style.backgroundColor="#6ead09"}):strength>30?angular.forEach(weak,function(el){el.style.backgroundColor="#e09115"}):weakest.style.backgroundColor="#e01414")})},template:'<span class="password-strength-indicator"><span></span><span></span><span></span><span></span></span>'}}),angular.module("edriving").directive("passwordMatch",function(){return{require:"ngModel",scope:{otherModelValue:"=passwordMatch"},link:function(scope,element,attributes,ngModel){ngModel.$validators.compareTo=function(modelValue){return modelValue===scope.otherModelValue},scope.$watch("otherModelValue",function(){ngModel.$validate()})}}}),angular.module("edriving").directive("autoFocus",function($timeout){return{restrict:"AC",link:function(_scope,_element){$timeout(function(){_element[0].focus()},0)}}}),angular.module("edriving").directive("weekPicker",function($timeout){return{scope:{value:"=",trigger:"&",datePicked:"=",interval:"@",maxDate:"@",fetchExact:"="},controller:function($scope,$element,$attrs,$transclude,moment){function getFormattedDate(date){return date=new Date(date),moment(date).format("MMM DD")}function getLastSaturday(d){return moment(d).add(-7,"days").endOf("week").format("MM/DD/YYYY")}$scope.s_period="Week",$scope.init_happen=!1,$scope.triggered=!1,$scope.intervalChange=function(){var date=new Date;$scope.maxDate=date.toDateString(),$scope.showCalendar=!1,$scope.showMonthCalendar=!1,"monthly"===$scope.interval&&($scope.s_period="Month",date=moment(date,"MM/DD/YYYY").add(-1,"months")),"weekly"===$scope.interval&&($scope.s_period="Week",date=getLastSaturday(new Date),$scope.maxDate=date),"daily"===$scope.interval&&($scope.s_period="Date",date=moment(date,"MM/DD/YYYY").add(-1,"days"),1==$scope.fetchExact&&(date=moment(date,"MM/DD/YYYY")),$scope.maxDate||($scope.maxDate=date)),$scope.changeDate(date)},$scope.$watch("interval",function(){$scope.interval&&$scope.intervalChange()}),$scope.formData={},$scope.data={},$scope.dateOptions={formatYear:"yy",startingDay:0,showWeeks:"false"},this.$onInit=function(){$scope.showMonthCalendar=!1,$scope.value?$scope.date=$scope.value:$scope.date=getLastSaturday(new Date),$timeout(function(){$("body").click(function(e){for(var classList=e.target.className.split(/\s+/),i=0;i<classList.length;i++)if(classList[i].indexOf("_720kb-datepicker")>=0)return;$scope.showCalendar=!1,$scope.showMonthCalendar=!1,$scope.$apply()})},500)},$scope.calendarClicked=function(e){e.stopPropagation(),$scope.showCalendar=!0,$scope.showMonthCalendar=!1,$("#txtWeekpicker").css("display","block"),"monthly"===$scope.interval&&($scope.showMonthCalendar=!0,$("#txtWeekpicker").css("display","none"))},$scope.monthChanged=function(a,b){$scope.showCalendar=!1,$scope.showMonthCalendar=!1;var year=b,month=a;$scope.interval="monthly",$scope.changeDate(moment().day(1).month(month-1).year(year).format("MM/DD/YYYY"))},$scope.changeDate=function(dateVal){if(dateVal&&NaN!=Date.parse(dateVal)&&""!=dateVal){$scope.showCalendar=!1,$scope.showMonthCalendar=!1;var today=moment(dateVal,"MM/DD/YYYY");$scope.value=today;var sunday=moment(today).startOf("week").format("MM/DD/YYYY"),saturday=function(d){return moment(d).endOf("week").format("MM/DD/YYYY")}(today);$scope.datePicked=getFormattedDate(sunday)+" - "+getFormattedDate(saturday);var date,start_day=sunday;"daily"===$scope.interval&&($scope.s_period="Date",$scope.datePicked=getFormattedDate(today),start_day=today),"monthly"===$scope.interval&&(today.format("MM"),$scope.datePicked=(date=today,date=new Date(date),moment(date).format("MMM")),start_day=today),0==$scope.triggered&&($scope.trigger({start:start_day}),$scope.triggered=!0,setTimeout(()=>{$scope.triggered=!1},1e3))}},$scope.$watch("date",function(dateVal){$scope.date&&$scope.changeDate(dateVal)})},controllerAs:"ctrl1",link:function($scope,iElm,iAttrs,ctrl1){},restrict:"E",templateUrl:"views/directives/weekPicker.html"}}),angular.module("edriving").directive("ngConfirmClick",[function(){return{link:function(scope,element,attr){var msg=attr.ngConfirmClick||"Are you sure?",clickAction=attr.confirmedClick;element.bind("click",function(event){window.confirm(msg)&&scope.$eval(clickAction)})}}}]),angular.module("edriving").directive("gridWeeklyPerform",function($timeout){return{scope:{data:"=",ready:"=",partView:"=",group:"=",option:"=",fileName:"=",client:"=",partViewConfig:"=",hideKey:"="},controller:function($scope,$element,$attrs,$transclude,uiGridConstants,uiGridExporterService,uiGridExporterConstants){this.$onInit=function(){$scope.filterCol||($scope.filterCol=0),$timeout(function(){$scope.partViewChange()},2e3)};$scope.gridOptions={paginationPageSizes:[10,15,20,25],paginationPageSize:10,visible:!1,enableSorting:!0,enableGridMenu:!1,exporterMenuCsv:!0,exporterMenuPdf:!1,exporterMenuExcel:!1,exporterMenuVisibleData:!1,exporterCsvFilename:"driver_daily_report_.csv",exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location")),gridMenuShowHideColumns:!1,enableColumnMenus:!1,enableFiltering:!0,enableHorizontalScrollbar:!0,enableColumnResizing:!0,rowHeight:42,category:[{name:"PII",visible:!0},{name:"Performance Summary",visible:!0},{name:"Events",visible:!0},{name:"Training",visible:!0},{name:"Comparison by Percentage",visible:!0}],columnDefs:[],onRegisterApi:function(gridApi){gridApi.core.on.renderingComplete($scope,function(){}),$scope.gridApi=gridApi}},$scope.$watchCollection("data",function(){$scope.gridOptions.data=$scope.data}),$scope.getTableHeight=function(){var height=$(window).height()-250;return height>300?height:"500"},$scope.$watch("data",function(){$scope.partViewChange()}),$scope.$watch("ready",function(){!0===$scope.ready&&$scope.exportCSV2(),$scope.ready=!1}),$scope.$watch("group",function(){($scope.group||""==$scope.group)&&($scope.gridApi.grid.columns[$scope.gridApi.grid.columns.length-1].filters[0].term=$scope.group,$scope.gridApi.core.refresh())}),$scope.exportCSV=function(){var grid=$scope.gridApi.grid,rowTypes=uiGridExporterConstants.ALL,colTypes=uiGridExporterConstants.ALL;uiGridExporterService.csvExport(grid,rowTypes,colTypes)},$scope.exportCSV2=function(){var exportService=uiGridExporterService,grid=$scope.gridApi.grid,fileName=$scope.fileName+".csv";exportService.loadAllDataIfNeeded(grid,uiGridExporterConstants.ALL,uiGridExporterConstants.VISIBLE).then(function(){var exportColumnHeaders=exportService.getColumnHeaders(grid,uiGridExporterConstants.VISIBLE),exportData=exportService.getData(grid,uiGridExporterConstants.ALL,uiGridExporterConstants.VISIBLE),csvContent=exportService.formatAsCsv(exportColumnHeaders,exportData,grid.options.exporterCsvColumnSeparator);exportService.downloadFile(fileName,csvContent,grid.options.exporterOlderExcelCompatibility)})},$scope.$watch("option",function(){$scope.option&&($scope.gridOptions=$scope.option,$scope.gridApi.core.refresh())}),$scope.partViewChange=function(){if($scope.partViewConfig&&0!=$scope.gridOptions.columnDefs.length){var changes=$scope.partViewConfig;1==$scope.partView?changes.map(function(el){for(var key in el){var val=el[key];$scope.gridOptions.columnDefs[parseInt(key)].visible=val}}):changes.map(function(el){for(var key in el){var val=el[key];if($scope.gridOptions.columnDefs[parseInt(key)].visible=!val,$scope.hideKey)for(let i=0;i<$scope.hideKey.length;i++)$scope.hideKey[i]==parseInt(key)&&($scope.gridOptions.columnDefs[parseInt(key)].visible=!1)}}),$scope.gridApi.core.refresh()}},$scope.$watch("partView",function(){$scope.partViewChange()})},controllerAs:"ctrl1",link:function($scope,iElm,iAttrs,ctrl1){},restrict:"E",templateUrl:"views/directives/gridWeeklyPerform.html"}}),angular.module("edriving").directive("scorebar",function($timeout){return{scope:{value:"="},controller:function($scope,$element,$attrs,$transclude){},controllerAs:"ctrl1",link:function($scope,iElm,iAttrs,ctrl1){var unwatch=$scope.$watch("value",function(newVal,oldVal){if(newVal){var t=newVal;console.log(t),0==t||(t<333?(ctrl1.nglabel="Bad",ctrl1.ngbgcolor="label-bad",ctrl1.ngclass="danger"):t<666?(ctrl1.nglabel="Medium",ctrl1.ngbgcolor="label-avg",ctrl1.ngclass="warning"):(ctrl1.nglabel="Good",ctrl1.ngbgcolor="label-good",ctrl1.ngclass="success")),unwatch()}else ctrl1.nglabel="",ctrl1.ngbgcolor="label-loading",ctrl1.ngclass="loading"})},restrict:"E",template:'<div class="col-xs-6"><h1>{{value}}</h1></div><div class="col-xs-6" ng-class="ctrl1.ngbgcolor">{{ctrl1.nglabel}}</div><div class="col-xs-12"><uib-progressbar class="{{ctrl1.ngclass}}" max="1000" value="value"  type={{ctrl1.ngclass}}><i></i></uib-progressbar></div>'}}),angular.module("edriving").directive("monthCalendar",function($timeout){return{scope:{monthPicked:"=",monthChanged:"&"},controller:function($scope,$element,$attrs,$transclude,moment){this.$onInit=function(){var m=moment(new Date);m=m.startOf("month"),$scope.year=m.format("YYYY"),$scope.thisYear=$scope.year,$scope.thisMonth=m.format("MM"),$scope.month=m.add(-1,"months").format("MM")},$scope.yearChange=function(d,evt){if(evt.stopPropagation(),d>0){if($scope.year+1>$scope.thisYear)return;$scope.year++}else $scope.year--},$scope.getClass=function(month){return month==$scope.month?"chosen":$scope.year==$scope.thisYear?month>=$scope.thisMonth?"disabledMonth":"":void 0},$scope.select=function(month,evt){evt.stopPropagation(),$scope.year==$scope.thisYear&&month>=$scope.thisMonth||($scope.month=month,$(".chosen").removeClass("chosen"),$(evt.target).addClass("chosen"),$scope.monthChanged({month:$scope.month,year:$scope.year}))}},controllerAs:"ctrl1",link:function($scope,iElm,iAttrs,ctrl1){},restrict:"E",templateUrl:"views/directives/monthCalendar.html"}}),angular.module("edriving").directive("ngTranslateLanguageSelect",function(LocaleService){"use strict";return{restrict:"A",replace:!0,template:'<div class="language-select" ng-if="visible"><label style="color:red"><b>{{"directives.language-select.Language" | translate}}</b>:<select ng-model="currentLocaleDisplayName"ng-options="localesDisplayName for localesDisplayName in localesDisplayNames"ng-change="changeLanguage(currentLocaleDisplayName)"></select></label></div>',controller:function($scope){$scope.currentLocaleDisplayName=LocaleService.getLocaleDisplayName(),$scope.localesDisplayNames=LocaleService.getLocalesDisplayNames(),$scope.visible=$scope.localesDisplayNames&&$scope.localesDisplayNames.length>1,$scope.changeLanguage=function(locale){LocaleService.setLocaleByDisplayName(locale)}}}}),angular.module("edriving").controller("FleetReportOnPeriodCtrl",function($scope,uiGridConstants,$loading,$rootScope,$http,$auth,toastr,Account,FleetService,$cookieStore,$log,$state,moment,$timeout,ClientReportSvc,$location){function isEmpty(obj){return 0===Object.keys(obj).length&&obj.constructor===Object}$scope.client,$scope.show_period=!1,$scope.selectTab=function(tab){$scope.selectedTab=tab},$scope.isTabSelected=function(tab){return $scope.selectedTab===tab},this.$onInit=function(){$scope.client=$state.params.client,$scope.show_period=!0,$scope.period=$state.params.period,$scope.show_compare=!1,$scope.checkCompare=!1,$scope.checkCompare?($(".form-check-label").addClass("checked"),$(".fa-check-square").show(),$(".fa-square-o").hide(),$scope.showTab=2):($(".form-check-label").removeClass("checked"),$(".fa-check-square").hide(),$(".fa-square-o").show(),$scope.showTab=1),$scope.period||($scope.period="weekly"),$scope.companyId,$rootScope.loggedInCompanyUser?$scope.companyId=$rootScope.loggedInCompanyUser.companyId:$rootScope.company&&($scope.companyId=$rootScope.company.id),$scope.initUserMap()},$scope.readyCsv=!1,$scope.data=[],$scope.$watch("checkCompare",function(){$scope.checkCompare?($(".form-check-label").addClass("checked"),$(".fa-check-square").show(),$(".fa-square-o").hide(),$scope.showTab=2):($(".form-check-label").removeClass("checked"),$(".fa-check-square").hide(),$(".fa-square-o").show(),$scope.showTab=1)}),$scope.showTab=1,$scope.loadReport=function(start){$scope.start=start,$scope.start?sessionStorage.setItem("start",$scope.start):$scope.start=sessionStorage.getItem("start"),$scope.start&&($scope.start.isValid&&!$scope.start.isValid()||$scope.usersMap&&!isEmpty($scope.usersMap)&&$rootScope.groupsMap&&!isEmpty($rootScope.groupsMap)&&(start=moment($scope.start,"MM/DD/YYYY").format("YYYY-MM-DD"),console.log(start),$scope.client?"amzl"==$scope.client&&($scope.gridOptions={visible:!1,enableSorting:!0,enableGridMenu:!1,exporterMenuCsv:!0,exporterMenuPdf:!1,exporterMenuExcel:!1,exporterMenuVisibleData:!1,exporterCsvFilename:"amzl_weekly_report_.csv",exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location")),gridMenuShowHideColumns:!1,enableColumnMenus:!1,enableFiltering:!0,enableHorizontalScrollbar:!0,enableColumnResizing:!0,rowHeight:42,category:[{name:"A",visible:!0}],columnDefs:[{category:"A",displayName:"Driver Name",field:"full_name",enableFiltering:!1,width:"15%",cellTemplate:'<div style="padding:5px"><a href="#!/{{row.entity.app}}/fleet-report-trend/{{row.entity.companyId}}/{{row.entity.groupId}}/{{row.entity.userId}}">{{row.entity.full_name}}</a></div>'},{category:"A",displayName:"STATION",field:"groupName",enableFiltering:!1,width:"15%",cellTemplate:'<div style="padding:5px"><a href="#!/{{row.entity.app}}/fleet-report-trend/{{row.entity.companyId}}/{{row.entity.groupId}}/0">{{row.entity.groupName}}</a></div>'},{category:"A",name:"Drivers",field:"tripStats.driverWithTripCount",enableFiltering:!1,visible:!1},{category:"A",name:"Trips",field:"tripStats.tripCount",enableFiltering:!1,type:"number"},{category:"A",name:"Miles",field:"tripStats.distance",enableFiltering:!1,type:"number"},{category:"B",name:"Mileage change",field:"mileage_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClass},{category:"A",name:"Time",field:"tripStats.duration",cellFilter:"duration",enableFiltering:!1,type:"number",width:"6%"},{category:"A",name:"FICO",field:"scores.TOTAL",enableFiltering:!1,type:"number"},{category:"B",name:"FICO change",field:"fico_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClass},{category:"A",name:"Accel",field:"accel_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/acceleration.svg" tooltips tooltip-template="Acceleration" tooltip-class="short" tooltip-append-to-body="true" height="22px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Braking",field:"breaking_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/braking.svg" tooltips tooltip-template="Braking" tooltip-class="short" tooltip-append-to-body="true" height="23px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Braking per 100 miles",field:"breaking_per_100_miles",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/braking.svg" tooltips tooltip-template="Braking per 100 Miles" tooltip-class="short" tooltip-append-to-body="true" height="23px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"B",name:"Breaking changes",field:"breaking_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClassR},{category:"A",name:"Cornering",field:"cornering_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/cornering.svg" tooltips tooltip-template="Cornering" tooltip-class="short" tooltip-append-to-body="true" height="21px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Speeding",field:"speeding_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/speed.svg" tooltips tooltip-template="Speeding" tooltip-class="short" tooltip-append-to-body="true" height="20px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Speeding per 100 miles",field:"speeding_per_100_miles",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/speed.svg" tooltips tooltip-template="Speeding per 100 Miles" tooltip-class="short" tooltip-append-to-body="true" height="20px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"B",name:"Speeding change",field:"speeding_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClassR},{category:"A",name:"Distraction",field:"distraction_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/distraction.svg" tooltips tooltip-template="Distraction" tooltip-class="short" tooltip-append-to-body="true" height="25px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Distraction per 100 miles",field:"distraction_per_100_miles",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/distraction.svg" tooltips tooltip-template="Distraction per 100 Miles" tooltip-class="long" tooltip-append-to-body="true" height="25px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"B",name:"Distraction change",field:"distraction_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClassR},{category:"A",name:"Seatbelt",field:"seat_belt_off_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/seatbelt.svg"  tooltips tooltip-template="Seatbelt Off" tooltip-class="short" tooltip-append-to-body="true"  height="25px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Seatbelt off for 100 miles",field:"seat_belt_off_per_100_miles",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/seatbelt.svg"  tooltips tooltip-template="Seatbelt Off per 100 Miles" tooltip-class="long" tooltip-append-to-body="true"  height="25px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"B",name:"Seatbelt off change",field:"seat_belt_off_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClassR},{category:"A",name:"Back up",field:"reverse_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/backup.svg"  tooltips tooltip-template="Back Up" tooltip-class="short" tooltip-append-to-body="true" height="25px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Back up per 100 miles",field:"reverse_count_per_100_miles",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/backup.svg"  tooltips tooltip-template="Back Up per 100 Miles" tooltip-class="short" tooltip-append-to-body="true" height="25px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"B",name:"Back up changes",field:"reverse_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClassR},{category:"A",name:"MPG",field:"mpg",enableFiltering:!1,type:"number"},{category:"B",name:"MPG changes",field:"mpg_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClass},{category:"A",name:"Idling",field:"idling_percentage",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting},{category:"A",name:"Engine Off",field:"engine_off_count",enableFiltering:!1,type:"number"},{category:"A",name:"Pre DVCR",displayName:"Pre DVCR",field:"tripStats.dvir_pre",enableFiltering:!1,type:"number"},{category:"A",name:"Post DVCR",displayName:"Post DVCR",field:"tripStats.dvir_post",enableFiltering:!1,type:"number"},{category:"A",name:"Training assigned",field:"tripStats.training_assignedCount",enableFiltering:!1,type:"number"},{category:"A",name:"Training completed",field:"tripStats.training_completeCount",enableFiltering:!1,type:"number"},{category:"A",name:"GroupId",field:"groupId",enableFiltering:!0,type:"number",visible:!1}],onRegisterApi:function(gridApi){gridApi.core.on.renderingComplete($scope,function(){}),$scope.gridApi=gridApi}},$scope.hideKey=[2],$scope.partViewConfig=[{0:!0},{1:!0},{2:!1},{3:!0},{5:!1},{6:!0},{8:!1},{9:!0},{10:!0},{11:!1},{12:!1},{13:!0},{14:!0},{15:!1},{16:!1},{17:!0},{18:!1},{19:!1},{20:!0},{21:!1},{22:!1},{23:!0},{24:!1},{25:!1},{27:!1},{28:!0},{29:!0},{30:!0},{31:!0},{32:!0},{33:!0}],$scope.show_compare=!0,"monthly"==$scope.period&&$scope.getMonthlyReport_Amzl(start),"weekly"==$scope.period&&$scope.getWeeklyReport_Amzl(start),"daily"==$scope.period&&$scope.getDailyReport_Amzl(start)):($scope.show_compare=!0,ClientReportSvc.set_GridOption($scope,!1,$scope.companyId),$scope.partViewConfig=[{4:!1},{6:!1},{7:!0},{8:!1},{9:!1},{10:!1},{11:!1},{13:!0},{14:!0},{15:!0},{16:!0},{17:!0},{18:!0},{19:!0},{20:!0},{21:!1},{22:!1},{23:!1}],"monthly"==$scope.period&&$scope.getMonthlyReport(start),"weekly"==$scope.period&&$scope.getWeeklyReport(start),"daily"==$scope.period&&$scope.getDailyReport(start))))},$scope.getDailyReport_Amzl=function(start){$loading.start("loading_report");var end=start,start_prev=moment(start).add(-1,"d").format("YYYY-MM-DD"),end_prev=start_prev;$scope.fileName="Report-Daily-"+start,FleetService.getDriversReport($scope.companyId,null,start,end,!0).then(function(response){$scope.today=ClientReportSvc.prep_Amzl_Daily_Report(response,$rootScope.usersMap,!1,$rootScope.groupsMap),$scope.today&&($scope.data=$scope.today),$loading.finish("loading_report"),FleetService.getDriversReport($scope.companyId,null,start_prev,end_prev,!0).then(function(response2){$scope.yesterday=ClientReportSvc.prep_Amzl_Daily_Report(response2,$rootScope.usersMap,!1,$rootScope.groupsMap),$scope.today&&$scope.yesterday&&($scope.today=ClientReportSvc.calculateDelta($scope.today,$scope.yesterday)),$scope.today&&($scope.data=$scope.today),$loading.finish("loading_report")})})},$scope.getWeeklyReport_Amzl=function(start){$loading.start("loading_report");var end=$scope.getWeekEnd(start),start_prev=moment(start).add(-7,"d").format("YYYY-MM-DD"),end_prev=$scope.getWeekEnd(start_prev);$scope.fileName="Report-Weekly-"+start+"-"+end,FleetService.getDriversReport($scope.companyId,"week",start,end,!0).then(function(response){$scope.thisWeek=ClientReportSvc.prep_Amzl_Weely_Report(response,$rootScope.usersMap,!1,$rootScope.groupsMap),$scope.thisWeek&&($scope.data=$scope.thisWeek),$loading.finish("loading_report"),FleetService.getDriversReport($scope.companyId,"week",start_prev,end_prev,!0).then(function(response2){$scope.lastWeek=ClientReportSvc.prep_Amzl_Weely_Report(response2,$rootScope.usersMap,!1,$rootScope.groupsMap),$scope.thisWeek&&$scope.lastWeek&&($scope.thisWeek=ClientReportSvc.calculateDelta($scope.thisWeek,$scope.lastWeek)),$scope.thisWeek&&($scope.data=$scope.thisWeek),$loading.finish("loading_report")})})},$scope.getMonthlyReport_Amzl=function(start){$loading.start("loading_report"),start=new Date(moment(start).startOf("month").format("MM/DD/YYYY"));var end=$scope.getMothEnd(start),start_prev=moment(start).add(-1,"months").format("YYYY-MM-DD"),end_prev=$scope.getMothEnd(start_prev);$scope.fileName="Report-Monthly-"+start+"-"+end,FleetService.getDriversReport($scope.companyId,"month",start,end,!0).then(function(response){$scope.thisMonth=ClientReportSvc.prep_Amzl_Monthly_Report(response,$rootScope.usersMap,!1,$rootScope.groupsMap),$scope.thisMonth&&($scope.data=$scope.thisMonth),$loading.finish("loading_report"),FleetService.getDriversReport($scope.companyId,"month",start_prev,end_prev,!0).then(function(response2){$scope.lastMonth=ClientReportSvc.prep_Amzl_Monthly_Report(response2,$rootScope.usersMap,!1,$rootScope.groupsMap),$scope.thisMonth&&$scope.lastMonth&&($scope.thisMonth=ClientReportSvc.calculateDelta($scope.thisMonth,$scope.lastMonth)),$scope.thisMonth&&($scope.data=$scope.thisMonth),$loading.finish("loading_report")})})},$scope.getMothEnd=function(d){return moment(d).endOf("month").format("YYYY-MM-DD")},$scope.prep_groups=function(){$scope.groupsFilter=[];for(var i=0;i<$rootScope.groupsList.length;i++)$scope.groupsFilter.push({label:$rootScope.groupsList[i].nameWithPath,value:$rootScope.groupsList[i].id})},$scope.getMonthlyReport=function(start){start=new Date(moment(start).startOf("month").format("MM/DD/YYYY"));var end=$scope.getMothEnd(start);$scope.fileName="Report-Monthly-"+start+"-"+end;var thisMonth,lastMonth,start_prev=moment(start).add(-1,"months").format("YYYY-MM-DD"),end_prev=$scope.getMothEnd(start_prev);$loading.start("loading_report"),FleetService.getDriversReport($scope.companyId,"month",start,end,!0).then(function(response,status){thisMonth=response.data,FleetService.getDriversReport($scope.companyId,"month",start_prev,end_prev,!0).then(function(response2,status2){thisMonth&&(thisMonth=thisMonth.filter(function(elm){return elm.monthlyStats&&elm.monthlyStats[0]&&elm.monthlyStats[0].tripStats&&elm.monthlyStats[0].tripStats.tripCount>0})),lastMonth=response2.data,thisMonth=$scope.bindViewModel(thisMonth),lastMonth=$scope.bindViewModel(lastMonth),thisMonth&&lastMonth&&(thisMonth=ClientReportSvc.calculateDelta(thisMonth,lastMonth)),thisMonth&&($scope.data=thisMonth),$loading.finish("loading_report")})})},$scope.getWeeklyReport=function(start){var start_prev=moment(start).add(-7,"d").format("YYYY-MM-DD");$loading.start("loading_report");var end=$scope.getWeekEnd(start);$scope.fileName="Report-Weekly-"+start+"-"+end;var thisWeek;$scope.getWeekEnd(start_prev);FleetService.getDriversReport($scope.companyId,"week",start,end,!0).then(function(response,status){(thisWeek=response.data)&&(thisWeek=thisWeek.filter(function(elm){return elm.weeklyStats&&elm.weeklyStats[0]&&elm.weeklyStats[0].tripStats&&elm.weeklyStats[0].tripStats.tripCount>0})),thisWeek=$scope.bindViewModel(thisWeek),(thisWeek=ClientReportSvc.calculateDelta(thisWeek,void 0))&&($scope.data=thisWeek),$loading.finish("loading_report")})},$scope.getDailyReport=function(start){var end=start;$scope.fileName="Report-Daily-"+start;var today,yesterday,start_prev=moment(start).add(-1,"d").format("YYYY-MM-DD"),end_prev=start_prev;$loading.start("loading_report"),FleetService.getDriversReport($scope.companyId,"day",start,end,!0).then(function(response,status){today=response.data,FleetService.getDriversReport($scope.companyId,"day",start_prev,end_prev,!0).then(function(response2,status2){today&&(today=today.filter(function(elm){return elm.dailyStats&&elm.dailyStats[0]&&elm.dailyStats[0].tripStats&&elm.dailyStats[0].tripStats.tripCount>0})),yesterday=response2.data,today=$scope.bindViewModel(today),yesterday=$scope.bindViewModel(yesterday),today&&yesterday&&(today=ClientReportSvc.calculateDelta(today,yesterday)),today&&($scope.data=today),$loading.finish("loading_report")})})},$scope.getFormattedDate=function(date){return moment(date).format("YYYY-MM-DD")},$scope.getWeekEnd=function(d){return moment(d,"YYYY-MM-DD").endOf("week").format("YYYY-MM-DD")},$scope.exportCsv=function(){$scope.readyCsv=!0},$scope.bindViewModel=function(thisWeek){return ClientReportSvc.generateReportData(thisWeek,$scope.usersMap)},$scope.initReport=!1,$scope.initUserMap=function(){!$scope.usersMap||isEmpty($scope.usersMap)||!$rootScope.groupsList||isEmpty($rootScope.groupsList)?$timeout(function(){$scope.initUserMap()},200):($scope.usersMap=$rootScope.usersMap,$scope.prep_groups(),$scope.initReport||($scope.loadReport($scope.start),$scope.initReport=!0))}});var nSorting=function(a,b){a||(a="0"),b||(b="0");var a_num=a.replace(/^\D+/g,""),b_num=b.replace(/^\D+/g,"");return(a_num=parseFloat(a))<(b_num=parseFloat(b))?-1:a_num>b_num?1:0},rSorting=function(a,b){var a_num,b_num;if(a){var a_nums=a.split("/");a_num=parseFloat(a_nums[0])/parseFloat(a_nums[1])*100}else a_num=0;if(b){var b_nums=b.split("/");b_num=parseFloat(b_nums[0])/parseFloat(b_nums[1])*100}else b_num=0;return a_num<b_num?-1:a_num>b_num?1:0},compareCellClassR=function(grid,row,col,rowRenderIndex,colRenderIndex){if(grid.getCellValue(row,col)){var n=parseFloat(grid.getCellValue(row,col));if(n<0)return"ui-grid-cell-positive";if(n>0)return"ui-grid-cell-negative"}},compareCellClass=function(grid,row,col,rowRenderIndex,colRenderIndex){if(grid.getCellValue(row,col)){var n=parseFloat(grid.getCellValue(row,col));if(n>0)return"ui-grid-cell-positive";if(n<0)return"ui-grid-cell-negative"}};angular.module("edriving").controller("FleetReportOnPeriodGroupCtrl",function($scope,uiGridConstants,$loading,$rootScope,$http,$auth,toastr,Account,FleetService,$cookieStore,$log,$state,moment,$timeout,ClientReportSvc,$location){function isEmpty(obj){return 0===Object.keys(obj).length&&obj.constructor===Object}$scope.client,$scope.show_period=!0,$scope.isGrp=!0,$scope.selectTab=function(tab){$scope.selectedTab=tab},$scope.isTabSelected=function(tab){return $scope.selectedTab===tab},this.$onInit=function(){$scope.client=$state.params.client,$scope.client&&($scope.show_period=!0),$scope.period=$state.params.period,$scope.show_compare=!1,$scope.checkCompare=!1,$scope.period||($scope.period="weekly"),$scope.companyId=$rootScope.loggedInCompanyUser.companyId,$scope.initUserMap()},$scope.readyCsv=!1,$scope.showTab=1,$scope.data=[],$scope.$watch("checkCompare",function(){$scope.checkCompare?($(".form-check-label").addClass("checked"),$(".fa-check-square").show(),$(".fa-square-o").hide(),$scope.showTab=2):($(".form-check-label").removeClass("checked"),$(".fa-check-square").hide(),$(".fa-square-o").show(),$scope.showTab=1)}),$scope.changePeriodOption=function(evt){},$scope.loadReport=function(start){$scope.start=start,start&&(start.isValid&&!start.isValid()||$scope.usersMap&&!isEmpty($scope.usersMap)&&$rootScope.groupsList&&!isEmpty($rootScope.groupsList)&&(start=moment(start,"MM/DD/YYYY").format("YYYY-MM-DD"),$scope.client?"amzl"==$scope.client&&($scope.partViewConfig=[{2:!0},{5:!1},{6:!0},{8:!1},{9:!0},{10:!0},{11:!1},{12:!1},{13:!0},{14:!0},{15:!1},{16:!1},{17:!0},{18:!1},{19:!1},{20:!0},{21:!1},{22:!1},{23:!0},{24:!1},{25:!1},{27:!1},{28:!0},{29:!0},{30:!0},{31:!0},{32:!0},{33:!0}],$scope.show_compare=!0,ClientReportSvc.set_AmzlGridOption($scope,!0,$scope.companyId),"monthly"==$scope.period&&$scope.getMonthlyReport_Amzl(start),"weekly"==$scope.period&&$scope.getWeeklyReport_Amzl(start),"daily"==$scope.period&&$scope.getDailyReport_Amzl(start)):($scope.show_compare=!0,$scope.partViewConfig=[{0:!1},{4:!1},{6:!1},{7:!0},{8:!1},{9:!1},{10:!1},{11:!1},{13:!0},{14:!0},{15:!0},{16:!0},{17:!0},{18:!0},{19:!0},{20:!0},{21:!1},{22:!1},{23:!1}],ClientReportSvc.set_GridOption($scope,!1,$scope.companyId),"monthly"==$scope.period&&$scope.getMonthlyReport(start),"weekly"==$scope.period&&$scope.getWeeklyReport(start),"daily"==$scope.period&&$scope.getDailyReport(start))))},$scope.getMonthlyReport_Amzl=function(start){$loading.start("loading_report"),start=new Date(moment(start).startOf("month").format("MM/DD/YYYY"));var end=$scope.getMothEnd(start),start_prev=moment(start).add(-1,"months").format("YYYY-MM-DD"),end_prev=$scope.getMothEnd(start_prev);$scope.fileName="Report-Monthly-"+start+"-"+end,FleetService.getGroupsReport($scope.companyId,start,end,"month").then(function(response){$scope.thisMonth=ClientReportSvc.prep_Amzl_Monthly_Report(response,$rootScope.usersMap,!0,$rootScope.groupsMap,$rootScope.company.name),FleetService.getGroupsReport($scope.companyId,start_prev,end_prev,"month").then(function(response2){$scope.lastMonth=ClientReportSvc.prep_Amzl_Monthly_Report(response2,$rootScope.usersMap,!0,$rootScope.groupsMap,$rootScope.company.name),$scope.thisMonth&&$scope.lastMonth&&($scope.thisMonth=ClientReportSvc.calculateDelta($scope.thisMonth,$scope.lastMonth)),$scope.thisMonth&&($scope.data=$scope.thisMonth),$loading.finish("loading_report")})})},$scope.getWeeklyReport_Amzl=function(start){$loading.start("loading_report");var end=$scope.getWeekEnd(start),start_prev=moment(start).add(-7,"d").format("YYYY-MM-DD"),end_prev=$scope.getWeekEnd(start_prev);$scope.fileName="Report-Weekly-"+start+"-"+end,FleetService.getGroupsReport($scope.companyId,start,end,"week").then(function(response,status){$scope.thisWeek=ClientReportSvc.prep_Amzl_Weely_Report(response,$rootScope.usersMap,!0,$rootScope.groupsMap,$rootScope.company.name),FleetService.getGroupsReport($scope.companyId,start_prev,end_prev,"week").then(function(response2,status){$scope.lastWeek=ClientReportSvc.prep_Amzl_Weely_Report(response2,$rootScope.usersMap,!0,$rootScope.groupsMap,$rootScope.company.name),$scope.thisWeek&&$scope.lastWeek&&($scope.thisWeek=ClientReportSvc.calculateDelta($scope.thisWeek,$scope.lastWeek)),$scope.thisWeek&&($scope.data=$scope.thisWeek),$loading.finish("loading_report")})})},$scope.getDailyReport_Amzl=function(start){$loading.start("loading_report");var end=start,start_prev=moment(start).add(-1,"d").format("YYYY-MM-DD"),end_prev=start_prev;$scope.fileName="Report-Daily-"+start,FleetService.getGroupsReport($scope.companyId,start,end,null).then(function(response,status){$scope.today=ClientReportSvc.prep_Amzl_Daily_Report(response,$rootScope.usersMap,!0,$rootScope.groupsMap,$rootScope.company.name),FleetService.getGroupsReport($scope.companyId,start_prev,end_prev,null).then(function(response2,status){$scope.yesterday=ClientReportSvc.prep_Amzl_Daily_Report(response2,$rootScope.usersMap,!0,$rootScope.groupsMap,$rootScope.company.name),$scope.today&&$scope.yesterday&&($scope.today=ClientReportSvc.calculateDelta($scope.today,$scope.yesterday)),$scope.today&&($scope.data=$scope.today),$loading.finish("loading_report")})})},$scope.getMothEnd=function(d){return moment(d).endOf("month").format("YYYY-MM-DD")},$scope.prep_groups=function(){$scope.groupsFilter=[];for(var i=0;i<$rootScope.groupsList.length;i++)$scope.groupsFilter.push({label:$rootScope.groupsList[i].nameWithPath,value:$rootScope.groupsList[i].id})},$scope.getMonthlyReport=function(start){start=new Date(moment(start).startOf("month").format("MM/DD/YYYY"));var end=$scope.getMothEnd(start);$scope.fileName="Report-Monthly-"+start+"-"+end;var thisMonth,lastMonth,start_prev=moment(start).add(-1,"months").format("YYYY-MM-DD"),end_prev=$scope.getMothEnd(start_prev);$loading.start("loading_report"),FleetService.getGroupsReport($scope.companyId,start,end,"month").then(function(response,status){thisMonth=response.data,FleetService.getGroupsReport($scope.companyId,start_prev,end_prev,"month").then(function(response2,status2){thisMonth&&(thisMonth=thisMonth.filter(function(elm){return elm.monthlyStats&&elm.monthlyStats[0]&&elm.monthlyStats[0].tripStats&&elm.monthlyStats[0].tripStats.tripCount>0})),lastMonth=response2.data,thisMonth=$scope.bindViewModel(thisMonth),lastMonth=$scope.bindViewModel(lastMonth),thisMonth&&lastMonth&&(thisMonth=ClientReportSvc.calculateDelta(thisMonth,lastMonth)),thisMonth&&($scope.data=thisMonth),$loading.finish("loading_report")})})},$scope.getWeeklyReport=function(start){$loading.start("loading_report");var start_prev=moment(start).add(-7,"d").format("YYYY-MM-DD"),end=$scope.getWeekEnd(start);$scope.fileName="Report-Weekly-"+start+"-"+end;var thisWeek,previousWeek,end_prev=$scope.getWeekEnd(start_prev);FleetService.getGroupsReport($scope.companyId,start,end,"week").then(function(response,status){thisWeek=response.data,FleetService.getGroupsReport($scope.companyId,start_prev,end_prev,"week").then(function(response2,status2){thisWeek&&(thisWeek=thisWeek.filter(function(elm){return elm.weeklyStats&&elm.weeklyStats[0]&&elm.weeklyStats[0].tripStats&&elm.weeklyStats[0].tripStats.tripCount>0})),previousWeek=response2.data,thisWeek=$scope.bindViewModel(thisWeek),previousWeek=$scope.bindViewModel(previousWeek),thisWeek&&previousWeek&&(thisWeek=ClientReportSvc.calculateDelta(thisWeek,previousWeek)),thisWeek&&($scope.data=thisWeek),$loading.finish("loading_report")})})},$scope.getDailyReport=function(start){var end=start;$scope.fileName="Report-Daily-"+start;var start_prev=moment(start).add(-1,"d").format("YYYY-MM-DD");$scope.fileName="Report-Weekly-"+start+"-"+end;var today,yesterday,end_prev=start_prev;$loading.start("loading_report"),FleetService.getGroupsReport($scope.companyId,start,end,"day").then(function(response,status){today=response.data,FleetService.getGroupsReport($scope.companyId,start_prev,end_prev,"day").then(function(response2,status2){today&&(today=today.filter(function(elm){return elm.dailyStats&&elm.dailyStats[0]&&elm.dailyStats[0].tripStats&&elm.dailyStats[0].tripStats.tripCount>0})),yesterday=response2.data,today=$scope.bindViewModel(today),yesterday=$scope.bindViewModel(yesterday),today&&yesterday&&(today=ClientReportSvc.calculateDelta(today,yesterday)),today&&($scope.data=today),$loading.finish("loading_report")})})},$scope.getFormattedDate=function(date){return moment(date).format("YYYY-MM-DD")},$scope.getWeekEnd=function(d){return moment(d,"YYYY-MM-DD").endOf("week").format("YYYY-MM-DD")},$scope.exportCsv=function(){$scope.readyCsv=!0},$scope.bindViewModel=function(thisWeek){var companiesMap={};return companiesMap[$rootScope.company.id]=$rootScope.company,ClientReportSvc.generateReportData(thisWeek,$scope.usersMap,$rootScope.groupsMap,companiesMap)},$scope.initReport=!1,$scope.initUserMap=function(){if(!$scope.usersMap||isEmpty($scope.usersMap)||!$rootScope.groupsList||isEmpty($rootScope.groupsList))$timeout(function(){$scope.initUserMap()},200);else{$scope.usersMap=$rootScope.usersMap,$scope.prep_groups();moment(new Date,"MM/DD/YYYY");$scope.initReport||($scope.loadReport($scope.start),$scope.initReport=!0)}}}),angular.module("edriving").controller("FleetDvcrReportCtrl",function($scope,uiGridConstants,$loading,$rootScope,$timeout,$http,$auth,toastr,Account,FleetService,$cookieStore,$log,$state,uiGridExporterService,uiGridExporterConstants,PREDEFINED_COMMENTS){function isEmpty(obj){return 0===Object.keys(obj).length&&obj.constructor===Object}function generateDamageLine(report){if(!report)return null;for(var line=[],i=0;i<report.categories.length;i++)if(report.categories[i].hasDamage){var l=report.categories[i].name,comment="";if(report.categories[i].predefinedComments){for(var pc=[],predefinedComments=report.categories[i].predefinedComments.split(","),j=0;j<predefinedComments.length;j++)pc.push(predefinedComments[j]);pc.length>0&&(comment+=pc.join(", "))}report.categories[i].comment&&(comment+=report.categories[i].comment),""!=comment&&(l+=" ("+comment+")"),line.push(l)}return line.length>0?line.join("\n"):null}$("#s_badge").css("diplay","none"),$scope.period=$state.params.period,"distributor"==$rootScope.app&&($apiBaseUrl=$apiBaseDomain+"/mentor-distributor/api/"),$scope.gridOptions={enableColumnMenus:!1,enableFiltering:!1,onRegisterApi:function(gridApi){$scope.gridApi=gridApi},exporterCsvFilename:"driver_daily_report_.csv",exporterFieldCallback:function(grid,row,col,input){if(col.cellFilter){var filters=col.cellFilter.split("|");return angular.forEach(filters,function(filter){var filterName=filter.split(":")[0],filterParams=filter.split(":").splice(1);filterParams.unshift(input);var filterFn=$filter(filterName);input=filterFn.apply(this,filterParams)}),input}return input}},$scope.readyCsv=!1,this.$onInit=function(){$scope.app=$rootScope.app,$scope.period="daily",$scope.start=moment(),$scope.today=$scope.start,$scope.initUserMap(),$scope.initGroupMap(),$scope.initCompanyMap(),$scope.initSearchKeys()},$scope.searchKeys=[],$scope.initUserMap=function(){"distributor"!=$rootScope.app&&(!$rootScope.usersMap||isEmpty($rootScope.usersMap)?$timeout(function(){$scope.initUserMap()},200):$scope.usersMap=$rootScope.usersMap)},$scope.changeGroup=function(){$scope.selectedGroup?($scope.searchId=$scope.selectedGroup,$scope.searchType="group"):($scope.searchType=void 0,$scope.searchId=void 0),$scope.updateData($scope.today)},$scope.initGroupMap=function(){if(!$rootScope.groupsMap||isEmpty($rootScope.groupsMap))sessionStorage.getItem("groupsMap")&&($rootScope.groupsMap=JSON.parse(sessionStorage.getItem("groupsMap"))),$timeout(function(){$scope.initGroupMap()},200);else{$scope.groupsFilter=[];for(var i=0;i<$rootScope.groupsList.length;i++)$scope.groupsFilter.push({label:$rootScope.groupsList[i].nameWithPath,value:$rootScope.groupsList[i].id});$scope.groupsMap=$rootScope.groupsMap}},$scope.initCompanyMap=function(){"distributor"==$rootScope.app?!$rootScope.companiesMap||isEmpty($rootScope.companiesMap)?(sessionStorage.getItem("companiesMap")&&($rootScope.companiesMap=JSON.parse(sessionStorage.getItem("companiesMap"))),$timeout(function(){$scope.initCompanyMap()},200)):$scope.companiesMap=$rootScope.companiesMap:$rootScope.company?($scope.companiesMap={},$scope.companiesMap[$rootScope.company.id]=$rootScope.company):$timeout(function(){$scope.initCompanyMap()},200)},$scope.initSearchKeys=function(){"distributor"==$rootScope.app&&(!$scope.companiesMap||isEmpty($scope.companiesMap)||!$scope.groupsMap||isEmpty($scope.groupsMap)?$timeout(function(){$scope.initSearchKeys()},500):$scope.buildSearchKeys())},$scope.buildSearchKeys=function(){if("distributor"==$rootScope.app){var groupLabel;for(var group in"distributor"==$rootScope.app&&(groupLabel="station"),"DSP","STATION OR DSP",$scope.searchBoxHint="STATION OR DSP",$scope.groupsMap){var txt;if($scope.groupsMap[group].id>0)txt="distributor"==$rootScope.app?$scope.companiesMap[$scope.groupsMap[group].companyId].code+" - "+$scope.groupsMap[group].nameWithPath:$scope.groupsMap[group].nameWithPath,$scope.searchKeys.push({object:$scope.groupsMap[group],text:groupLabel+": "+txt,key:$scope.groupsMap[group].id,type:"group"})}for(var companyId in $scope.companiesMap)$scope.companiesMap[companyId].id>0&&$scope.searchKeys.push({object:$scope.companiesMap[companyId],text:"DSP: "+$scope.companiesMap[companyId].code,key:companyId,type:"company"})}},$scope.$watch("selected",function(){$scope.selected&&$scope.selected.type&&$scope.updateData($scope.today)}),$scope.downloadAttachment=function(dvcrId,vin){FleetService.getDvcrAttachment(dvcrId).then(function(response,status){var blob=new Blob([function(base64){for(var binaryString=window.atob(base64),binaryLen=binaryString.length,bytes=new Uint8Array(binaryLen),i=0;i<binaryLen;i++){var ascii=binaryString.charCodeAt(i);bytes[i]=ascii}return bytes}(response.data.imageBinary)],{type:"octet/stream"}),url=window.URL.createObjectURL(blob),link=document.createElement("a");link.setAttribute("type","hidden"),link.download=dvcrId+"-"+vin+".zip",link.href=url,document.body.appendChild(link),link.click(),$loading.finish("loading_report")})},$scope.exportCsv=function(){var exportService=uiGridExporterService,grid=$scope.gridApi.grid,fileName="DVCR_"+$scope.datePicked;$rootScope.company?fileName+="_"+$rootScope.company.code+".csv":$scope.selected.object&&(fileName+="_"+$scope.selected.object.code+".csv"),exportService.loadAllDataIfNeeded(grid,uiGridExporterConstants.ALL,uiGridExporterConstants.VISIBLE).then(function(){var exportColumnHeaders=exportService.getColumnHeaders(grid,uiGridExporterConstants.VISIBLE),exportData=exportService.getData(grid,uiGridExporterConstants.ALL,uiGridExporterConstants.VISIBLE),csvContent=exportService.formatAsCsv(exportColumnHeaders,exportData,grid.options.exporterCsvColumnSeparator);exportService.downloadFile(fileName,csvContent,grid.options.exporterOlderExcelCompatibility)})},$scope.updateData=function(start){if("distributor"===$rootScope.app){if(!$scope.selected)return;if(!$scope.selected.type)return;$scope.searchType=$scope.selected.type,$scope.selected.type,$scope.searchId=$scope.selected.object.id}else if(0===$rootScope.users.length)return sessionStorage.setItem("start",start),void setTimeout(function(){$scope.updateData()},500);$loading.start("loading_report");var userIds=[];if("distributor"!==$rootScope.app&&!$scope.selectedGroup){for(var i=0;i<$rootScope.users.length;i++)$rootScope.users[i].user&&userIds.push($rootScope.users[i].user.UserId);if(0==userIds.length)return void $loading.finish("loading_report")}start=1e3*moment(start).startOf("day").unix();var end=1e3*moment(start).endOf("day").unix();FleetService.getDvcrReport($scope.searchId,userIds.join(),start,end,!0,$scope.searchType).then(function(response){var gridData=[],postDvcrMap={},preDvcrMap={};$scope.reportData=[];for(var i=0;i<response.data.length;i++)$scope.reportData.push(response.data[i]),1==response.data[i].report_type_is_post?postDvcrMap[response.data[i].pre_id]=response.data[i]:0==response.data[i].report_type_is_post&&(preDvcrMap[response.data[i].id]=response.data[i]);for(preDvcrId in preDvcrMap)postDvcrMap[preDvcrId]&&(preDvcrMap[preDvcrId].postDvcr=postDvcrMap[preDvcrId],delete postDvcrMap[preDvcrId]);for(var preDvcrId in preDvcrMap){var report=preDvcrMap[preDvcrId];if("distributor"!=$rootScope.app)var user=$rootScope.usersMap[report.user_id];var group=null;user?group=$rootScope.groupsMap[report.group_id]:user={user:{FirstName:report.user_id,LastName:""}};var rowData={id:report.id,severity1_count:report.severity1_count,severity2_count:report.severity2_count,severity3_count:report.severity3_count,group_name:$rootScope.groupsMap[group?group.id:-1]?$rootScope.groupsMap[group?group.id:-1].code:"",group:group?group.id:-1,driver:user?user.user.FirstName+" "+user.user.LastName:"",vin:report.vin,pre:moment.unix(report.report_time/1e3).format("h:mm a"),hasDamage:report.hasDamage,damage:generateDamageLine(report.report),comment:report.report.comment};if(report.postDvcr){var postReport=report.postDvcr;rowData.id_p=postReport.id,rowData.hasDamage_p=postReport.hasDamage,rowData.severity1_count_p=postReport.severity1_count,rowData.severity2_count_p=postReport.severity2_count,rowData.severity3_count_p=postReport.severity3_count,rowData.post=moment.unix(postReport.report_time/1e3).format("h:mm a"),postReport.sameCondition?rowData.sameCondition_p="Y":(rowData.sameCondition_p="N",rowData.damage_p=generateDamageLine(postReport.report),rowData.comment_p=postReport.report.comment)}gridData.push(rowData)}$scope.gridOptions.data=gridData,$loading.finish("loading_report")})},$scope.gridDynamicHeight=500,$scope.getTableHeight=function(){var height=$(window).height()-289;return height>300?height+"px":"500"},$scope.setStyleForSeverity=function(){$(".s_0").removeClass("s_0"),$(".s_1").removeClass("s_1"),$(".s_2").removeClass("s_2"),$(".s_3").removeClass("s_3");let s_0=$("div.s_0_c").parent(),s_1=$("div.s_1_c").parent(),s_2=$("div.s_2_c").parent(),s_3=$("div.s_3_c").parent();s_0.length>0&&s_0.addClass("s_0"),s_1.length>0&&s_1.addClass("s_1"),s_2.length>0&&s_2.addClass("s_2"),s_3.length>0&&s_3.addClass("s_3"),setTimeout(function(){$scope.$apply()},1)},$scope.selectSeverity=function(){let a=sessionStorage.getItem("selectedSeverity");var id=a.split("_")[1],pre_post=(a.split("_")[2],a.split("_")[0]);let categories=[];var selectedReport;for(let data of $scope.reportData)if(data.id==id)if("post"==pre_post){if(!data.postDvcr)return!1;categories=data.postDvcr.report.categories,selectedReport=data.postDvcr}else categories=data.report.categories,selectedReport=data;if($rootScope.usersMap)var driver=$rootScope.usersMap[selectedReport.user_id]&&$rootScope.usersMap[selectedReport.user_id].user?$rootScope.usersMap[selectedReport.user_id].user.FirstName+" "+$rootScope.usersMap[selectedReport.user_id].user.LastName:"";$scope.selectedReport={id:selectedReport.id,title:selectedReport.pre_id?"Post-Trip Damage Report":"Pre-Trip Damage Report",time:moment.unix(selectedReport.report_time/1e3).format("h:mm a"),vin:selectedReport.vin,comment:selectedReport.report.comment,group:$rootScope.groupsMap[selectedReport.group_id]?$rootScope.groupsMap[selectedReport.group_id].nameWithPath:"",driver:driver||""},$scope.comments=[];for(let i=0;i<categories.length;i++)if(categories[i].hasDamage){let names,all_comments="";if(categories[i].predefinedComments){let comments=categories[i].predefinedComments.split(",");for(let comment of comments)if(comment=comment.trim(),PREDEFINED_COMMENTS.PREDEFINED_COMMENTS_TEXT[comment]){var sev=PREDEFINED_COMMENTS.PREDEFINED_COMMENTS_HIGHPRIORITY[comment],styleClass="";3==sev?styleClass="s_3_txt":2==sev?styleClass="s_2_txt":1==sev&&(styleClass="s_1_txt"),PREDEFINED_COMMENTS.PREDEFINED_COMMENTS_HIGHPRIORITY&&(all_comments+="<span class='"+styleClass+"'>"+PREDEFINED_COMMENTS.PREDEFINED_COMMENTS_TEXT[comment]+"</span><br/>")}}categories[i].comment&&(all_comments+=categories[i].comment),names=PREDEFINED_COMMENTS.CATEGORY_NAME_20190312[categories[i].name]?PREDEFINED_COMMENTS.CATEGORY_NAME_20190312[categories[i].name].split(","):categories[i].name.split("-"),$scope.comments.push({severity:categories[i].severity,name:names[0].trim(),location:names[1]?names[1].trim():"",comment:all_comments.trim()})}console.log($scope.comments),sessionStorage.setItem("selectedSeverity",null)},$scope.chartInited=!1,$scope.chartInited||($scope.columns=[{field:"group",enableFiltering:!1,displayName:"Group",visible:!1},{field:"driver",enableFiltering:!1,displayName:"Driver",cellClass:"text-center",visible:"distributor"!=$rootScope.app,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.driver}}</div>'},{field:"vin",enableFiltering:!1,cellClass:"text-center",displayName:"VIN"},{field:"group_name",enableFiltering:!1,cellClass:"text-left",displayName:"STATION"},{field:"pre",width:"8%",enableFiltering:!1,displayName:"PRE-TRIP"},{field:"severity1_count",displayName:"S1",width:"4%",enableFiltering:!1,cellTemplate:'<div data-toggle="modal" data-target="#triggerModal" id="pre_{{row.entity.id}}_1" onclick="selectedSeverity(this)" class="{{row.entity.severity1_count>0?\'s_1_c\':\'s_0_c\'}}"><a>{{row.entity.severity1_count}}</a></div>'},{field:"severity2_count",displayName:"S2",width:"4%",enableFiltering:!1,cellTemplate:'<div data-toggle="modal" data-target="#triggerModal" id="pre_{{row.entity.id}}_2"  onclick="selectedSeverity(this)" class="{{row.entity.severity2_count>0?\'s_2_c\':\'s_0_c\'}}"><a>{{row.entity.severity2_count}}</a></div>'},{field:"sameCondition_p",width:"5%",enableFiltering:!1,displayName:"Same"},{field:"post",width:"8%",enableFiltering:!1,displayName:"POST-TRIP"},{field:"severity1_count_p",displayName:"S1",enableFiltering:!1,cellClass:"text-left",width:"4%",cellTemplate:'<div data-toggle="modal" data-target="#triggerModal" id="post_{{row.entity.id}}_1"  onclick="selectedSeverity(this)" class="{{row.entity.severity1_count_p>0?\'s_1_c\':\'s_0_c\'}}"><a>{{row.entity.severity1_count_p}}</a></div>'},{field:"severity2_count_p",displayName:"S2",enableFiltering:!1,cellClass:"text-left",width:"4%",cellTemplate:'<div data-toggle="modal" data-target="#triggerModal" id="post_{{row.entity.id}}_2"  onclick="selectedSeverity(this)" class="{{row.entity.severity2_count_p>0?\'s_2_c\':\'s_0_c\'}}"><a>{{row.entity.severity2_count_p}}</a></div>'}],$scope.gridOptions={paginationPageSizes:[10,15,20,25],paginationPageSize:10,visible:!1,enableSorting:!0,enableGridMenu:!1,exporterMenuCsv:!0,exporterMenuPdf:!1,exporterMenuExcel:!1,exporterMenuVisibleData:!1,exporterCsvFilename:"driver_daily_report_.csv",exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location")),gridMenuShowHideColumns:!1,enableColumnMenus:!1,enableFiltering:!0,enableHorizontalScrollbar:!0,enableColumnResizing:!0,rowHeight:42,columnDefs:$scope.columns,onRegisterApi:function(gridApi){$scope.gridApi=gridApi,$scope.gridApi.core.on.rowsRendered($scope,function(){setTimeout(function(){$scope.setStyleForSeverity()},5)})}},$scope.chartInited=!0),$scope.$watchGroup(["users","start"],function(newValues,oldValues,scope){$rootScope.users&&0!=$rootScope.users.length&&$scope.updateData()})}),angular.module("edriving").controller("FleetDvcrAuditReportCtrl",function($scope,uiGridConstants,$loading,$rootScope,$timeout,$http,$auth,toastr,Account,FleetService,$cookieStore,$log,$state,uiGridExporterService,uiGridExporterConstants,PREDEFINED_COMMENTS){function isEmpty(obj){return 0===Object.keys(obj).length&&obj.constructor===Object}function generateDamageLine(report){if(!report)return null;for(var line=[],i=0;i<report.categories.length;i++)if(report.categories[i].hasDamage){var l=PREDEFINED_COMMENTS.CATEGORY_NAME_AUDIT[report.categories[i].name],comment="";if(report.categories[i].predefinedComments){for(var pc=[],predefinedComments=report.categories[i].predefinedComments.split(","),j=0;j<predefinedComments.length;j++)pc.push(PREDEFINED_COMMENTS.PREDEFINED_COMMENTS_TEXT_AUDIT[predefinedComments[j]]);pc.length>0&&(comment+=pc.join(""))}report.categories[i].comment&&(comment+=report.categories[i].comment),""!=comment&&(l+=" > "+comment),line.push(l)}return line.length>0?line.join("<br/>"):null}$("#s_badge").css("diplay","none"),$scope.period=$state.params.period,"distributor"==$rootScope.app&&($apiBaseUrl=$apiBaseDomain+"/mentor-distributor/api/"),$scope.gridOptions={enableColumnMenus:!1,enableFiltering:!1,onRegisterApi:function(gridApi){$scope.gridApi=gridApi},exporterCsvFilename:"driver_daily_report_.csv",exporterFieldCallback:function(grid,row,col,input){if(col.cellFilter){var filters=col.cellFilter.split("|");return angular.forEach(filters,function(filter){var filterName=filter.split(":")[0],filterParams=filter.split(":").splice(1);filterParams.unshift(input);var filterFn=$filter(filterName);input=filterFn.apply(this,filterParams)}),input}return input}},$scope.readyCsv=!1,this.$onInit=function(){$scope.app=$rootScope.app,$scope.period="daily",$scope.start=moment(),$scope.today=$scope.start,$scope.initUserMap(),$scope.initGroupMap(),$scope.initCompanyMap(),$scope.initSearchKeys()},$scope.searchKeys=[],$scope.initUserMap=function(){"distributor"!=$rootScope.app&&(!$rootScope.usersMap||isEmpty($rootScope.usersMap)?$timeout(function(){$scope.initUserMap()},200):$scope.usersMap=$rootScope.usersMap)},$scope.changeGroup=function(){$scope.selectedGroup?($scope.searchId=$scope.selectedGroup,$scope.searchType="group"):($scope.searchType=void 0,$scope.searchId=void 0),$scope.updateData($scope.today)},$scope.initGroupMap=function(){if(!$rootScope.groupsMap||isEmpty($rootScope.groupsMap))sessionStorage.getItem("groupsMap")&&($rootScope.groupsMap=JSON.parse(sessionStorage.getItem("groupsMap"))),$timeout(function(){$scope.initGroupMap()},200);else{$scope.groupsFilter=[];for(var i=0;i<$rootScope.groupsList.length;i++)$scope.groupsFilter.push({label:$rootScope.groupsList[i].nameWithPath,value:$rootScope.groupsList[i].id});$scope.groupsMap=$rootScope.groupsMap}},$scope.initCompanyMap=function(){"distributor"==$rootScope.app?!$rootScope.companiesMap||isEmpty($rootScope.companiesMap)?(sessionStorage.getItem("companiesMap")&&($rootScope.companiesMap=JSON.parse(sessionStorage.getItem("companiesMap"))),$timeout(function(){$scope.initCompanyMap()},200)):$scope.companiesMap=$rootScope.companiesMap:$rootScope.company?($scope.companiesMap={},$scope.companiesMap[$rootScope.company.id]=$rootScope.company):$timeout(function(){$scope.initCompanyMap()},200)},$scope.initSearchKeys=function(){"distributor"==$rootScope.app&&(!$scope.companiesMap||isEmpty($scope.companiesMap)||!$scope.groupsMap||isEmpty($scope.groupsMap)?$timeout(function(){$scope.initSearchKeys()},500):$scope.buildSearchKeys())},$scope.buildSearchKeys=function(){if("distributor"==$rootScope.app){var groupLabel;for(var group in"distributor"==$rootScope.app&&(groupLabel="station"),"DSP","STATION OR DSP",$scope.searchBoxHint="STATION OR DSP",$scope.groupsMap){var txt;if($scope.groupsMap[group].id>0)txt="distributor"==$rootScope.app?$scope.companiesMap[$scope.groupsMap[group].companyId].code+" - "+$scope.groupsMap[group].nameWithPath:$scope.groupsMap[group].nameWithPath,$scope.searchKeys.push({object:$scope.groupsMap[group],text:groupLabel+": "+txt,key:$scope.groupsMap[group].id,type:"group"})}for(var companyId in $scope.companiesMap)$scope.companiesMap[companyId].id>0&&$scope.searchKeys.push({object:$scope.companiesMap[companyId],text:"DSP: "+$scope.companiesMap[companyId].code,key:companyId,type:"company"})}},$scope.$watch("selected",function(){$scope.selected&&$scope.selected.type&&$scope.updateData($scope.today)}),$scope.downloadAttachment=function(dvcrId,vin){FleetService.getDvcrAttachment(dvcrId).then(function(response,status){var blob=new Blob([function(base64){for(var binaryString=window.atob(base64),binaryLen=binaryString.length,bytes=new Uint8Array(binaryLen),i=0;i<binaryLen;i++){var ascii=binaryString.charCodeAt(i);bytes[i]=ascii}return bytes}(response.data.imageBinary)],{type:"octet/stream"}),url=window.URL.createObjectURL(blob),link=document.createElement("a");link.setAttribute("type","hidden"),link.download=dvcrId+"-"+vin+".zip",link.href=url,document.body.appendChild(link),link.click(),$loading.finish("loading_report")})},$scope.exportCsv=function(){var exportService=uiGridExporterService,grid=$scope.gridApi.grid,fileName="DVCR_"+$scope.datePicked;$rootScope.company?fileName+="_"+$rootScope.company.code+".csv":$scope.selected.object&&(fileName+="_"+$scope.selected.object.code+".csv"),exportService.loadAllDataIfNeeded(grid,uiGridExporterConstants.ALL,uiGridExporterConstants.VISIBLE).then(function(){var exportColumnHeaders=exportService.getColumnHeaders(grid,uiGridExporterConstants.VISIBLE),exportData=exportService.getData(grid,uiGridExporterConstants.ALL,uiGridExporterConstants.VISIBLE),csvContent=exportService.formatAsCsv(exportColumnHeaders,exportData,grid.options.exporterCsvColumnSeparator);exportService.downloadFile(fileName,csvContent,grid.options.exporterOlderExcelCompatibility)})},$scope.updateData=function(start){if("distributor"===$rootScope.app){if(!$scope.selected)return;if(!$scope.selected.type)return;$scope.searchType=$scope.selected.type,$scope.selected.type,$scope.searchId=$scope.selected.object.id}else if(0===$rootScope.users.length)return sessionStorage.setItem("start",start),void setTimeout(function(){$scope.updateData()},500);$loading.start("loading_report");var userIds=[];if("distributor"!==$rootScope.app&&!$scope.selectedGroup){for(var i=0;i<$rootScope.users.length;i++)$rootScope.users[i].user&&userIds.push($rootScope.users[i].user.UserId);if(0==userIds.length)return void $loading.finish("loading_report")}var mStart=1e3*moment(start).startOf("month").unix(),mEnd=1e3*moment(start).endOf("day").unix();FleetService.getDvcrReport($scope.searchId,userIds.join(),mStart,mEnd,!0,$scope.searchType).then(function(response){var gridData=[],auditDvcrMap={};$scope.reportData=[];for(var i=0;i<response.data.length;i++)$scope.reportData.push(response.data[i]),2==response.data[i].report_type_is_post&&(auditDvcrMap[response.data[i].id]=response.data[i]);for(var dvcrId in auditDvcrMap){var report=auditDvcrMap[dvcrId];if("distributor"!=$rootScope.app)var user=$rootScope.usersMap[report.user_id];var group=null;user?group=$rootScope.groupsMap[report.group_id]:user={user:{FirstName:report.user_id,LastName:""}};var rowData={id:report.id,severity1_count:report.severity1_count,severity2_count:report.severity2_count,severity3_count:report.severity3_count,group_name:$rootScope.groupsMap[group?group.id:-1]?$rootScope.groupsMap[group?group.id:-1].code:"",group:group?group.id:-1,driver:user?user.user.FirstName+" "+user.user.LastName:"",vin:report.vin,pre:moment.unix(report.report_time/1e3).format("MM/DD hh:mm a"),hasDamage:report.hasDamage,damage:generateDamageLine(report.report),comment:report.report.comment};gridData.push(rowData)}$scope.gridOptions.data=gridData,$loading.finish("loading_report")})},$scope.gridDynamicHeight=500,$scope.getTableHeight=function(){var height=$(window).height()-289;return height>300?height+"px":"500"},$scope.setStyleForSeverity=function(){$(".s_0").removeClass("s_0"),$(".s_1").removeClass("s_1"),$(".s_2").removeClass("s_2"),$(".s_3").removeClass("s_3");let s_0=$("div.s_0_c").parent(),s_1=$("div.s_1_c").parent(),s_2=$("div.s_2_c").parent(),s_3=$("div.s_3_c").parent();s_0.length>0&&s_0.addClass("s_0"),s_1.length>0&&s_1.addClass("s_1"),s_2.length>0&&s_2.addClass("s_2"),s_3.length>0&&s_3.addClass("s_3"),setTimeout(function(){$scope.$apply()},1)},$scope.selectSeverity=function(){let a=sessionStorage.getItem("selectedSeverity");var id=a.split("_")[1],pre_post=(a.split("_")[2],a.split("_")[0]);let categories=[];var selectedReport;for(let data of $scope.reportData)if(data.id==id)if("post"==pre_post){if(!data.postDvcr)return!1;categories=data.postDvcr.report.categories,selectedReport=data.postDvcr}else categories=data.report.categories,selectedReport=data;if($rootScope.usersMap)var driver=$rootScope.usersMap[selectedReport.user_id]&&$rootScope.usersMap[selectedReport.user_id].user?$rootScope.usersMap[selectedReport.user_id].user.FirstName+" "+$rootScope.usersMap[selectedReport.user_id].user.LastName:"";$scope.selectedReport={id:selectedReport.id,title:"Damage Report",time:moment.unix(selectedReport.report_time/1e3).format("MM/DD h:mm a"),vin:selectedReport.vin,comment:selectedReport.report.comment,group:$rootScope.groupsMap[selectedReport.group_id]?$rootScope.groupsMap[selectedReport.group_id].nameWithPath:"",driver:driver||""},$scope.comments=[];for(let i=0;i<categories.length;i++)if(categories[i].hasDamage){let names,all_comments="";if(categories[i].predefinedComments){let comments=categories[i].predefinedComments.split(",");for(let comment of comments)if(comment=comment.trim(),PREDEFINED_COMMENTS.PREDEFINED_COMMENTS_TEXT_AUDIT[comment]){var sev=PREDEFINED_COMMENTS.PREDEFINED_COMMENTS_HIGHPRIORITY[comment],styleClass="";3==sev?styleClass="s_3_txt":2==sev?styleClass="s_2_txt":1==sev&&(styleClass="s_1_txt"),PREDEFINED_COMMENTS.PREDEFINED_COMMENTS_HIGHPRIORITY&&(all_comments+="<span class='"+styleClass+"'>"+PREDEFINED_COMMENTS.PREDEFINED_COMMENTS_TEXT_AUDIT[comment]+"</span><br/>")}}categories[i].comment&&(all_comments+=categories[i].comment),names=PREDEFINED_COMMENTS.CATEGORY_NAME_AUDIT[categories[i].name]?PREDEFINED_COMMENTS.CATEGORY_NAME_AUDIT[categories[i].name].split(","):categories[i].name.split("-"),$scope.comments.push({severity:categories[i].severity,name:names[0].trim(),location:names[1]?names[1].trim():"",comment:all_comments.trim()})}console.log($scope.comments),sessionStorage.setItem("selectedSeverity",null)},$scope.chartInited=!1,$scope.chartInited||($scope.columns=[{field:"group",enableFiltering:!1,displayName:"Group",visible:!1},{field:"driver",enableFiltering:!1,displayName:"Driver",width:"15%",cellClass:"text-center",visible:"distributor"!=$rootScope.app,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.driver}}</div>'},{field:"vin",enableFiltering:!1,width:"15%",cellClass:"text-center",displayName:"VIN"},{field:"group_name",enableFiltering:!1,width:"10%",cellClass:"text-left",displayName:"STATION"},{field:"pre",width:"10%",enableFiltering:!1,displayName:"TIME"},{field:"severity1_count",displayName:"damages",width:"8%",enableFiltering:!1,cellTemplate:'<div data-toggle="modal" data-target="#triggerModal" id="pre_{{row.entity.id}}_1" onclick="selectedSeverity(this)" class="{{row.entity.severity1_count>0?\'s_1_c\':\'s_0_c\'}}"><a>{{row.entity.severity1_count}}</a></div>'},{field:"damage",width:"40%",enableFiltering:!1,cellClass:"text-left",displayName:"Damage Reported",cellTemplate:'<div data-toggle="modal"  class = "ui-grid-cell-contents"  ng-bind-html="grid.getCellDisplayValue(row ,col)"></div>'}],$scope.gridOptions={paginationPageSizes:[10,15,20,25],paginationPageSize:10,visible:!1,enableSorting:!0,enableGridMenu:!1,exporterMenuCsv:!0,exporterMenuPdf:!1,exporterMenuExcel:!1,exporterMenuVisibleData:!1,exporterCsvFilename:"driver_daily_report_.csv",exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location")),gridMenuShowHideColumns:!1,enableColumnMenus:!1,enableFiltering:!0,enableHorizontalScrollbar:!0,enableColumnResizing:!0,rowHeight:"auto",columnDefs:$scope.columns,onRegisterApi:function(gridApi){$scope.gridApi=gridApi,$scope.gridApi.core.on.rowsRendered($scope,function(){setTimeout(function(){$scope.setStyleForSeverity()},5)})}},$scope.chartInited=!0),$scope.$watchGroup(["users","start"],function(newValues,oldValues,scope){$rootScope.users&&0!=$rootScope.users.length&&$scope.updateData()})}),angular.module("edriving").controller("LoginCtrl",function($scope,$location,$auth,toastr,$cookieStore,$state,Account,$rootScope,$http,$log){$scope.login=function(){$scope.user.productCode="MENTOR_CONSUMER_INTERNAL",$auth.login($scope.user).then(function(response){if($auth.setToken(response),Account.getProfile().then(function(response){$rootScope.user=response.data,$rootScope.user.company_id&&$http.get($apiBaseUrl+"companies/"+$rootScope.user.company_id).success(function(data,status){$scope.company=data}).error(function(data,status,headers,config){$log.warn("company not found.")})}).catch(function(response){toastr.error(response.data.message,response.status)}),"3"==$auth.getPayload().role)$state.go("fleet.main"),$cookieStore.put("userEmail",$scope.user.email),$wooCookie="wooEmail="+$scope.user.email+";domain=.idrivesafely.com",document.cookie=$wooCookie;else{$cookieStore.put("userEmail",$scope.user.email);var $wooCookie="wooEmail="+$scope.user.email+";domain=.idrivesafely.com";document.cookie=$wooCookie,$scope.user.email.toLowerCase().indexOf("edriving.com")>0||$scope.user.email.toLowerCase().indexOf("idrivesafely.com")>0||$scope.user.email.toLowerCase().indexOf("driversed.com")>0?$state.go("index.invitation"):$state.go("index.welcome")}}).catch(function(error){toastr.error(error.data.message,error.status)})},$scope.authenticate=function(provider){$auth.authenticate(provider).then(function(){$location.path("/")}).catch(function(error){error.error?toastr.error(error.error):error.data?toastr.error(error.data,error.status):toastr.error(error)})},$scope.forgotPassword=function(){$scope.user&&$scope.user.email?$location.path("/password_reset").search({email:$scope.user.email}):$location.path("/password_reset")}}),angular.module("edriving").controller("profileCtrl",function($scope,$http,$compile,$auth,toastr,Account,$rootScope){var userId=$auth.getPayload().sub;$scope.updateProfile=function(){Account.updateProfile(userId,$scope.user).then(function(){}).catch(function(response){toastr.error(response.data.message,response.status)})},$scope.link=function(provider){$auth.link(provider).then(function(){toastr.success("You have successfully linked a "+provider+" account"),$scope.getProfile()}).catch(function(response){toastr.error(response.data,response.status)})},$scope.unlink=function(provider){$auth.unlink(provider).then(function(){toastr.info("You have unlinked a "+provider+" account"),$scope.getProfile()}).catch(function(response){toastr.error(response.data?response.data.message:"Could not unlink "+provider+" account",response.status)})}}),angular.module("edriving").controller("LoginOmsCtrl",function($scope,$location,$auth,SatellizerConfig,toastr,$cookieStore,$state,Account,CourseService,$rootScope,$http,$log,$stateParams){console.log($stateParams),$apiBaseUrl=$apiBaseDomain+"/mentor-consumer/api/",SatellizerConfig.baseUrl=$apiBaseUrl,$scope.user={clientId:"OMS_Web"},$scope.omsVersions=null,$stateParams.email?($scope.user.email=$stateParams.email,angular.element("#password").focus()):angular.element("#email").focus(),$scope.openULMS=function(data){console.log(data),document.forms.ulmsForm.action=data.ulms.url,data.productCode.indexOf("VRM-OMS-Journeys")>-1&&(document.forms.ulmsForm.action+="&noProgress=1"),document.forms.ulmsForm.returnURL.value=window.location.href,document.forms.ulmsForm.signature.value=data.ulms.signature,document.forms.ulmsForm.timestamp.value=data.ulms.timestamp,document.forms.ulmsForm.cdbProductInstanceId.value=data.ulms.cdbProductInstanceId,document.forms.ulmsForm.submit()},$scope.login=function(){$scope.user.productCode="OMS-US-EN-CONSUMER-0001",$auth.login($scope.user).then(function(response){$auth.setToken(response),console.log(response.data.cdbUserId),CourseService.getOms(response.data.cdbUserId).then(function(response,status){var data=response.data;if(0==data.length)toastr.error("No One More Second subscription found, please contact customer support");else if(1==data.length)$scope.openULMS(data[0]);else{for(var i=0;i<data.length;i++)data[i].productName=data[i].productCode,"VRM-OMS-US-EN-0001"==data[i].productName?data[i].productName="English (United States)":"VRM-OMS-UK-EN-0001"==data[i].productName?data[i].productName="English (United Kindom)":"VRM-OMS-es-150-0001"==data[i].productName?data[i].productName="Spanish (Spain)":"VRM-OMS-de-150-0001"==data[i].productName?data[i].productName="Germany (German)":"VRM-OMS-fr-150-0001"==data[i].productName?data[i].productName="French (France)":"VRM-OMS-es-419-0001"==data[i].productName&&(data[i].productName="Spanish (Latin America)");$scope.omsVersions=data}})}).catch(function(error){toastr.error(error.data.message)})},$scope.authenticate=function(provider){$auth.authenticate(provider).then(function(){$location.path("/asas")}).catch(function(error){error.error?toastr.error(error.error):error.data?toastr.error(error.data,error.status):toastr.error(error)})},$scope.forgotPassword=function(){$scope.user&&$scope.user.email?$location.path("/password_reset").search({email:$scope.user.email}):$location.path("/password_reset")}}),angular.module("edriving").controller("LoginCsrCtrl",function($scope,$location,$auth,SatellizerConfig,toastr,$cookieStore,$state,Account,CourseService,FleetService,$rootScope,$http,$log,$stateParams){$apiBaseUrl=$apiBaseDomain+"/mentor-csr/api/",SatellizerConfig.baseUrl=$apiBaseUrl,$stateParams.email?($scope.user={email:$stateParams.email},angular.element("#password").focus()):angular.element("#email").focus(),$scope.login=function(){$auth.login($scope.user,{timeout:3e3}).then(function(response){$auth.setToken(response),console.log(response.data.cdbUserId),$state.go("csr.welcome")}).catch(function(error){(error.xhrStatus="abort")&&toastr.error("Failed reaching server, please make sure you are logged in to VPN"),toastr.error(error.data.message)})},$scope.authenticate=function(provider){$auth.authenticate(provider).then(function(){$location.path("/asas")}).catch(function(error){error.error?toastr.error(error.error):error.data?toastr.error(error.data,error.status):toastr.error(error)})},$scope.forgotPassword=function(){$scope.user&&$scope.user.email?$location.path("/password_reset").search({email:$scope.user.email}):$location.path("/password_reset")}}),angular.module("edriving").controller("LoginCsrCognitoCtrl",function($scope,$location,$auth,SatellizerConfig,toastr,CsrService,$state,Account,CourseService,FleetService,$rootScope,$http,$log,$stateParams){$apiBaseUrl=$apiBaseDomain+"/mentor-csr/api/",SatellizerConfig.baseUrl=$apiBaseUrl,CsrService.loginCognito($stateParams.code).then(function(response,status){$auth.setToken(response),console.log(response),$state.go("csr.welcome")})}),angular.module("edriving").controller("LogoutCtrl",function($location,$stateParams,$auth,toastr,$cookieStore,$rootScope,$cacheFactory){$auth.isAuthenticated()?$auth.logout().then(function(){$auth.removeToken(),$cacheFactory.get("$http").removeAll(),$rootScope.$emit("logout"),$location.path($stateParams.loginUrl)}):$location.path($stateParams.loginUrl)}),angular.module("edriving").controller("PasswordResetCtrl",function($scope,$location,$auth,SatellizerConfig,toastr,jwtHelper,$stateParams,Account,$rootScope,$translate,LOCALES,LocaleService,$loading){$stateParams.email,$apiBaseUrl=$apiBaseDomain+"/mentor-consumer/api/",SatellizerConfig.baseUrl=$apiBaseUrl,$scope.resetPassword=function(){$loading.start("loading"),Account.resetPassword($scope.email).then(function(response){$loading.finish("loading"),$(".success-reset").show(),$("#reset-form").hide(),$(".error-reset").hide()}).catch(function(response){$loading.finish("loading"),$(".error-reset").html(response.data.message),$(".error-reset").html(),$(".success-reset").hide(),$(".error-reset").show()})}}),angular.module("edriving").controller("PasswordUpdateCtrl",function($scope,$location,$auth,SatellizerConfig,toastr,jwtHelper,$stateParams,Account,$rootScope,$translate,LocaleService){$apiBaseUrl=$apiBaseDomain+"/mentor-consumer/api/",SatellizerConfig.baseUrl=$apiBaseUrl,$scope.updatePassword=function(){Account.updatePassword($scope.password,$stateParams.token).then(function(response){$(".success-reset").show(),$("#reset-form").hide()}).catch(function(response){$(".error-reset").html(response.data.message),$(".success-reset").hide(),$(".error-reset").show()})}}),angular.module("edriving").controller("FleetLoginCtrl",function($scope,$location,$auth,SatellizerConfig,toastr,$cookieStore,$state,Account,FleetService,$rootScope,$http,$log,$stateParams){$apiBaseUrl=$apiBaseDomain+"/mentor-fleetmanager/api/",SatellizerConfig.baseUrl=$apiBaseUrl,$scope.user=null,$stateParams.email?($scope.user={},$scope.user.email=$stateParams.email,angular.element("#password").focus()):angular.element("#email").focus(),$scope.login=function(){$scope.user.clientId||($scope.user.clientId="Mentor_Web_FleetManager"),$auth.login($scope.user).then(function(response){$auth.setToken(response),console.log(response.data.cdbUserId),console.log($auth.getPayload()),$state.go("fleet_amzl.report-weekly"),$rootScope.isAmazon=!0}).catch(function(error){$("#authentication-error").hide(),$("#authentication-error").html(error.data.message),$("#authentication-error").show()})},$scope.authenticate=function(provider){$auth.authenticate(provider).then(function(){$location.path("/asas")}).catch(function(error){error.error?toastr.error(error.error):error.data?toastr.error(error.data,error.status):toastr.error(error)})},$scope.forgotPassword=function(){$scope.user&&$scope.user.email?$location.path("/password_reset").search({email:$scope.user.email}):$location.path("/password_reset")}}),angular.module("edriving").controller("FleetMainCtrl",function($scope,$rootScope,$state,$timeout,$window,$http,$auth,toastr,Account,FleetService,$cookieStore,$log,$loading){$auth.isAuthenticated()||$state.go("logout",{loginUrl:"/login_fleet_amzl"}),$scope.show=!1,$scope.showAlert=function(obj){var div=$("#alert_div");$scope.show?(div.css("display","none"),$scope.show=!1):(div.css("display","block"),$scope.show=!0)},$rootScope.$on("alertReceived",function(event,data){$rootScope.alert_count=data.total,$rootScope.alerts=data.alerts}),$apiBaseUrl=$apiBaseDomain+"/mentor-fleetmanager/api/",Account.getProfile().then(function(response){$rootScope.user=response.data}).catch(function(response){toastr.error(response.data.message,response.status)}),$rootScope.loggedInCompanyUser=$auth.getPayload().companyUser;var companyId=$rootScope.loggedInCompanyUser.companyId;$rootScope.company,$rootScope.users=[],$rootScope.usersMap={},$rootScope.groupsList=[],$rootScope.groupsMap={},$rootScope.groupsTree={},$scope.userReportData,$scope.userReportDataList=[],$scope.groupReportData,$scope.companyReportData,$rootScope.reloadGroups=function(companyId,callback){FleetService.getGroups(companyId,!0).then(function(response,status){for(var map={},i=0;i<response.data.length;i++)map[response.data[i].id]=response.data[i];var node,roots=[];for(i=0;i<response.data.length;i++)(node=response.data[i]).nodes||(node.nodes=[]),map[node.parentGroupId]&&node.parentGroupId?(map[node.parentGroupId].nodes||(map[node.parentGroupId].nodes=[]),map[node.parentGroupId].nodes.push(node)):roots.push(map[node.id]);$rootScope.groupsTree=roots,$rootScope.groupsMap=map;var list=[];for(i=0;i<roots.length;i++)generateGroupNameWithPath("",roots[i]);function generateGroupNameWithPath(prefix,node){node.nameWithPath=prefix+node.code,list.push(node);for(var i=0;i<node.nodes.length;i++)generateGroupNameWithPath(prefix+node.code+" - ",node.nodes[i])}$rootScope.groupsList=list,sessionStorage.setItem("groupsList",list),callback&&callback()})},$rootScope.reloadUsers=function(companyId,callback){FleetService.getUsers(companyId,!1,!0).then(function(response,status){for(var usersMap={},usersList=[],i=0;i<response.data.length;i++)response.data[i].user&&(usersList.push(response.data[i]),usersMap[response.data[i].user.UserId]=response.data[i],$rootScope.groupsMap[response.data[i].driverGroupId]||(response.data[i].driverGroupId="-1"));$rootScope.users=usersList,$rootScope.usersMap=usersMap,callback&&callback()})},$loading.start("loading_org"),FleetService.getCompany(companyId).then(function(response,status){$rootScope.company=response.data,FleetService.getCompanyMentorProfile(companyId,!0).then(function(response,status){$rootScope.companyAppProfile=response.data,"Mentor_AMZL"==$rootScope.companyAppProfile.applicationCode||"Mentor_Audit"==$rootScope.companyAppProfile.applicationCode||"OMS_Web"==$rootScope.companyAppProfile.applicationCode?($rootScope.groupLabel="Station",$rootScope.groupsLabel="Stations"):($rootScope.groupLabel="Group",$rootScope.groupsLabel="Groups"),FleetService.getGroups(companyId).then(function(response,status){for(var map={},i=0;i<response.data.length;i++)map[response.data[i].id]=response.data[i];$rootScope.groupsMap=map;var node,roots=[];for(i=0;i<response.data.length;i++)(node=response.data[i]).nodes||(node.nodes=[]),map[node.parentGroupId]&&node.parentGroupId?(map[node.parentGroupId].nodes||(map[node.parentGroupId].nodes=[]),map[node.parentGroupId].nodes.push(node)):roots.push(map[node.id]);$rootScope.groupsTree=roots;var list=[];for(i=0;i<roots.length;i++)generateGroupNameWithPath("",roots[i]);function generateGroupNameWithPath(prefix,node){node.nameWithPath=prefix+node.code,list.push(node);for(var i=0;i<node.nodes.length;i++)generateGroupNameWithPath(prefix+node.code+" - ",node.nodes[i])}$rootScope.groupsList=list,FleetService.getUsers(companyId,!1,!0).then(function(response,status){for(var usersMap={},usersList=[],userIdsList=[],i=0;i<response.data.length;i++)if(response.data[i].user){usersList.push(response.data[i]),usersMap[response.data[i].user.UserId]=response.data[i],userIdsList.push(response.data[i].user.UserId);var displayName=response.data[i].user.FirstName?response.data[i].user.FirstName:"";if(response.data[i].user.LastName&&(displayName+=" "+response.data[i].user.LastName),""==displayName.trim()&&(displayName=response.data[i].user.UserId),response.data[i].user.displayName=displayName,!$rootScope.groupsMap[response.data[i].driverGroupId]&&(response.data[i].driverGroupId=-1,!$rootScope.groupsMap[-1])){var unassignedNodeGroup={id:-1,name:"UNASSIGNED",nameWithPath:"UNASSIGNED"};$rootScope.groupsMap[-1]=unassignedNodeGroup,$rootScope.groupsList.push(unassignedNodeGroup)}}$rootScope.users=usersList,$rootScope.usersMap=usersMap,sessionStorage.setItem("usersMap",usersMap),sessionStorage.setItem("companyId",companyId),$scope.usersWeekImprovement,$scope.usersTrend={},function(companyId){var start=1e3*moment().startOf("day").unix(),end=1e3*moment().endOf("day").unix();FleetService.getDvcrStatus(companyId,start,end).then(function(response){if($scope.total_alert_count=0,$scope.total_alert={severity1_count:0,severity2_count:0,severity3_count:0},response.data.length>0)for(var i=0;i<response.data.length;i++)response.data[i].severity1_count&&($scope.total_alert.severity1_count+=response.data[i].severity1_count,$scope.total_alert_count+=response.data[i].severity1_count),response.data[i].severity2_count&&($scope.total_alert.severity2_count+=response.data[i].severity2_count,$scope.total_alert_count+=response.data[i].severity2_count),response.data[i].severity3_count&&($scope.total_alert.severity3_count+=response.data[i].severity3_count,$scope.total_alert_count+=response.data[i].severity3_count);$scope.total_alert_count>0&&($rootScope.$emit("alertReceived",{total:$scope.total_alert_count,alerts:$scope.total_alert}),$("#s_badge").css("diplay","inline"),$("#s_badge").html($scope.total_alert))},function(err){console.log(err)})}(companyId),$loading.finish("loading_org"),FleetService.getDriversFirstLogin(companyId).then(function(response,status){$scope.driversFirstLogin=response.data})})})})}),$scope.gotoUserTrend=function(userId){$scope.reportParam.user=userId,$state.go(".report-trend")},$scope.reportParam={cat:null,group:null,user:null,period:"last 6 weeks"},$timeout(function(){$window.dispatchEvent(new Event("resize"))},100)}),angular.module("edriving").controller("FleetSignupCtrl",function($scope,$rootScope,$location,toastr,FleetService,SweetAlert,$state){(new Date).getTime();$rootScope.clearSelectCompany(),$scope.newCompany={name:"",billingAdmin:{FirstName:"",LastName:"",Email:"",Password:"DUMMY",PhoneNumber:""}},$scope.appProfile={timezone:"America/Los_Angeles",locale:"en_US",language:"en",billing:"NORMAL",applicationCode:"Mentor_Business",countryCode:"US",platform:"VRM2"},$scope.signup=function(){console.log($scope.newCompany),"Mentor_AMZL"==$scope.appProfile.applicationCode&&"NORMAL"==$scope.appProfile.billing&&($scope.newCompany.distributor="amzl"),$scope.appProfile.language=$scope.appProfile.locale.split("_")[0],$scope.appProfile.countryCode=$scope.appProfile.locale.split("_")[1],$scope.newCompany.billingAdmin.Products=FleetService.getUserProductByProfile($scope.appProfile.billing,$scope.appProfile.applicationCode,$scope.appProfile.language,$scope.appProfile.countryCode),FleetService.createCompany($scope.newCompany).then(function(response){FleetService.patchCompanyMentorProfile(response.data.id,$scope.appProfile).then(function(response2){console.log(response.data),FleetService.updateUserProfile(response.data.billingAdmin.UserId,$scope.appProfile).then(function(response3){console.log(response3.data),$rootScope.selectCompany(response.data.id,function(){console.log($rootScope.company),$state.go("csr.provisionWizard.groups")})}).catch(function(e){toastr.error(e.data.Message?e.data.Message:e)})}).catch(function(e){toastr.error(e.data.Message?e.data.Message:e)})}).catch(function(e){1020==e.data.Code&&swal({title:e.data.Message,type:"error",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"}).then(function(){}).catch(function(){})})}}),angular.module("edriving").controller("FleetEditCtrl",function($scope,$rootScope,$location,toastr,FleetService,SweetAlert,$state,$stateParams){this.$onInit=function(){$scope.companyId=$stateParams.companyId,$scope.loadCompany($scope.companyId),$("#wizardTitle").css("display","none"),$("#wizardType").css("display","none")},$scope.loadCompany=function(companyId){FleetService.getCompany(companyId,!0).then(function(response,status){$scope.editCompany=response.data,FleetService.getCompanyMentorProfile(companyId,!0).then(function(response,status){$scope.appProfile=response.data,$scope.appProfile.locale=$scope.appProfile.language+"_"+$scope.appProfile.countryCode,"Mentor_AMZL"==$scope.appProfile.applicationCode||"Mentor_Audit"==$scope.appProfile.applicationCode?$rootScope.groupLabel="Station":$rootScope.groupLabel="Group"})})},$scope.update=function(){"Mentor_AMZL"==$scope.appProfile.applicationCode&&"NORMAL"==$scope.appProfile.billing&&($scope.editCompany.distributor="amzl"),FleetService.updateCompany($scope.editCompany,$scope.companyId).then(function(response){$scope.appProfile.language=$scope.appProfile.locale.split("_")[0],$scope.appProfile.countryCode=$scope.appProfile.locale.split("_")[1],FleetService.patchCompanyMentorProfile($scope.companyId,$scope.appProfile).then(function(response2){$state.go("csr.company")}).catch(function(e){console.log(e),toastr.error(e.data.Message?e.data.Message:e)})}).catch(function(e){console.log(e),1020==e.data.Code&&swal({title:e.data.Message,type:"error",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"}).then(function(){}).catch(function(){})})}}),angular.module("edriving").controller("newEditGroupCtrl",function($scope,$location,toastr,FleetService,SweetAlert,$rootScope,$state,$stateParams,$loading){$scope.editMode="New",$scope.saveMode="Create Group",this.$onInit=function(){if($rootScope.reloadGroups($rootScope.company.id),$("#wizardTitle").css("display","none"),$("#wizardType").css("display","none"),$stateParams.id){$scope.editMode="Edit",$scope.saveMode="Update Group","Mentor_AMZL"==$rootScope.companyAppProfile.applicationCode||"Mentor_Audit"==$rootScope.companyAppProfile.applicationCode?($scope.saveMode="Update Station",$scope.groupTitle="Station"):($scope.saveMode="Update Group",$scope.groupTitle="Group"),$scope.id=$stateParams.id;var selected=$rootScope.groupsList.find(function(e){return e.id==$scope.id});$scope.editGroup=selected}else"Mentor_AMZL"==$rootScope.companyAppProfile.applicationCode||"Mentor_Audit"==$rootScope.companyAppProfile.applicationCode?($scope.saveMode="Create Station",$scope.groupTitle="Station"):($scope.saveMode="Create Group",$scope.groupTitle="Group")},$scope.backToStations=function(){$state.go($rootScope.app+".group")},$scope.save=function(){$scope.id?(console.log($scope.editGroup),FleetService.updateGroup($rootScope.company.id,$scope.id,$scope.editGroup).then(function(response){$rootScope.reloadGroups($rootScope.company.id)}).catch(function(e){console.log(e)})):FleetService.addGroup($rootScope.company.id,$scope.editGroup).then(function(response){console.log(response),$rootScope.reloadGroups($rootScope.company.id)}).catch(function(e){console.log(e)}),$scope.backToStations()}}),angular.module("edriving").controller("FleetReportTrendCtrl",function($scope,$rootScope,$http,$auth,$timeout,toastr,FleetService,moment,$cookieStore,$log,$loading,$stateParams,ClientReportSvc){$scope.chartOpt={};function isEmpty(obj){return 0===Object.keys(obj).length&&obj.constructor===Object}$scope.userId=$stateParams.userId,$scope.groupId=$stateParams.groupId,$scope.companyId=$stateParams.companyId,$scope.nodata=!1,$timeout(function(){if($stateParams.userId>0){$scope.selected={text:"",key:$scope.userId,type:"user"};var first_name=$scope.usersMap[$scope.userId].user.FirstName,last_name=$scope.usersMap[$scope.userId].user.LastName;$scope.full_name=first_name+" "+last_name}else $stateParams.groupId>0?($scope.selected={text:"",key:$scope.groupId,type:"group"},$scope.full_name=$rootScope.groupsMap[$scope.groupId].code):$stateParams.companyId>0?($scope.selected={text:"",key:$scope.companyId,type:"company"},$scope.full_name="Company"):($scope.companyId=$rootScope.company.id,$scope.selected={text:"",key:$scope.companyId,type:"company"},$scope.full_name="Company")},2500),this.$onInit=function(){$scope.initUserMap(),$scope.initGroupMap(),$scope.initCompanyMap(),$scope.initSearchKeys(),$scope.reportCategories=ClientReportSvc.getReportCategories(),console.log($scope.reportParam),$scope.reportParam.category=$scope.reportCategories[0],$loading.start("loading_report")},$scope.searchKeys=[],$scope.initUserMap=function(){!$rootScope.usersMap||isEmpty($rootScope.usersMap)?$timeout(function(){$scope.initUserMap()},200):$scope.usersMap=$rootScope.usersMap},$scope.initGroupMap=function(){if(!$rootScope.groupsMap||isEmpty($rootScope.groupsMap))sessionStorage.getItem("groupsMap")&&($rootScope.groupsMap=JSON.parse(sessionStorage.getItem("groupsMap"))),$timeout(function(){$scope.initGroupMap()},200);else{$scope.groupsFilter=[];for(var i=0;i<$rootScope.groupsList.length;i++)$scope.groupsFilter.push({label:$rootScope.groupsList[i].nameWithPath,value:$rootScope.groupsList[i].id});$scope.groupsMap=$rootScope.groupsMap}},$scope.initCompanyMap=function(){"distributor"==$rootScope.app?!$rootScope.companiesMap||isEmpty($rootScope.companiesMap)?(sessionStorage.getItem("companiesMap")&&($rootScope.companiesMap=JSON.parse(sessionStorage.getItem("companiesMap"))),$timeout(function(){$scope.initCompanyMap()},200)):$scope.companiesMap=$rootScope.companiesMap:$rootScope.company?($scope.companiesMap={},$scope.companiesMap[$rootScope.company.id]=$rootScope.company):$timeout(function(){$scope.initCompanyMap()},200)},$scope.initSearchKeys=function(){"distributor"==$rootScope.app?!$scope.companiesMap||isEmpty($scope.companiesMap)||!$scope.groupsMap||isEmpty($scope.groupsMap)?$timeout(function(){$scope.initSearchKeys()},500):$scope.buildSearchKeys():!$scope.companiesMap||isEmpty($scope.companiesMap)||!$scope.groupsMap||isEmpty($scope.groupsMap)||!$scope.usersMap||isEmpty($scope.usersMap)?$timeout(function(){$scope.initSearchKeys()},500):$scope.buildSearchKeys()},$scope.buildSearchKeys=function(){var searchBoxHint,groupLabel,companyLabel;for(var group in"distributor"==$rootScope.app?(groupLabel="station",companyLabel="DSP",searchBoxHint="STATION OR DSP"):"Mentor_AMZL"==$rootScope.companyAppProfile.applicationCode?(groupLabel="station",companyLabel="DSP",searchBoxHint="DRIVER OR STATION"):(groupLabel="group",companyLabel="fleet",searchBoxHint="DRIVER OR GROUP"),$scope.searchBoxHint=searchBoxHint,$scope.groupsMap){var txt;if($scope.groupsMap[group].id>0)txt="distributor"==$rootScope.app?$scope.companiesMap[$scope.groupsMap[group].companyId].code+" - "+$scope.groupsMap[group].nameWithPath:$scope.groupsMap[group].nameWithPath,$scope.searchKeys.push({object:$scope.groupsMap[group],text:groupLabel+": "+txt,key:$scope.groupsMap[group].id,type:"group"})}for(var user in $scope.usersMap)$scope.usersMap[user].id>0&&$scope.searchKeys.push({object:$scope.usersMap[user],text:"driver: "+$scope.usersMap[user].user.displayName,key:user,type:"user"});for(var companyId in $scope.companiesMap)$scope.companiesMap[companyId].id>0&&$scope.searchKeys.push({object:$scope.companiesMap[companyId],text:companyLabel+": "+$scope.companiesMap[companyId].code,key:companyId,type:"company"})},$scope.getCompanyReport=function(){return new Promise(function(resolve,reject){FleetService.getGroupsReport($scope.companyId,$scope.reportParam.periodStart,$scope.reportParam.periodEnd,$scope.reportParam.interval).then(function(response,status){return resolve(response.data)}).catch(function(err){return reject(response.data)})})},$scope.getUserReport=function(){return new Promise(function(resolve,reject){FleetService.getUserReport($scope.companyId,$scope.userId,$scope.reportParam.periodStart,$scope.reportParam.periodEnd,$scope.reportParam.interval).then(function(response,status){return resolve(response.data)}).catch(function(err){return reject(response.data)})})},$scope.renderEmptyData=function(){$loading.finish("loading_report"),$scope.nodata=!0},$scope.renderChart=function(full_name,list){if(list&&0!=list.length){list=list.sort(function(a,b){return new Date(a.fromDate)-new Date(b.fromDate)});var series=ClientReportSvc.getCategoryDataOnly(list,$scope.reportParam.category,$scope.categories);$scope.categories=list.reduce(function(acc,el){return el&&(el.fromDate=moment(el.fromDate,"MM/DD/YYYY").format("MM/DD"),el.toDate=moment(el.toDate,"MM/DD/YYYY").format("MM/DD"),el.fromDate==el.toDate?acc.push(el.fromDate):acc.push(el.fromDate+"-"+el.toDate)),acc},[]),$loading.finish("loading_report"),Highcharts.chart("container",{chart:{type:"line",scrollablePlotArea:{minWidth:700,scrollPositionX:1},style:{fontFamily:"inherit"}},title:{text:full_name},xAxis:{categories:$scope.categories,type:"datetime",labels:{overflow:"justify"}},yAxis:{tickWidth:1,lineWidth:1,opposite:!0,title:null},plotOptions:{series:{color:"#6A6C6D",lineWidth:3,shadow:!0,marker:{radius:8,lineWidth:4,lineColor:"#FFFFFF",fillColor:"#528f1f"}}},tooltip:{shared:!0,crosshairs:!0},series:series})}else $scope.renderEmptyData()},$scope.$watch("selected",function(){$scope.selected&&$scope.selected.type&&$scope.update()}),$scope.update=function(){$scope.nodata=!1,$loading.start("loading_report"),Highcharts.chart("container",{series:[],title:{text:""}});var obj=ClientReportSvc.calculatePeriod($scope.reportParam.period);$scope.reportParam.periodStart=obj.periodStart,$scope.reportParam.periodEnd=obj.periodEnd,$scope.reportParam.interval=obj.interval,$scope.chartOpt.xAxis=obj.xAxis;var list=[];"user"==$scope.selected.type&&($scope.userId=$scope.selected.key,$scope.getUserReport().then(function(data){if(data){if(list=ClientReportSvc.generateReportData(data,$scope.usersMap,$scope.groupsMap,$scope.companiesMap),data.length>0&&$scope.usersMap[data[0].recordKey]){var first_name=$scope.usersMap[data[0].recordKey].user.FirstName,last_name=$scope.usersMap[data[0].recordKey].user.LastName;$scope.full_name=first_name+" "+last_name}$scope.renderChart($scope.full_name,list)}})),"company"==$scope.selected.type&&($scope.companyId=$scope.selected.key,$scope.getCompanyReport().then(function(data){$scope.reportCategories[4].visible=!0,$scope.$apply(),data&&(data&&(data=data.find(function(e){return"COMPANY"==e.recordType})),$scope.full_name=$scope.companiesMap[$scope.companyId].code,list=ClientReportSvc.generateReportData([data],$scope.usersMap,$scope.groupsMap,$scope.companiesMap),$scope.renderChart($scope.full_name,list))})),"group"==$scope.selected.type&&($scope.selected.object&&($scope.companyId=$scope.selected.object.companyId),$scope.getCompanyReport().then(function(data){data?(data&&(data=data.find(function(e){return"GROUP"==e.recordType&&e.recordKey==$scope.selected.key})),data?($scope.full_name=$scope.groupsMap[$scope.selected.key].nameWithPath,list=ClientReportSvc.generateReportData([data],$scope.usersMap,$scope.groupsMap,$scope.companiesMap),$scope.renderChart($scope.full_name,list)):$scope.renderEmptyData()):$scope.renderEmptyData()}))}}),angular.module("edriving").controller("FleetProvisionWizardCtrl",function($scope,$rootScope,$http,$auth,toastr,Account,$cookieStore,$log){}),angular.module("edriving").controller("FleetCompanySummaryCtrl",function($scope,$rootScope,$http,$auth,toastr,Account,$cookieStore,$log,$location){$scope.driversCount=0,$scope.managersCount=0,$scope.loggedInDriver=0,$scope.activeDriver=0,$scope.activeDriver2=0,$scope.activeDays=7,$scope.activeDays2=30,$scope.editEmail=function(userId){$location.path("/csr/updateUserEmail/"+userId)},$scope.$watchGroup(["users","driversLatestReport","driversFirstLogin"],function(newVal,oldVal){if($rootScope.users&&$scope.driversLatestReport&&$scope.driversFirstLogin){$scope.driversCount=0,$scope.managersCount=0,$scope.loggedInDriver=0,$scope.activeDriver=0,$scope.activeDriver2=0;for(var i=$rootScope.users.length-1;i>=0;i--)if($rootScope.users[i].user){if($rootScope.users[i].isDriver&&($scope.driversCount++,$scope.driversFirstLogin[$rootScope.users[i].user.UserId]&&$scope.driversFirstLogin[$rootScope.users[i].user.UserId].firstLogin&&$scope.loggedInDriver++,$scope.driversLatestReport[$rootScope.users[i].user.UserId]&&$scope.driversLatestReport[$rootScope.users[i].user.UserId].tripsData)){var d=moment().diff(moment($scope.driversLatestReport[$rootScope.users[i].user.UserId].tripsData.date,"YYYY-MM-DD"),"days");d<$scope.activeDays&&$scope.activeDriver++,d<$scope.activeDays2&&$scope.activeDriver2++}$rootScope.users[i].isManager&&$scope.managersCount++}}})}),angular.module("edriving").controller("FleetGroupCtrl",function($scope,$rootScope,$http,$auth,toastr,Account,$cookieStore,$log,$state,FleetService){$scope.app=$rootScope.app,$scope.removeGroup=function(){var id=$scope.toBeDeletedGroup.$modelValue.id;FleetService.deleteGroup($rootScope.company.id,id).then(function(response){$scope.reloadGroups($rootScope.company.id)}),$scope.toBeDeletedGroup.remove()},$scope.setToBeDeletedGroup=function(treeNodeScope){$scope.toBeDeletedGroup=treeNodeScope},$scope.newSubItem=function(scope){var nodeData=scope.$modelValue,newGroup={name:nodeData.name+"."+nodeData.nodes.length,companyId:null,parentGroupId:nodeData.id,allowSubgroup:!1,nodes:[]};FleetService.addGroup($rootScope.company.id,newGroup).then(function(response){var newNode={id:10*nodeData.id+nodeData.nodes.length,name:nodeData.name+"."+(nodeData.nodes.length+1),nodes:[]};nodeData.nodes.push(newNode),newNode.id=response.data.id,$scope.reloadGroups($rootScope.company.id)}).catch(function(e){console.log(e),alert(e.data.Message)}),console.log(newGroup)},$scope.editName=function(scope){var nodeData=scope.$modelValue;$state.go("^.provisionWizard.groupEdit",{id:nodeData.id})},$scope.setUpNewGroup=function(){var newName;if(newName="Mentor_AMZL"==$rootScope.companyAppProfile.applicationCode||"Mentor_Audit"==$rootScope.companyAppProfile.applicationCode?prompt("Please Enter Station Code:"):prompt("Please Enter Group Name:"),console.log(newName),null!=newName&&""!=newName){var newGroup={name:newName};FleetService.addGroup($rootScope.company.id,newGroup).then(function(response){$scope.reloadGroups($rootScope.company.id)}).catch(function(e){console.log(e),alert(e.data.Message)})}},$scope.collapseAll=function(){$scope.$broadcast("angular-ui-tree:collapse-all")},$scope.expandAll=function(){$scope.$broadcast("angular-ui-tree:expand-all")}}),angular.module("edriving").controller("FleetAccountCtrl",function($scope,$rootScope,uiGridConstants,$http,$auth,$state,toastr,Account,FleetService,CsrService,$cookieStore,$log,$loading){$scope.disableResendActivation={},$scope.gridOptions={enableColumnMenus:!1,enableFiltering:!0,onRegisterApi:function(gridApi){$scope.gridApi=gridApi}},$scope.companyId=$rootScope.loggedInCompanyUser.companyId,$scope.sendBulkActivation=function(){var usersToSendActivation=[];$scope.users.forEach(function(e){$rootScope.driversFirstLogin&&($rootScope.driversFirstLogin[e.user.UserId].firstLogin||e.user.UserId==$rootScope.company.billingAdmin.UserId||usersToSendActivation.push(e.user))}),$loading.start("loading_report"),$scope.sendGroupActivation(usersToSendActivation)},$scope.bulkSendSize=10,$scope.sendGroupActivation=function(group){if(0==group.length)$loading.finish("loading_report"),console.log("........................Finished Sending..............................");else{for(var promises=[],i=0;i<$scope.bulkSendSize;i++){var user=group.pop();user&&promises.push($scope.sendActivation(user.Email,user.UserId))}Promise.all(promises).then(function(){$scope.sendGroupActivation(group)}).catch(function(err){console.log(err),$scope.sendGroupActivation(group)})}},$scope.sendActivation=function(email,userId){return new Promise(function(resolve,reject){console.log(email),$scope.disableResendActivation[userId]=!0,resolve(email)})},this.$onInit=function(){FleetService.getDriversFirstLogin($scope.companyId).then(function(response){$rootScope.driversFirstLogin=response.data}),FleetService.getCompany($scope.companyId,!0).then(function(response){$rootScope.company=response.data})},$scope.resendActivation=function(userId,email){$scope.disableResendActivation[userId]=!0,CsrService.resendActivation(email).then(function(response){console.log(response.data),toastr.success("Activation email sent.")})},$rootScope.$watch("users",function(){for(var i=0;i<$scope.users.length;i++){var productStr=[];if($scope.users[i].user&&$scope.users[i].user.Products){for(var j=0;j<$scope.users[i].user.Products.length;j++){var pd=$scope.users[i].user.Products[j];pd.ProductCode.indexOf("MENTOR-MODULE")<0&&(productStr.push(pd.ProductCode),pd.ProductCode.indexOf("VRM-OMS")>-1&&($scope.users[i].user.omsStatus=pd.Status))}$scope.users[i].user.ProductStr=productStr.join(",")}}})}),angular.module("edriving").controller("FleetProvisionNewUserCtrl",function($scope,$rootScope,FleetService,$http,$auth,toastr,Account,$cookieStore,$log,$state,$loading){console.log("$rootScope.companyAppProfile"),console.log($rootScope.companyAppProfile),$scope.userProducts=FleetService.getUserProductByProfile($rootScope.companyAppProfile.billing,$rootScope.companyAppProfile.applicationCode,$rootScope.companyAppProfile.language,$rootScope.companyAppProfile.countryCode),console.log($scope.userProducts),$scope.userProducts||alert("no product defined");for(var templateCsv=[],i=(Date.now(),1);i<$rootScope.groupsList.length+1;i++)console.log($rootScope.groupsList[i-1]),$rootScope.groupsList[i-1].id>0&&templateCsv.push({a:"Driver "+i,b:"",c:"",d:"",e:$rootScope.groupsList[i-1].nameWithPath});$scope.backToUsers=function(){$state.go("^.users")},$scope.backToUploadUsers=function(){$("#uploadUsersData").show(),$("#editUploadUsersData").hide()},$scope.templateCsv=templateCsv,$scope.uploadUsers=[];var groupNameIdMap={};for(i=$scope.groupsList.length-1;i>=0;i--)groupNameIdMap[$scope.groupsList[i].nameWithPath]=$scope.groupsList[i].id;$scope.upload=function(){$loading.start("load_csv");if(/^([a-zA-Z0-9\s_\\.\-\(\):])+(.csv|.txt)$/.test($("#fileUpload").val().toLowerCase()))if("undefined"!=typeof FileReader){var reader=new FileReader;reader.onload=function(e){$scope.uploadUsers=[];for(var rows=e.target.result.split("\n"),i=1;i<rows.length;i++)if(""!=rows[i]){var cells=rows[i].split(",");console.log(JSON.stringify(cells)),cells[4]&&(cells[4]=cells[4].replace("\r","")),cells[5]&&(cells[5]=cells[5].replace("\r",""));var uploadUser={user:{Email:cells[2],FirstName:cells[0],LastName:cells[1],PhoneNumber:cells[3]},isDriver:null,isManager:null,driverGroupId:groupNameIdMap[cells[4]],driverGroupId_raw:cells[4],managerGroupId:groupNameIdMap[cells[5]],managerGroupId_raw:cells[5],uploaded:!1};console.log(JSON.stringify(uploadUser)),$scope.uploadUsers.push(uploadUser)}$scope.$apply()},reader.onloadend=function(e){$loading.finish("load_csv"),$("#uploadUsersData").hide(),$("#editUploadUsersData").show()},reader.readAsText($("#fileUpload")[0].files[0])}else $loading.finish("load_csv"),alert("This browser does not support HTML5.");else $loading.finish("load_csv"),alert("Please upload a valid CSV file.")},$scope.create=function(){for(var i=0;i<$scope.uploadUsers.length;i++)if(!$scope.uploadUsers[i].driverGroupId)return alert("Driver station cannot be blank, please specify which station to drive"),!1;$loading.start("upload_users");var m={};for(i=0;i<$scope.uploadUsers.length;i++)m[$scope.uploadUsers[i].user.Email]=$scope.uploadUsers[i],$scope.uploadUsers[i].uploaded=!1,$scope.uploadUsers[i].uploadError=null;var uploadSuccessCount=0,uploadFailCount=0;i=0;!function loopUploadOneUser(){var uploadUser=$scope.uploadUsers[i],companyUser={user:{Email:uploadUser.user.Email,UserName:uploadUser.user.Email,FirstName:uploadUser.user.FirstName,LastName:uploadUser.user.LastName,PhoneNumber:uploadUser.user.PhoneNumber,Products:$scope.userProducts},isDriver:!0,isManager:uploadUser.managerGroupId>0,driverGroupId:uploadUser.driverGroupId,managerGroupIds:uploadUser.managerGroupId?[uploadUser.managerGroupId]:[]};FleetService.createUser($scope.company.id,companyUser).then(function(response){m[response.data.user.Email].uploaded=!0,++uploadSuccessCount+uploadFailCount==$scope.uploadUsers.length&&($loading.finish("upload_users"),$scope.uploadUsers=$scope.uploadUsers.filter(function(item){return!item.uploaded}),0==uploadFailCount?swal({title:"All records Uploaded",text:uploadSuccessCount+" users uploaded",type:"success",showCancelButton:!1,confirmButtonColor:"#3085d6"}).then(function(){$scope.reloadUsers($scope.company.id,function(){$state.go("^.users")})}):swal({title:"Failed Upload",text:uploadFailCount+" of "+(uploadFailCount+uploadSuccessCount)+" records failed uploading, please check the error message",type:"warning",showCancelButton:!1,confirmButtonColor:"#3085d6"}))}).catch(function(e){m[e.config.data.user.Email].uploadError=e.data,uploadFailCount++,console.log(m[e.config.data.user.Email]),uploadSuccessCount+uploadFailCount==$scope.uploadUsers.length&&($loading.finish("upload_users"),$scope.uploadUsers=$scope.uploadUsers.filter(function(item){return!item.uploaded}),swal({title:"Failed Upload",text:uploadFailCount+" of "+(uploadFailCount+uploadSuccessCount)+" records failed uploading, please check the error message",type:"warning",showCancelButton:!1,confirmButtonColor:"#3085d6"}))}),++i<$scope.uploadUsers.length&&setTimeout(loopUploadOneUser,300)}()}}),angular.module("edriving").controller("userSignupCtrl",function($scope,$location,toastr,FleetService,SweetAlert,$rootScope,$state,$loading){$scope.driverStatus=!0,setTimeout(function(){$("#driverSelection").toggle()},200),console.log($rootScope.companyAppProfile),$scope.userProducts=FleetService.getUserProductByProfile($rootScope.companyAppProfile.billing,$rootScope.companyAppProfile.applicationCode,$rootScope.companyAppProfile.language,$rootScope.companyAppProfile.countryCode),console.log($scope.userProducts),$scope.userProducts||alert("no product defined"),$("#driverSelection").hide(),$("#stationSelection").hide(),$scope.changeDriverStatus=function(){$("#driverSelection").toggle()},$scope.changeManagerStatus=function(){$("#stationSelection").toggle()},$scope.backToUsers=function(){$state.go("^.users")},$scope.managerGroups=[],$scope.managerGroupIds=[],$scope.addManagerGroup=function(item){$scope.managerGroups.indexOf(item)>=0||$scope.managerGroups.push(item),$("#stationSelection").prop("selectedIndex",0)},$scope.removeManagerGroup=function(item){var index=$scope.managerGroups.indexOf(item);index>=0&&$scope.managerGroups.splice(index,1)},$scope.signupUser=function(){if(1!=$scope.driverStatus||$scope.driverGroupId){$loading.start("user_saving"),$scope.companyId=$scope.company.id;for(var i=0;i<$scope.managerGroups.length;i++)for(var j=0;j<$rootScope.groupsList.length;j++)$scope.managerGroups[i]==$rootScope.groupsList[j].nameWithPath&&$scope.managerGroupIds.push($rootScope.groupsList[j].id);null==$scope.driverStatus&&($scope.driverStatus=!0),null==$scope.managerStatus&&($scope.managerStatus=!1),0==$scope.driverStatus&&($scope.driverGroupId=null),0==$scope.managerStatus&&($scope.managerGroupIds=[]);var userDetails={isDriver:$scope.driverStatus,driverGroupId:$scope.driverGroupId,isManager:$scope.managerStatus,managerGroupIds:$scope.managerGroupIds,user:{FirstName:$scope.user.firstName,LastName:$scope.user.lastName,Email:$scope.user.email,UserName:$scope.user.email,PhoneNumber:$scope.user.phoneNumber,Products:$scope.userProducts}};FleetService.createUser($scope.companyId,userDetails).then(function(response){$scope.reloadUsers($scope.company.id,function(){$scope.driverStatus=!0,$scope.driverGroupId=null,$scope.managerStatus,$scope.managerGroupIds=[],$scope.user.firstName="",$scope.user.lastName="",$scope.user.email="",$scope.user.phoneNumber="",$loading.finish("user_saving"),$state.go("^.users")})}).catch(function(e){$loading.finish("user_saving"),toastr.error(e.data.Message?e.data.Message:e)})}else alert("Please specify the station to drive.")}}),angular.module("edriving").controller("companyUserUpdateCtrl",function($scope,$http,$compile,$auth,toastr,Account,CourseService,FleetService,$rootScope,$stateParams,$state,TIME_ZONE,$loading,$timeout){$scope.deleteUser=function(){$loading.start("user_saving"),FleetService.deleteUser($scope.company.id,$scope.user.id,$scope.user.user.UserId).then(function(){$scope.reloadUsers($scope.company.id,function(){$loading.finish("user_saving"),$state.go("^.users")})}).catch(function(e){$loading.finish("user_saving"),alert(e.data.message)})},$scope.backToUsers=function(){$state.go("^.users")},$scope.loadUser=function(){var obj;$rootScope.usersMap&&(obj=$rootScope.usersMap,0!==Object.keys(obj).length||obj.constructor!==Object)?($scope.user=$rootScope.usersMap[$scope.userId],$scope.company.billingAdmin.UserId==$scope.user.user.UserId&&($scope.isBillingAdmin=!0),FleetService.getUserMentorProfile($scope.user.user.UserId,!0).then(function(profile){profile.data?$scope.user.profile=profile.data:$scope.user.profile={countryCode:"US",language:"en",ownerId:$scope.user.user.UserId,timezone:"America/Los_Angeles",type:"USER"},console.log($scope.user),$scope.selected_time_zone=$scope.user.profile.timezone,$scope.selected_locale=$scope.user.profile.language+"_"+$scope.user.profile.countryCode,$scope.driverStatus=$scope.user.isDriver,$scope.updatedDriverGroup=$scope.user.driverGroupId,$scope.managerStatus=$scope.user.isManager,$scope.managerGroups=[],0==$scope.user.isDriver&&$("#driverSelection").hide(),0==$scope.user.isManager&&$("#stationSelection").hide();for(var i=0;i<$scope.user.managerGroupIds.length;i++)for(var j=0;j<$rootScope.groupsList.length;j++)$scope.user.managerGroupIds[i]==$rootScope.groupsList[j].id&&$scope.managerGroups.push($rootScope.groupsList[j].nameWithPath);for(j=0;j<$rootScope.groupsList.length;j++)$scope.user.driverGroupId==$rootScope.groupsList[j].id&&($scope.driverGroupId=$rootScope.groupsList[j].id);$scope.UpdatedmanagerGroups=$scope.managerGroups})):$timeout(function(){$scope.loadUser()},1e3)},this.$onInit=function(){$scope.loadUser()},$scope.timze_zone=TIME_ZONE,$scope.userId=$stateParams.companyUserId,$scope.UpdatedmanagerGroupIds=[],$scope.addManagerGroup=function(item){$scope.UpdatedmanagerGroups.indexOf(item)>=0||$scope.UpdatedmanagerGroups.push(item),$scope.UpdatedmanagerGroups.length>0&&($scope.managerStatus=!0),$("#stationSelection").prop("selectedIndex",0),$("")},$scope.removeManagerGroup=function(item){var index=$scope.UpdatedmanagerGroups.indexOf(item);index>=0&&$scope.UpdatedmanagerGroups.splice(index,1),0==$scope.UpdatedmanagerGroups.length&&($scope.managerStatus=!1)},$scope.changeDriverStatus=function(){$("#driverSelection").toggle()},$scope.changeManagerStatus=function(){$("#stationSelection").toggle()},$scope.updateCompanyUser=function(driverStatus,driverGroupId,managerStatus,selectedManagerGroup){$loading.start("user_saving"),$scope.companyId=$scope.company.id;for(var i=0;i<$scope.UpdatedmanagerGroups.length;i++)for(var j=0;j<$rootScope.groupsList.length;j++)$scope.UpdatedmanagerGroups[i]==$rootScope.groupsList[j].nameWithPath&&$scope.UpdatedmanagerGroupIds.push($rootScope.groupsList[j].id);0==driverStatus&&(driverGroupId=null),0==managerStatus&&($scope.UpdatedmanagerGroupIds=[]);var companyUserUpdates={isDriver:driverStatus,isManager:managerStatus,driverGroupId:driverGroupId,managerGroupIds:$scope.UpdatedmanagerGroupIds};console.log(companyUserUpdates),FleetService.updateCompanyUser($scope.companyId,$scope.user.id,companyUserUpdates).then(function(response){FleetService.updateUserInfo($scope.user.user.UserId,{FirstName:$scope.user.user.FirstName,LastName:$scope.user.user.LastName,PhoneNumber:$scope.user.user.PhoneNumber,Email:$scope.user.user.Email}).then(function(){$scope.reloadUsers($scope.company.id,function(){$loading.finish("user_saving"),$state.go("^.users")})})}).catch(function(e){$loading.finish("user_saving"),toastr.error(e.data.Message?e.data.Message:e)})}}),angular.module("edriving").controller("updateUserEmailCtrl",function($scope,CsrService,$rootScope,$stateParams,$loading,$state){$scope.goBack=function(){$rootScope.selectCompany($scope.companyId),$state.go("csr.company")},$scope.loadUser=function(){$scope.userId=$stateParams.companyUserId,CsrService.queryUserByCdbId($scope.userId,!0).then(function(response,status){$scope.user=response.data.User,$scope.$apply()})},this.$onInit=function(){$scope.loadUser()},$scope.updateEmail=function(){$loading.start("user_saving"),CsrService.updateEmail($scope.user.UserId,$scope.user.Email).then(function(){$loading.finish("user_saving"),$scope.goBack()})}}),angular.module("edriving").controller("FleetUserActivationCtrl",function($scope,$location,$auth,SatellizerConfig,toastr,jwtHelper,$state,$stateParams,FleetService,$rootScope,$translate,LocaleService,$loading){var tokenPayload;if($apiBaseUrl=$apiBaseDomain+"/mentor-fleet/api/",SatellizerConfig.baseUrl=$apiBaseUrl,$stateParams.token)try{(tokenPayload=jwtHelper.decodeToken($stateParams.token))&&($scope.user={email:tokenPayload.sub.email,token:$stateParams.token})}catch(e){$(".activate-account").hide(),$(".activate-invalid-token").show()}tokenPayload&&($loading.start("activating_account"),FleetService.getActivation($stateParams.token).then(function(response,status){$scope.activation=response.data,$loading.finish("activating_account")}).catch(function(response){console.log(response),$loading.finish("activating_account"),$(".activate-account").hide(),$(".activate-expired-token").show()})),$scope.updatePassword=function(){$loading.start("activating_account"),FleetService.activateUser($scope.password,$stateParams.token).then(function(response){$loading.finish("activating_account"),$(".activate-account").hide(),$(".activate-success").show()}).catch(function(response){$loading.finish("activating_account"),$(".activate-account").hide(),$(".activate-failed").show(),$(".activate-500").show()})}}),angular.module("edriving").controller("FleetResourcesCtrl",function($scope,$rootScope,$http,$auth,toastr,Account,$cookieStore,$log){$scope.managerResources=[{url:"/img/docs/Mentor.Getting.Started.pdf",name:"Getting Started",desc:"Welcome to the Mentor program including “10 Steps to Success”  "},{url:"/img/docs/Mentor.Manager.Guide.pdf",name:"Manager Guide",desc:"Tips and tools for managers, including a tour of the Manager Portal"},{url:"/img/docs/Mentor.Launch.Email.Template.docx",name:"Launch Email Template",desc:"Editable email template to help you introduce Mentor and communicate organizational expectations and implementation plans"},{url:"/img/docs/Mentor.Manager.Launch.Presentation.pdf",name:"Launch Presentation for Drivers",desc:"PowerPoint deck with scripted talking points to help you present Mentor goals, features, benefits, scoring, and more to your drivers"},{url:"/img/docs/Mentor_Product_Sheet_English.pdf",name:"Mentor Product Sheet",desc:"Glossy information sheet to help drivers understand what Mentor is and how it works"},{url:"/img/docs/SMART_Driving_Principles_Poster_Samples.pdf",name:"SMART Driving Posters - Thumbnails",desc:"Sample views of posters available for hanging in kitchens, common areas or hallways to help spread the message about Mentor and SMART Driving."},{url:"/img/docs/SMART_poster_CHECK_FINAL.tif",name:"SMART Driving Posters – Print Ready “Check Yourself”",desc:"Print-ready version of SMART Driving Principles poster. Print using heavy cover or poster stock with velvet or matte finish.  Or ask your account manager for help obtaining printed versions."},{url:"/img/docs/SMART_poster_WRECK_FINAL.tif",name:"SMART Driving Posters – Print Ready “Wreck Yourself”",desc:"Print-ready version of SMART Driving Principles poster. Print using heavy cover or poster stock with velvet or matte finish.  Or ask your account manager for help obtaining printed versions."},{url:"/img/docs/SMART_poster_SAFETY_FINAL.tif",name:"SMART Driving Posters – Print Ready “No Accident”",desc:"Print-ready version of SMART Driving Principles poster. Print using heavy cover or poster stock with velvet or matte finish.  Or ask your account manager for help obtaining printed versions."},{url:"/img/docs/SMART_poster_STOP_FINAL.tif",name:"SMART Driving Posters – Print Ready “STOP sign”",desc:"Print-ready version of SMART Driving Principles poster. Print using heavy cover or poster stock with velvet or matte finish.  Or ask your account manager for help obtaining printed versions."}],$scope.driverResources=[{url:"/img/docs/Mentor.Driver.Pledge.pdf",name:"Driver Pledge",desc:"Copy of safety pledge each driver signs, committing to embrace Mentor and practice safe, defensive SMART driving"},{url:"/img/docs/Mentor.Sample.Emails.pdf",name:"Sample Mentor emails",desc:"Samples of introductory and weekly emails sent from Mentor team to drivers"},{url:"/img/docs/Mentor.SMART.Driver.Guide.Knowledge.Check.pdf",name:"SMART Driving Guide Knowledge Check",desc:"15-question assessment covering eDriving’s SMART Driving Principles"},{url:"https://www.edriving.com/mentor/driving-guide/",name:"Driver’s Guide",desc:"Guide to help drivers get started using Mentor to track and improve their driving; Found in the “More” section of Mentor app"},{url:"https://www.edriving.com/mentor/faqs/",name:"FAQs",desc:"Frequently Asked Questions covering Mentor’s tracking, scoring, and reporting; Found in the “More” section of Mentor app"},{url:"https://www.edriving.com/mentor/terms/",name:"Terms of Service",desc:"Terms and Conditions governing drivers’ use of the Mentor app"},{url:"https://www.edriving.com/mentor/privacy/",name:"Privacy Policy",desc:"Policy explaining Mentor’s information collection practices, and how drivers’ personal information is used, shared and updated."}]});class FleetAnalyticsCtrl{constructor($stateParams,$timeout){this.$stateParams=$stateParams,this.portal=null,$timeout(()=>this.ngOnInit())}async ngOnInit(){this.portal=this.$stateParams.client}}angular.module("edriving").controller("FleetAnalyticsCtrl",FleetAnalyticsCtrl);class FleetAnalytics__detailsCtrl{constructor($state,$stateParams,$timeout,$loading,FicoScoreRating,toastr){this.exportCsv=this.exportCsv.bind(this),this.ngOnInit=this.ngOnInit.bind(this),this.$state=$state,this.$stateParams=$stateParams,this.$loading=$loading,this.FicoScoreRating=FicoScoreRating,this.toastr=toastr,this.items={data:[],loading:!0},this.portal=null,$timeout(()=>this.ngOnInit())}async ngOnInit(){if(this.portal=this.$stateParams.client,this.$stateParams.dsp||(this.$stateParams.dsp=window.sessionStorage.companyId),this.$stateParams.value)try{let interval;this.$loading.start("FLEET_ANALYTICS_DETAILS"),this.$stateParams.startDate&&(interval={startDate:this.$stateParams.startDate,endDate:this.$stateParams.endDate}),this.items={data:await this.FicoScoreRating.getDetailsItems(this.$stateParams.dsp,this.$stateParams.value,interval),loading:!1},this.$loading.finish("FLEET_ANALYTICS_DETAILS")}catch(err){console.error(err),this.toastr.error(err.message)}else this.$state.go("^.analytics")}exportCsv(tableId){const rows=document.querySelectorAll("table#"+tableId+" tr"),csv=[];for(const row of rows){const rowArray=[],cols=row.querySelectorAll("td, th");for(const col of cols){let data=col.innerText.replace(/(\r\n|\n|\r)/gm,"").replace(/(\s\s)/gm," ");data=data.replace(/"/g,'""'),rowArray.push('"'+data+'"')}csv.push(rowArray.join(";"))}const csv_string=csv.join("\n"),filename="export_"+tableId+"_"+(new Date).toLocaleDateString()+".csv",link=document.createElement("a");link.style.display="none",link.setAttribute("target","_blank"),link.setAttribute("href","data:text/csv;charset=utf-8,"+encodeURIComponent(csv_string)),link.setAttribute("download",filename),document.body.appendChild(link),link.click(),document.body.removeChild(link)}}angular.module("edriving").controller("FleetAnalytics__detailsCtrl",FleetAnalytics__detailsCtrl),angular.module("edriving").controller("FleetResourcesAmzlCtrl",function($scope,$rootScope,$http,$auth,toastr,Account,$cookieStore,$log){$scope.managerResources=[{url:"/img/docs/Amazon DSP Welcome Pack FINAL.pdf",name:"Getting Started",desc:'Welcome to the Mentor program, including hiring resources and "10 Steps to Success!" '},{url:"/img/docs/Amazon DSP Manager Guide_FINAL.pdf",name:"Manager Guide",desc:"Tips and tools for managers, including instructions on how to use the Manager Portal"},{url:"/img/docs/Amazon DSP Launch Email Templates.pdf",name:"Launch Email Template",desc:"Editable email template to help you introduce Mentor and communicate organizational expectations and implementation plans"},{url:"/img/docs/Amazon DSP Driver Guide_7.13.pdf",name:"Launch Presentation to Drivers",desc:"Powerpoint deck with scripted talking points to help you present Mentor goals, features, benefits, scoring, and daily DVCR process"},{url:"/img/docs/Amazon DSP Driver Evaluation Form.pdf",name:"Driver Evaluation Form",desc:"Printable evaluation form for use with new driver training"},{url:"/img/docs/SMART_Driving_Principles_Poster_Samples.pdf",name:"SMART Driving Posters - Thumbnails",desc:"Sample views of posters available for hanging in kitchens, common areas or hallways to help spread the message about Mentor and SMART Driving."},{url:"/img/docs/SMART_poster_CHECK_FINAL.tif",name:"SMART Driving Posters – Print Ready “Check Yourself”",desc:"Print-ready version of SMART Driving Principles poster. Print using heavy cover or poster stock with velvet or matte finish.  Or ask your account manager for help obtaining printed versions."},{url:"/img/docs/SMART_poster_WRECK_FINAL.tif",name:"SMART Driving Posters – Print Ready “Wreck Yourself”",desc:"Print-ready version of SMART Driving Principles poster. Print using heavy cover or poster stock with velvet or matte finish.  Or ask your account manager for help obtaining printed versions."},{url:"/img/docs/SMART_poster_SAFETY_FINAL.tif",name:"SMART Driving Posters – Print Ready “No Accident”",desc:"Print-ready version of SMART Driving Principles poster. Print using heavy cover or poster stock with velvet or matte finish.  Or ask your account manager for help obtaining printed versions."},{url:"/img/docs/SMART_poster_STOP_FINAL.tif",name:"SMART Driving Posters – Print Ready “STOP sign”",desc:"Print-ready version of SMART Driving Principles poster. Print using heavy cover or poster stock with velvet or matte finish.  Or ask your account manager for help obtaining printed versions."}],$scope.driverResources=[{url:"/img/docs/Amazon DSP Driver Trifold FINAL.pdf",name:"Driver Guide",desc:"Printable handout for drivers to help them get started using Mentor to track and improve their driving. Print two-sided and fold into a trifold brochure."},{url:"/img/docs/SMART Driving Principles.pdf",name:"SMART Driving Guide",desc:"The 15 Principles of SMART Driving"},{url:"/img/docs/Mentor.Driver.Pledge.pdf",name:"Driver Pledge",desc:"Copy of safety pledge each driver signs, committing to embrace Mentor and practice safe, defensive SMART driving"},{url:"/img/docs/Mentor.SMART.Driver.Guide.Knowledge.Check.pdf",name:"SMART Driving Guide Knowledge Check",desc:"15-question assessment covering eDriving’s SMART Driving Principles"},{url:"/img/docs/Mentor Amazon FAQs FINAL.pdf",name:"FAQs",desc:"Frequently Asked Questions covering Mentor’s tracking, scoring, and reporting"},{url:"https://www.edriving.com/mentor/terms/",name:"Terms of Service",desc:"Terms and Conditions governing drivers’ use of the Mentor app"},{url:"https://www.edriving.com/mentor/privacy/",name:"Privacy Policy",desc:"Policy explaining Mentor’s information collection practices, and how drivers’ personal information is used, shared and updated."}],$scope.howtoVideos=[{url:"/img/docs/Amazon DSP Manager Portal Video Final.mp4",name:"Manager Portal Tutorial Video",desc:""},{url:"/img/docs/Amazon App Tutorial Video V2.2.mp4",name:"The Mentor App Tutorial Video",desc:""}]}),angular.module("edriving").controller("CsrMainCtrl",function($scope,$rootScope,$state,$timeout,$window,$http,$auth,toastr,Account,FleetService,$cookieStore,$log){$auth.isAuthenticated()||$state.go("logout",{loginUrl:"/login_csr"}),$apiBaseUrl=$apiBaseDomain+"/mentor-csr/api/",console.log($auth.getPayload()),$rootScope.userName=$auth.getPayload().sub,$rootScope.csrAuth={};for(var i=0;i<$auth.getPayload().auth.length;i++)$rootScope.csrAuth[$auth.getPayload().auth[i]]=!0;console.log($rootScope.csrAuth),$timeout(function(){$window.dispatchEvent(new Event("resize"))},100)}),angular.module("edriving").controller("CsrCompanyListCtrl",function($filter,$scope,uiGridConstants,$loading,$rootScope,$http,$auth,toastr,Account,CsrService,FleetService,$cookieStore,$log,$state){$scope.columns=[{field:"id",width:"5%",cellClass:"text-left"},{name:"billing",field:"appProfile.billing",filter:{selectOptions:[{value:"NORMAL",label:"Paying"},{value:"DEMO",label:"Demo"},{value:"INTERNAL",label:"Internal Test"}],type:uiGridConstants.filter.SELECT},width:"8%",cellClass:"text-left"},{name:"region",field:"appProfile.countryCode",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.appProfile.language}}_{{row.entity.appProfile.countryCode}} </div>',width:"8%",cellClass:"text-left"},{name:"timezone",field:"appProfile.timezone",width:"8%",cellClass:"text-left"},{name:"mentor app",field:"appProfile.applicationCode",filter:{selectOptions:[{value:"Mentor_AMZL",label:"AmazonDSP"},{value:"Mentor_Business",label:"Business"},{value:"Mentor_Consumer",label:"Families"},{value:"OMS_Web",label:"One More Second"}],type:uiGridConstants.filter.SELECT},width:"10%",cellClass:"text-left"},{field:"Company",field:"name",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.selectCompany(row.entity.id);"  ui-sref="csr.company">{{row.entity.name}}</a> </div>',cellClass:"text-left !important"},{field:"Code",field:"code",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.selectCompany(row.entity.id);"  ui-sref="csr.company">{{row.entity.code}}</a> </div>',cellClass:"text-left !important"},{name:"Admin",field:"billingAdmin.FirstName",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.billingAdmin.FirstName}} {{row.entity.billingAdmin.LastName}}</div>',cellClass:"text-left"},{name:"Email",field:"billingAdmin.Email",cellClass:"text-left"},{name:"Phone",field:"billingAdmin.PhoneNumber",width:"10%",cellClass:"text-left"}],$scope.gridOptions={enableGridMenu:!0,exporterMenuCsv:!0,exporterMenuPdf:!1,exporterMenuExcel:!1,exporterMenuVisibleData:!0,gridMenuShowHideColumns:!0,enableColumnMenus:!1,enableFiltering:!0,columnDefs:$scope.columns,onRegisterApi:function(gridApi){$scope.gridApi=gridApi}},$rootScope.companies?$scope.gridOptions.data=$rootScope.companies:($rootScope.companies=[],FleetService.getCompaniesByDistributor().then(function(response,status){for(var cIds=[],i=response.data.length-1;i>=0;i--)cIds.push(response.data[i].id);var x,y,temparray,chunkGetProfiles=[];for(x=0,y=cIds.length;x<y;x+=500)temparray=cIds.slice(x,x+500),chunkGetProfiles.push(FleetService.getCompaniesMentorProfile(temparray.join(",")));Promise.all(chunkGetProfiles).then(function(responses,status){for(var response2=[],j=0;j<responses.length;j++)response2=response2.concat(responses[j].data);var companyProfileMap={};for(j=response2.length-1;j>=0;j--)companyProfileMap[response2[j].ownerId]=response2[j];var companies=[],v1_companies=[];for(j=response.data.length-1;j>=0;j--){var companyProfile=companyProfileMap[response.data[j].id];response.data[j].appProfile=companyProfile,"VRM2"==companyProfile.platform?companies.push(response.data[j]):v1_companies.push(response.data[j])}$rootScope.companies=companies,$rootScope.v1_companies=v1_companies,console.log(v1_companies),$scope.gridOptions.data=companies,setTimeout(()=>{try{$scope.$apply()}catch(e){console.log(e)}},200)})})),$rootScope.reloadGroups=function(companyId,callback){FleetService.getGroups(companyId,!0).then(function(response,status){for(var map={},i=0;i<response.data.length;i++)map[response.data[i].id]=response.data[i];var node,roots=[];for(i=0;i<response.data.length;i++)(node=response.data[i]).nodes||(node.nodes=[]),map[node.parentGroupId]&&node.parentGroupId?(map[node.parentGroupId].nodes||(map[node.parentGroupId].nodes=[]),map[node.parentGroupId].nodes.push(node)):roots.push(map[node.id]);$rootScope.groupsTree=roots,$rootScope.groupsMap=map;var list=[];for(i=0;i<roots.length;i++)generateGroupNameWithPath("",roots[i]);function generateGroupNameWithPath(prefix,node){node.nameWithPath=prefix+node.name,list.push(node);for(var i=0;i<node.nodes.length;i++)generateGroupNameWithPath(prefix+node.name+" - ",node.nodes[i])}$rootScope.groupsList=list,callback&&callback()})},$rootScope.reloadUsers=function(companyId,callback){$rootScope.companyId=companyId,sessionStorage.setItem("companyId",companyId);var excludeCdbUser=!0;$rootScope.companyAppProfile&&"VRM2"==$rootScope.companyAppProfile.platform&&(excludeCdbUser=!1),FleetService.getUsers(companyId,excludeCdbUser,excludeCdbUser,!0).then(function(response,status){for(var usersMap={},i=0;i<response.data.length;i++)response.data[i].user&&(usersMap[response.data[i].user.UserId]=response.data[i],$rootScope.groupsMap[response.data[i].driverGroupId]||(response.data[i].driverGroupId="-1"));$rootScope.users=response.data,$rootScope.usersMap=usersMap,callback&&callback()})},$rootScope.reloadUserLoginAndTripStatus=function(callback){FleetService.getDriversLatestReport($rootScope.selectedCompanyId).then(function(response,status){$rootScope.driversLatestReport=response.data}),FleetService.getDriversFirstLogin($rootScope.selectedCompanyId).then(function(response,status){$rootScope.driversFirstLogin=response.data}),callback&&callback()},$rootScope.reloadUserLoginAndTripStatus2=function(callback){FleetService.getDriversLatestReport($rootScope.selectedCompanyId).then(function(response,status){$rootScope.driversLatestReport=response.data}),FleetService.getLoginStatByCompanyId($rootScope.selectedCompanyId).then(function(response,status){for(var m={},i=0;i<response.data.length;i++)m[response.data[i].user_id]=response.data[i];console.log(m),$rootScope.driversFirstLogin=m}),callback&&callback()},$rootScope.reloadUserPackages=function(companyId,callback){callback&&callback()},$rootScope.reloadCompany=function(companyId,callback){FleetService.getCompany(companyId,!0).then(function(response,status){$rootScope.company=response.data,FleetService.getCompanyMentorProfile(companyId,!0).then(function(response,status){$rootScope.companyAppProfile=response.data,"Mentor_AMZL"==$rootScope.companyAppProfile.applicationCode||"Mentor_Audit"==$rootScope.companyAppProfile.applicationCode?$rootScope.groupLabel="Station":$rootScope.groupLabel="Group",callback&&callback()}).catch(function(e){$rootScope.groupLabel="Group",callback&&callback()})})},$rootScope.selectCompany=function(companyId,callback){$rootScope.clearSelectCompany(),$rootScope.selectedCompanyId=companyId,$rootScope.reloadCompany(companyId,function(){$rootScope.reloadGroups(companyId,function(){$rootScope.reloadUsers(companyId,function(){$rootScope.reloadUserPackages(companyId,callback)})})})},$rootScope.clearSelectCompany=function(callback){$rootScope.selectedCompanyId=null,$rootScope.company=null,$rootScope.companyAppProfile=null,$rootScope.users=[],$rootScope.usersMap={},$rootScope.groupsList=[],$rootScope.groupsMap={},$rootScope.groupsTree={},$rootScope.availablePackages=[],$rootScope.userPackages={},$rootScope.driversFirstLogin=null}}),angular.module("edriving").controller("CsrSearchCtrl",function($scope,$rootScope,$state,$timeout,$window,$http,$auth,toastr,Account,FleetService,CsrService,Trips,CourseService,$cookieStore,$loading,$log){$scope.showDVCR=!1,$scope.queryStr="",$scope.queryType="Email or UserId",$scope.tab=1,$scope.queryUser=function(){"Email"==$scope.queryType?CsrService.queryUserByEmail($scope.queryStr,!0).then(function(response,status){$scope.clearSearch(),$scope.user=response.data,$scope.loadAppProfile(),$scope.loadVrmUser(),$scope.loadFleetProvision()}).catch(function(e){toastr.error(e.data.Error.Message?e.data.Error.Message:e)}):"UserId"==$scope.queryType&&CsrService.queryUserByCdbId($scope.queryStr,!0).then(function(response,status){CsrService.queryUserByEmail(response.data.User.Email,!0).then(function(response2,status){$scope.clearSearch(),$scope.user=response2.data,$scope.loadAppProfile(),$scope.loadVrmUser(),$scope.loadFleetProvision()})}).catch(function(e){toastr.error(e.data.Error.Message?e.data.Error.Message:e)}),$timeout(()=>{$("#btnsummary").click()},2e3)},$scope.changeQuery=function(){""==$scope.queryStr?$scope.queryType="Email or UserId":$scope.queryType=/^\d+$/.test($scope.queryStr)&&$scope.queryStr.length>8?"UserId":"Email"},$scope.loadVrmUser=function(){CsrService.queryVrmUserByCdbId($scope.user.UserId).then(function(response2,status){$scope.vrmUserInfo=response2.data})},$scope.loadFleetProvision=function(){$scope.company=null,CsrService.queryFleetProvisionCompanyUserByCdbId($scope.user.UserId).then(function(response,status){$scope.companyUser=response.data[0],CsrService.getCompany($scope.companyUser.companyId).then(function(response2,status){$scope.company=response2.data})})},$scope.openChangeEmail=function(){$scope.changeEmailError="",$scope.newEmail=""},$scope.updateEmail=function(){$scope.changeEmailError="",$loading.start("user_saving"),CsrService.updateEmail($scope.user.UserId,$scope.newEmail).then(function(){$scope.user.Email=$scope.newEmail,$("#closeModal").click()}).finally(()=>{$loading.finish("user_saving")})},$scope.moveUser=function(){$scope.changeEmailError="",$loading.start("user_saving"),CsrService.updateEmail($scope.user.UserId,$scope.newEmail).then(function(){$scope.user.Email=$scope.newEmail,$("#closeModal").click()}).finally(()=>{$loading.finish("user_saving")})},$scope.loadLoginSessions=function(){CsrService.getLoginSessions($scope.user.UserId).then(function(response,status){response.data.sort(function(a,b){return b.token.iat-a.token.iat}),$scope.loginSessions=response.data})},$scope.loadTrips=function(offset,limit){FleetService.getUserTrips($scope.user.UserId,offset,limit).then(function(response,status){for(var i=0;i<response.data.length;i++)if(response.data[i].eventCounts){for(var map={},j=0;j<response.data[i].eventCounts.length;j++)map[response.data[i].eventCounts[j].behaviouralImpact]=response.data[i].eventCounts[j].count;response.data[i].eventCounts=map}$scope.trips=response.data})},$scope.loadSummary=function(){FleetService.getUserSummary($scope.user.UserId).then(function(response,status){$scope.summary=response.data}),FleetService.getUserScores($scope.user.UserId).then(function(response,status){$scope.scores=response.data})},$scope.loadAppProfile=function(){FleetService.getUserMentorProfile($scope.user.UserId).then(function(response,status){$scope.appProfile=response.data,$scope.showDVCR="Mentor_AMZL"==$scope.appProfile.applicationCode||"Mentor_Audit"==$scope.appProfile.applicationCode})},$scope.loadPlaylist=function(){$scope.modules=null,CourseService.getCourses($scope.user.UserId).then(function(response,status){$scope.modules=response.data})},$scope.loadPlaylistDiff=function(){$scope.modulesDiff=null,CourseService.getCoursesDiff($scope.user.UserId).then(function(response,status){$scope.modulesDiff=response.data})},$scope.loadDVCR=function(){var m=moment(),end=m.valueOf(),start=m.subtract(15,"days").valueOf();$scope.dvcr=null,CsrService.getDvcrSummary(start,end,$scope.user.UserId).then(function(response,status){$scope.dvcr=response.data})},$scope.loadFeedbacks=function(){var m=moment();m.valueOf(),m.subtract(15,"days").valueOf();$scope.feedbacks=null,CsrService.getUserFeedbacks($scope.user.UserId).then(function(response,status){response.data.sort(function(a,b){return b.fb_time-a.fb_time}),$scope.feedbacks=response.data})},$scope.clearSearch=function(){$scope.user=null,$scope.loginSessions=null,$scope.vrmUserInfo=null,$scope.companyUser=null,$scope.loginSessions=null,$scope.trips=null,$scope.summary=null,$scope.trips=null,$scope.feedbacks=null,$scope.dvcr=null,$scope.modules=null,$scope.modulesDiff=null},$scope.clearSearch()}),angular.module("edriving").controller("CsrFeedbacksCtrl",function($filter,$scope,uiGridConstants,$loading,$rootScope,$http,$auth,toastr,Account,CsrService,$cookieStore,$log,$state){$scope.reportParam={periodStart:moment().format("YYYY-MM-DD")},$scope.yesterday=moment(),$scope.chartInited=!1,$scope.chartInited||($scope.columns=[{name:"zendesk",field:"jira",cellTemplate:'<div class="ui-grid-cell-contents"><a href="https://edriving-support.zendesk.com/agent/tickets/{{ COL_FIELD }}" target="mentor_jira">{{ COL_FIELD }}</a> </div>'},{name:"date",field:"fb_time",type:"date",cellFilter:'date:"M/d"'},{name:"time",field:"fb_time",type:"date",cellFilter:'date:"HH.mm"'},{name:"type",field:"fb_type",filter:{selectOptions:[{value:"APP_SUPPORT",label:"APP_SUPPORT"},{value:"TRIP_FEEDBACK",label:"TRIP_FEEDBACK"},{value:"SPEEDING_FEEDBACK",label:"SPEEDING_FEEDBACK"},{value:"SPEEDING_DISPUTE",label:"SPEEDING_DISPUTE"}],type:uiGridConstants.filter.SELECT}},{name:"category",field:"category",filter:{selectOptions:[{value:"PASSWORD_RESET",label:"Password Reset"},{value:"SPEEDING_DISPUTE",label:"Speeding Dispute"},{value:"PHONE_MANIPULATION_DISTRACTION",label:"Phone Manipulation/Distraction"},{value:"MISSING_SHORT_TRIPS",label:"Missing/Short Trips"},{value:"ACCELERATION_BRAKING_CORNERING",label:"Acceleration, Braking, Cornering"},{value:"DRIVER_PERSONAL_PASSENGER_SETTING",label:"Driver/Personal/Passenger Setting"},{value:"FICO_SCORE",label:"FICO Score"},{value:"TRIP_START_END",label:"Trip Start/End"},{value:"BATTERY_ISSUE",label:"Battery Issue"},{value:"OTHER",label:"Ohter"}],type:uiGridConstants.filter.SELECT}},{field:"company"},{field:"user_id"},{field:"trip_id",cellTemplate:'<div class="ui-grid-cell-contents">\n        \n        <a href="/#!/csr/feedbackmap?tripId={{ COL_FIELD }}&driverId={{ row.entity.user_id }}" target="_blank">{{ COL_FIELD }}</a> </div>'},{field:"os",visible:!1},{field:"app_version",visible:!1},{field:"user_speed",cellClass:"text-right"},{field:"system_post_speed",cellClass:"text-right"},{field:"user_claimed_post_speed",cellClass:"text-right"},{field:"unit"},{field:"event_start_time",type:"date",cellFilter:'date:"M/d HH.mm"'},{field:"event_duration",cellClass:"text-right"},{field:"start_geopoint",visible:!1},{field:"end_geopoint",visible:!1},{field:"comment",width:"20%"}],$scope.gridOptions={enableGridMenu:!0,exporterMenuCsv:!0,exporterMenuPdf:!1,exporterMenuExcel:!1,exporterMenuVisibleData:!0,gridMenuShowHideColumns:!0,enableColumnMenus:!1,enableFiltering:!0,columnDefs:$scope.columns,onRegisterApi:function(gridApi){$scope.gridApi=gridApi},exporterCsvFilename:"feedback_"+$scope.reportParam.periodStart+".csv",exporterFieldCallback:function(grid,row,col,input){if(col.cellFilter){var filters=col.cellFilter.split("|");return angular.forEach(filters,function(filter){var filterName=filter.split(":")[0],filterParams=filter.split(":").splice(1);filterParams.unshift(input);var filterFn=$filter(filterName);input=filterFn.apply(this,filterParams)}),input}return input}},$scope.chartInited=!0),$scope.$watchGroup(["reportParam.periodStart"],function(newValues,oldValues,scope){$loading.start("loading_report"),$scope.reportParam.periodEnd=$scope.reportParam.periodStart,CsrService.getFeedbacks($scope.reportParam.periodStart,$scope.reportParam.periodEnd).then(function(response,status){for(var gridData=[],i=0;i<response.data.length;i++)gridData.push(response.data[i]);$scope.gridOptions.data=gridData;var summaryMap={ALL:{count:0,users:new Set,trips:new Set}};for(i=0;i<response.data.length;i++){var fb=response.data[i];summaryMap.ALL.count++,summaryMap.ALL.users.add(fb.user_id),fb.trip_id&&summaryMap.ALL.trips.add(fb.trip_id),summaryMap[fb.fb_type]||(summaryMap[fb.fb_type]={count:0,users:new Set,trips:new Set}),summaryMap[fb.fb_type].count++,summaryMap[fb.fb_type].users.add(fb.user_id),fb.trip_id&&summaryMap[fb.fb_type].trips.add(fb.trip_id)}for(var key in summaryMap)summaryMap[key].users=summaryMap[key].users.size,summaryMap[key].trips=summaryMap[key].trips.size;$scope.summaryMap=summaryMap,$scope.getTableHeight=function(){return{height:30*gridData.length+30+30+"px"}},$loading.finish("loading_report")})})}),angular.module("edriving").controller("CsrZendeskSearchCtrl",function($scope,$stateParams,$rootScope,$state,$timeout,$window,$http,$auth,toastr,Account,FleetService,CsrService,Trips,CourseService,$cookieStore,$log){$scope.queryStr=$stateParams.zendeskTicketId,$scope.queryType="Zendesk",$scope.queryZendesk=function(){"Zendesk"==$scope.queryType&&CsrService.queryFeedbackByZendesk($scope.queryStr,!0).then(function(response,status){$scope.clearSearch(),$scope.feedback=response.data.feedback,$scope.roadSegments=response.data.roadSegments;for(var speedDataMap={},i=0;i<response.data.existedSpeedLimit.length;i++)speedDataMap[response.data.existedSpeedLimit[i].placeId]=response.data.existedSpeedLimit[i].speedLimit+" "+response.data.existedSpeedLimit[i].units;for(i=0;i<$scope.roadSegments.length;i++)$scope.roadSegments[i].currentSpeedData=speedDataMap[$scope.roadSegments[i].roadSegmentId]}).catch(function(e){toastr.error(e.data.Error.Message?e.data.Error.Message:e)})},$scope.clearSearch=function(){$scope.feedback=null,$scope.roadSegments=null},$scope.clearSearch(),$scope.queryStr&&$scope.queryZendesk()}),angular.module("edriving").controller("CsrDvcrSearchCtrl",function($scope,$stateParams,$rootScope,$state,$timeout,$filter,$http,$auth,toastr,Account,FleetService,CsrService,Trips,CourseService,$cookieStore,$log){$scope.queryDvcr=function(){var m=moment(),end=m.valueOf(),start=m.subtract(30,"days").valueOf();$scope.dvcr=null,CsrService.getDvcrSummaryByVin(start,end,$scope.vin).then(function(response,status){$scope.dvcr=response.data;for(var gridData=[],i=0;i<response.data.length;i++)gridData.push(response.data[i]);$scope.gridOptions.data=gridData})},$scope.clearSearch=function(){$scope.dvcr=null},$scope.clearSearch(),$scope.chartInited=!1,$scope.chartInited||($scope.columns=[{field:"id"},{field:"vin",width:"15%"},{field:"report_type_is_post",cellTemplate:'<div class="ui-grid-cell-contents">{{ COL_FIELD==2?"AUDIT":COL_FIELD==1?"POST":"PRE" }} </div>'},{field:"severity1_count",name:"S1",width:"4%"},{field:"severity2_count",name:"S2",width:"4%"},{field:"severity3_count",name:"S3",width:"4%"},{field:"pre_id"},{field:"report_time",type:"date",cellFilter:"amDateFormat:'MM/DD/YYYY HHmm Z'",width:"20%"},{field:"sameCondition",cellTemplate:'<div class="ui-grid-cell-contents">{{ COL_FIELD==1?"YES":"" }} </div>',width:"8%"},{field:"company_id"},{field:"group_id"},{field:"user_id"}],$scope.gridOptions={enableGridMenu:!0,exporterMenuCsv:!0,exporterMenuPdf:!1,exporterMenuExcel:!1,exporterMenuVisibleData:!0,gridMenuShowHideColumns:!0,enableColumnMenus:!1,enableFiltering:!0,columnDefs:$scope.columns,onRegisterApi:function(gridApi){$scope.gridApi=gridApi},exporterCsvFilename:"dcvr_"+$scope.vin+".csv",exporterFieldCallback:function(grid,row,col,input){if(col.cellFilter){var filters=col.cellFilter.split("|");return angular.forEach(filters,function(filter){var filterName=filter.split(":")[0],filterParams=filter.split(":").splice(1);filterParams.unshift(input);var filterFn=$filter(filterName);input=filterFn.apply(this,filterParams)}),input}return input}},$scope.chartInited=!0)}),angular.module("edriving").controller("CsrCircleSearchCtrl",function($scope,$stateParams,$rootScope,$state,$timeout,$filter,$http,$auth,toastr,Account,FleetService,CsrService,Trips,CourseService,$cookieStore,$log){$scope.queryDvcr=function(){moment();$scope.circle=null,CsrService.getCircle($scope.cId).then(function(response,status){$scope.circle=response.data;for(var userIds=[],i=0;i<response.data.users.length;i++)userIds.push(response.data.users[i].user_id);CsrService.getUserProfiles(userIds.join(",")).then(function(response2,status){$scope.userProfiles={};for(var i=0;i<response2.data.length;i++)$scope.userProfiles[response2.data[i].userId]=response2.data[i];for(i=0;i<response.data.users.length;i++)response.data.users[i].user=$scope.userProfiles[response.data.users[i].user_id];$scope.gridOptions.data=response.data.users,console.log($scope.userProfiles)})})},$scope.clearSearch=function(){$scope.circle=null},$scope.clearSearch(),$scope.chartInited=!1,$scope.chartInited||($scope.columns=[{field:"id"},{field:"user_id"},{field:"user.firstName"},{field:"user.lastName"},{field:"setting"}],$scope.gridOptions={enableGridMenu:!0,exporterMenuCsv:!0,exporterMenuPdf:!1,exporterMenuExcel:!1,exporterMenuVisibleData:!0,gridMenuShowHideColumns:!0,enableColumnMenus:!1,enableFiltering:!0,columnDefs:$scope.columns,onRegisterApi:function(gridApi){$scope.gridApi=gridApi}},$scope.chartInited=!0)}),angular.module("edriving").controller("CsrFleetAccountCtrl",function($scope,$rootScope,uiGridConstants,$http,$auth,$state,toastr,Account,FleetService,CsrService,$cookieStore,$log){function initChart(reportParam_cat){for(var gridData=[],i=0;i<$rootScope.users.length;i++){var user=$rootScope.users[i],userData=user;if(user.user){userData.group=$rootScope.groupsMap[user.driverGroupId]?$rootScope.groupsMap[user.driverGroupId].nameWithPath:"";var groupName=[];if(user.isManager)for(var j=0;j<user.managerGroupIds.length;j++)$rootScope.groupsMap[user.managerGroupIds[j]]&&groupName.push($rootScope.groupsMap[user.managerGroupIds[j]].nameWithPath);userData.managedGroupNames=groupName.join(", "),user.user&&user.user.UserId==$rootScope.company.billingAdmin.UserId?user.role="Admin":user.isManager&&(user.role="Manager"),user.user&&user.user.UserId&&$rootScope.driversFirstLogin&&$rootScope.driversFirstLogin[user.user.UserId]&&(userData.firstLogin=$rootScope.driversFirstLogin[user.user.UserId].first_login),user.user&&user.user.UserId&&$rootScope.driversLatestReport&&$rootScope.driversLatestReport[user.user.UserId]&&$rootScope.driversLatestReport[user.user.UserId].tripsData&&(userData.lastTrip=$rootScope.driversLatestReport[user.user.UserId].tripsData.date),"OMS_Web"==$rootScope.companyAppProfile.applicationCode||"Mentor_Audit"==$rootScope.companyAppProfile.applicationCode||$rootScope.company.code&&"amzl audits"==$rootScope.company.code.toLowerCase()?userData.showActivationButton=!1:$rootScope.driversFirstLogin||$rootScope.driversLatestReport?userData.firstLogin||userData.lastTrip?userData.showActivationButton=!1:userData.showActivationButton=!0:userData.showActivationButton=!1,gridData.push(userData)}else console.log("fleet provision user found with no cdb user",user)}$scope.gridOptions.data=gridData}$scope.disableResendActivation={},$scope.columns=[{field:"user.UserId",name:"Id",width:"8%"},{field:"id",name:"CompanyUserId",width:"8%"},{field:"user.FirstName",name:"First Name",cellTemplate:'<div class="ui-grid-cell-contents"><a ui-sref="^.companyUserPage({companyUserId:row.entity.user.UserId})">{{row.entity.user.FirstName}}</a> </div>'},{field:"user.LastName",name:"Last Name"},{field:"user.Email",name:"Email"},{field:"role",width:"5%"},{field:"group"},{field:"managedGroupNames",name:"Managed Groups"},{field:"user.ProductStr",name:"Product"},{field:"firstLogin",cellFilter:'date:"shortDate"',enableFiltering:!1,width:"8%"},{field:"showActivationButton",cellTemplate:'<span ng-if="grid.appScope.driversFirstLogin && !grid.appScope.driversFirstLogin[row.entity.user.UserId][\'first_login\'] && grid.appScope.driversLatestReport && !grid.appScope.driversLatestReport[row.entity.user.UserId].tripsData && grid.appScope.companyAppProfile.applicationCode!=\'OMS_Web\' && grid.appScope.companyAppProfile.applicationCode!=\'Mentor_Audit\' && grid.appScope.company.code.toLowerCase()!=\'amzl audits\'"><a class="btn btn-xs btn-default" ng-click="grid.appScope.resendActivation(row.entity.user.UserId,row.entity.user.Email)" ng-if="!grid.appScope.disableResendActivation[row.entity.user.UserId]">send activation email</a><a class="btn btn-xs btn-default" disabled ng-if="grid.appScope.disableResendActivation[row.entity.user.UserId]">send activation email</a></span>',enableFiltering:!1,cellClass:"text-center",width:"8%"},{field:"lastTrip",cellFilter:'date:"shortDate"',enableFiltering:!1,width:"8%"}],$scope.gridOptions={enableGridMenu:!0,exporterMenuCsv:!0,exporterMenuPdf:!1,exporterMenuExcel:!1,exporterMenuVisibleData:!0,gridMenuShowHideColumns:!0,enableColumnMenus:!1,enableFiltering:!0,columnDefs:$scope.columns,onRegisterApi:function(gridApi){$scope.gridApi=gridApi}},$scope.resendActivation=function(userId,email){$scope.disableResendActivation[userId]=!0,CsrService.resendActivation(email).then(function(response){console.log(response.data),toastr.success("Activation email sent.")})},$scope.reloadUserLoginAndTripStatus=function(){FleetService.getDriversLatestReport($rootScope.selectedCompanyId,!0).then(function(response,status){$rootScope.driversLatestReport=response.data,FleetService.getLoginStatByCompanyId($rootScope.selectedCompanyId).then(function(response,status){for(var m={},i=0;i<response.data.length;i++)m[response.data[i].user_id]=response.data[i];$rootScope.driversFirstLogin=m,initChart()})})},$rootScope.$watch("users",function(){for(var i=0;i<$scope.users.length;i++){var productStr=[];if($scope.users[i].user&&$scope.users[i].user.Products){for(var j=0;j<$scope.users[i].user.Products.length;j++){var pd=$scope.users[i].user.Products[j];pd.ProductCode.indexOf("MENTOR-MODULE")<0&&(productStr.push(pd.ProductCode),pd.ProductCode.indexOf("VRM-OMS")>-1&&($scope.users[i].user.omsStatus=pd.Status))}$scope.users[i].user.ProductStr=productStr.join(", ")}}initChart()})}),angular.module("edriving").controller("CsrRulesEngineMgmtCtrl",function($filter,$scope,uiGridConstants,$loading,$rootScope,$http,$auth,toastr,Account,RulesEngineService,$cookieStore,$log,$state){$scope.sequenceName="prescription_time_based_201901",$scope.querySequence=function(){$loading.start("loading_report"),RulesEngineService.getSequence($scope.sequenceName).then(function(response,status){for(var gridData=[],i=0;i<response.data.length;i++){var masterModule=response.data[i],modules=masterModule.modules;masterModule.masterProductCode=masterModule.masterProductCode.replace("MENTOR-MODULE-","");for(var j=0;j<modules.length;j++)modules[j].Language&&(modules[j].MasterProductCode==modules[j].ProductCode&&(masterModule.AppTitle=modules[j].AppTitle,masterModule.AppDescription=modules[j].AppDescription),modules[j].locale=modules[j].Language,modules[j].Locale&&(modules[j].locale+="_"+modules[j].Locale),masterModule[modules[j].locale]=modules[j].ProductCode.replace("MENTOR-MODULE-",modules[j].inRulesEngine?"":"--"));delete masterModule.modules,console.log(masterModule),gridData.push(masterModule)}$scope.gridOptions.data=gridData,$loading.finish("loading_report")})},$scope.getUlmsModules=function(){$loading.start("loading_report"),RulesEngineService.getUlmsModules().then(function(response,status){var gridData=[],columns={};for(var masterProductCode in response.data){var modules=response.data[masterProductCode],masterModule={};masterModule.masterProductCode=masterProductCode.replace("MENTOR-MODULE-","");for(var j=0;j<modules.length;j++)modules[j].Language&&(modules[j].MasterProductCode==modules[j].ProductCode&&(masterModule.AppTitle=modules[j].AppTitle,masterModule.AppDescription=modules[j].AppDescription),modules[j].locale=modules[j].Language,modules[j].Locale&&(modules[j].locale+="_"+modules[j].Locale,columns[modules[j].locale]=modules[j].locale),masterModule[modules[j].locale]=modules[j].ProductCode.replace("MENTOR-MODULE-",modules[j].isInRulesEngine?"":"--"));console.log(masterModule),gridData.push(masterModule)}var columnDefs=[{field:"masterProductCode"},{field:"AppTitle",displayName:"title"},{field:"AppDescription",displayName:"desc"}];for(var locale in columns)columnDefs.push({field:locale,displayName:locale});$scope.gridOptions.data=gridData,$scope.gridOptions.columnDefs=columnDefs,$loading.finish("loading_report")})},$scope.columns=[{field:"masterProductCode"},{field:"AppTitle",displayName:"title"},{field:"AppDescription",displayName:"desc"},{field:"en-US",displayName:"en-US"},{field:"es-419",displayName:"es-419"},{field:"en-AU-UK-NZ",displayName:"en-AU-UK-NZ"},{field:"pt-BR",displayName:"pt-BR"},{field:"fr-CA",displayName:"fr-CA"},{field:"es-ES",displayName:"es-ES"},{field:"it-IT",displayName:"it-IT"},{field:"fr-FR",displayName:"fr-FR"},{field:"nl-NL",displayName:"nl-NL"},{field:"pl-PL",displayName:"pl-PL"},{field:"ru-null",displayName:"ru-RU"},{field:"de-null",displayName:"de-DE"}],$scope.columns_sequence=[{field:"week"},{field:"isoWeekday"}].concat($scope.columns),$scope.chartInited=!1,$scope.chartInited||($scope.gridOptions={enableGridMenu:!0,exporterMenuCsv:!0,exporterMenuPdf:!1,exporterMenuExcel:!1,exporterMenuVisibleData:!0,gridMenuShowHideColumns:!0,enableColumnMenus:!1,enableFiltering:!0,onRegisterApi:function(gridApi){$scope.gridApi=gridApi}},$scope.chartInited=!0)}),angular.module("edriving").controller("CsrFleetStoreTransCtrl",function($scope,$rootScope,$location,toastr,FleetService,StoreSvc,$state,$stateParams,uiGridConstants){this.$onInit=function(){StoreSvc.getStoreProducts().then(function(res){$scope.products=res.data;var productsMap={};$scope.products.map(product=>{productsMap[product.id]=product}),$scope.productsMap=productsMap,$scope.productId="387"})},$scope.fetchData=function(){console.log($scope.productsMap[$scope.productId]),StoreSvc.getStoreTrans($scope.start,$scope.end,$scope.productId,$scope.productsMap[$scope.productId].lang).then(function(res){$scope.gridOptions.data=res.data,$scope.gridApi.core.notifyDataChange(uiGridConstants.dataChange.ALL)})},$scope.gridOptions={enableColumnMenus:!1,enableFiltering:!0,enableGridMenu:!0,enableSelectAll:!0,exporterCsvFilename:"store_trans.csv",onRegisterApi:function(gridApi){$scope.gridApi=gridApi}}}),angular.module("edriving").controller("LoginDistributorCtrl",function($scope,$window,$location,$auth,SatellizerConfig,toastr,$cookieStore,$state,Account,CourseService,FleetService,$rootScope,$http,$log,$stateParams){function assembleGroupTree(groupsArray){for(var list=[],map={},i=0;i<groupsArray.length;i++)map[groupsArray[i].id]=groupsArray[i];var node,roots=[];for(i=0;i<groupsArray.length;i++)(node=groupsArray[i]).nodes||(node.nodes=[]),map[node.parentGroupId]&&node.parentGroupId?(map[node.parentGroupId].nodes||(map[node.parentGroupId].nodes=[]),map[node.parentGroupId].nodes.push(node)):roots.push(map[node.id]);for(i=0;i<roots.length;i++)generateGroupNameWithPath("",roots[i]);return list;function generateGroupNameWithPath(prefix,node){node.nameWithPath=prefix+node.code,list.push(node);for(var i=0;i<node.nodes.length;i++)generateGroupNameWithPath(prefix+node.code+" - ",node.nodes[i])}}$apiBaseUrl=$apiBaseDomain+"/mentor-distributor/api/",SatellizerConfig.baseUrl=$apiBaseUrl,$stateParams.noRedirect?($stateParams.email?($scope.user={email:$stateParams.email},angular.element("#password").focus()):angular.element("#email").focus(),$scope.login=function(){$auth.login($scope.user,{timeout:3e3}).then(function(response){if($auth.setToken(response),console.log($auth.getPayload()),$rootScope.userName=$auth.getPayload().sub,$rootScope.distributor=$auth.getPayload().distributor,$rootScope.distributorAuth={},$auth.getPayload().auth)for(var i=0;i<$auth.getPayload().auth.length;i++)$rootScope.distributorAuth[$auth.getPayload().auth[i]]=!0;console.log(response.data.cdbUserId),$scope.initRootScope().then(function(){$state.go("distributor.report")})}).catch(function(error){toastr.error(error.data.message)})},$rootScope.groupsList=[],$scope.initRootScope=function(){return new Promise((resolve,reject)=>{$rootScope.companies||($rootScope.companies=[],$rootScope.companiesMap={},FleetService.getCompaniesByDistributor($rootScope.distributor).then(function(response){for(var companies=[],i=response.data.length-1;i>=0;i--)companies.push(response.data[i]);$rootScope.companies=companies;var companiesMap={};for(i=0;i<companies.length;i++)delete companies[i].billingAdmin,companiesMap[companies[i].id]=companies[i];$rootScope.companiesMap=companiesMap,sessionStorage.setItem("companiesMap",JSON.stringify(companiesMap));var companyIds=[];for(var key in companiesMap)companyIds.push(key);FleetService.getCompaniesGroup(companyIds).then(function(response){for(var groupsMap={},i=0;i<response.data.length;i++)if(response.data[i])for(var groupsWithPath=assembleGroupTree(response.data[i]),j=0;j<groupsWithPath.length;j++)groupsMap[groupsWithPath[j].id]=groupsWithPath[j];return $rootScope.groupsMap=groupsMap,console.log(JSON.stringify(groupsMap).length),sessionStorage.setItem("groupsMap",JSON.stringify(groupsMap)),resolve()}).catch(err=>reject(err))}).catch(ex=>reject(ex)))})},$scope.authenticate=function(provider){$auth.authenticate(provider).then(function(){$location.path("/asas")}).catch(function(error){error.error?toastr.error(error.error):error.data?toastr.error(error.data,error.status):toastr.error(error)})},$scope.forgotPassword=function(){$scope.user&&$scope.user.email?$location.path("/password_reset").search({email:$scope.user.email}):$location.path("/password_reset")}):$window.location.href="https://edriving-distributor-amzl.auth.us-west-2.amazoncognito.com/login?response_type=code&client_id=4htf8quohn7tiqppaja8s7tkom&redirect_uri=https://apigateway.mentor.edriving.com/mentor-distributor/api/v1/amzl/auth_cognito_redirect"}),angular.module("edriving").controller("LoginAmzlCognitoCtrl",function($scope,$location,$auth,SatellizerConfig,toastr,jwtHelper,$state,Account,CourseService,FleetService,$rootScope,$http,$log,$stateParams){function assembleGroupTree(groupsArray){for(var list=[],map={},i=0;i<groupsArray.length;i++)map[groupsArray[i].id]=groupsArray[i];var node,roots=[];for(i=0;i<groupsArray.length;i++)(node=groupsArray[i]).nodes||(node.nodes=[]),map[node.parentGroupId]&&node.parentGroupId?(map[node.parentGroupId].nodes||(map[node.parentGroupId].nodes=[]),map[node.parentGroupId].nodes.push(node)):roots.push(map[node.id]);for(i=0;i<roots.length;i++)generateGroupNameWithPath("",roots[i]);return list;function generateGroupNameWithPath(prefix,node){node.nameWithPath=prefix+node.code,list.push(node);for(var i=0;i<node.nodes.length;i++)generateGroupNameWithPath(prefix+node.code+" - ",node.nodes[i])}}$apiBaseUrl=$apiBaseDomain+"/mentor-distributor/api/",SatellizerConfig.baseUrl=$apiBaseUrl,FleetService.loginCognito($stateParams.code).then(function(response,status){$auth.setToken(response),console.log(response),console.log($auth.getPayload());try{var amzlAccessToken=$auth.getPayload().acccess_token;$rootScope.userName=jwtHelper.decodeToken(amzlAccessToken).username}catch(e){console.log(e)}$rootScope.distributor=$auth.getPayload().distributor,$scope.initRootScope().then(function(){$state.go("distributor.report")})}),$rootScope.groupsList=[],$scope.initRootScope=function(){return new Promise((resolve,reject)=>{$rootScope.companies||($rootScope.companies=[],$rootScope.companiesMap={},FleetService.getCompaniesByDistributor($rootScope.distributor).then(function(response){for(var companies=[],i=response.data.length-1;i>=0;i--)companies.push(response.data[i]);$rootScope.companies=companies;var companiesMap={};for(i=0;i<companies.length;i++)delete companies[i].billingAdmin,companiesMap[companies[i].id]=companies[i];$rootScope.companiesMap=companiesMap,sessionStorage.setItem("companiesMap",JSON.stringify(companiesMap));var companyIds=[];for(var key in companiesMap)companyIds.push(key);FleetService.getCompaniesGroup(companyIds).then(function(response){for(var groupsMap={},i=0;i<response.data.length;i++)if(response.data[i])for(var groupsWithPath=assembleGroupTree(response.data[i]),j=0;j<groupsWithPath.length;j++)groupsMap[groupsWithPath[j].id]=groupsWithPath[j];return $rootScope.groupsMap=groupsMap,sessionStorage.setItem("groupsMap",JSON.stringify(groupsMap)),resolve()}).catch(err=>reject(err))}).catch(ex=>reject(ex)))})}}),angular.module("edriving").controller("DistributorMainCtrl",function($scope,$rootScope,$state,$timeout,$window,$http,$auth,toastr,Account,FleetService,$cookieStore,$log){$auth.isAuthenticated()||$state.go("logout",{loginUrl:"/login_distributor"}),$apiBaseUrl=$apiBaseDomain+"/mentor-distributor/api/",$scope.reportParam={cat:null,group:null,user:null,period:"last 6 weeks"},$rootScope.groupsList||($rootScope.groupsList=[],$rootScope.users=[]),$timeout(function(){$window.dispatchEvent(new Event("resize"))},100)}),angular.module("edriving").controller("DistributorReportCtrl",function($scope,uiGridConstants,$loading,$rootScope,$http,$auth,toastr,Account,FleetService,$cookieStore,$log,$state,moment,$timeout,ClientReportSvc,$location){function isEmpty(obj){return 0===Object.keys(obj).length&&obj.constructor===Object}$scope.client="amzldistributor",$apiBaseUrl=$apiBaseDomain+"/mentor-distributor/api/",$scope.show_period=!0,$scope.selectTab=function(tab){$scope.selectedTab=tab},$scope.isTabSelected=function(tab){return $scope.selectedTab===tab},this.$onInit=function(){$scope.period=$state.params.period,$scope.show_compare=!1,$scope.checkCompare=!1,$scope.period||($scope.period="weekly"),$scope.initCompanyMap(),$scope.initGroupMap(),$scope.data=[]},$scope.readyCsv=!1,$scope.showTab=1,$scope.data=[],$scope.partViewConfig=[{2:!0},{3:!0},{5:!1},{6:!0},{8:!1},{9:!0},{10:!0},{11:!1},{12:!1},{13:!0},{14:!0},{15:!1},{16:!1},{17:!0},{18:!1},{19:!1},{20:!0},{21:!1},{22:!1},{23:!0},{24:!1},{25:!1},{27:!1},{28:!0},{29:!0},{30:!0},{31:!0},{32:!0},{33:!0}],$scope.changePeriodOption=function(evt){},$scope.loadReportTriggered=!1,$scope.initGroupMap=function(){if(!$rootScope.groupsMap||isEmpty($rootScope.groupsMap))sessionStorage.getItem("groupsMap")&&($rootScope.groupsMap=JSON.parse(sessionStorage.getItem("groupsMap"))),$timeout(function(){$scope.initGroupMap()},200);else{$scope.groupsFilter=[];for(var i=0;i<$rootScope.groupsList.length;i++)$scope.groupsFilter.push({label:$rootScope.groupsList[i].nameWithPath,value:$rootScope.groupsList[i].id});$scope.groupsMap=$rootScope.groupsMap}ClientReportSvc.set_DistributorGridOption($scope,!0),setTimeout(()=>{$scope.$apply()},500)},$scope.initCompanyMap=function(){"distributor"==$rootScope.app?!$rootScope.companiesMap||isEmpty($rootScope.companiesMap)?(sessionStorage.getItem("companiesMap")&&($rootScope.companiesMap=JSON.parse(sessionStorage.getItem("companiesMap"))),$timeout(function(){$scope.initCompanyMap()},200)):$scope.companiesMap=$rootScope.companiesMap:$rootScope.company?($scope.companiesMap={},$scope.companiesMap[$rootScope.company.id]=$rootScope.company):$timeout(function(){$scope.initCompanyMap()},200)},$scope.loadReport=function(start){$scope.data=[],$scope.start=start,start&&(start.isValid&&!start.isValid()||($scope.groupsMap&&!isEmpty($scope.groupsMap)&&$scope.companiesMap&&!isEmpty($scope.companiesMap)?(ClientReportSvc.set_DistributorGridOption($scope,!0),setTimeout(()=>{$scope.$apply()},500),$scope.initReport=!0,start=moment(start,"MM/DD/YYYY").format("YYYY-MM-DD"),"amzldistributor"==$scope.client&&($scope.show_compare=!1,"monthly"==$scope.period&&$scope.getMonthlyReport_distributor(start),"weekly"==$scope.period&&$scope.getWeeklyReport_distributor(start),"daily"==$scope.period&&$scope.getDailyReport_distributor(start))):setTimeout(()=>{$scope.loadReport(start)},500)))},$scope.getMonthlyReport_distributor=function(start){start=new Date(moment(start).startOf("month").format("MM/DD/YYYY")),$loading.start("loading_report");var end=$scope.getMothEnd(start),start_prev=moment(start).add(-1,"months").format("YYYY-MM-DD"),end_prev=$scope.getMothEnd(start_prev);$scope.fileName="Report-Monthly-"+start+"-"+end;var companyIds=[];for(var key in $scope.companiesMap)companyIds.push(key);FleetService.getCompaniesReport(companyIds,"month",start,end,!0).then(function(response){$scope.thisMonth=ClientReportSvc.prep_Distributor_Monthly_Report(response,$rootScope.groupsMap,$rootScope.companiesMap),FleetService.getCompaniesReport(companyIds,"month",start_prev,end_prev,!0).then(function(response2){$scope.lastMonth=ClientReportSvc.prep_Distributor_Monthly_Report(response2,$rootScope.groupsMap,$rootScope.companiesMap),$scope.thisMonth&&$scope.lastMonth&&($scope.thisMonth=ClientReportSvc.calculateDelta($scope.thisMonth,$scope.lastMonth)),$scope.thisMonth&&($scope.data=$scope.thisMonth),$loading.finish("loading_report")})})},$scope.getWeeklyReport_distributor=function(start){$loading.start("loading_report");var end=$scope.getWeekEnd(start),start_prev=moment(start).add(-7,"d").format("YYYY-MM-DD"),end_prev=$scope.getWeekEnd(start_prev);$scope.fileName="Report-Weekly-"+start+"-"+end;var companyIds=[];for(var key in $scope.companiesMap)companyIds.push(key);FleetService.getCompaniesReport(companyIds,"week",start,end,!0).then(function(response){$scope.thisWeek=ClientReportSvc.prep_Distributor_Weely_Report(response,$rootScope.groupsMap,$rootScope.companiesMap),FleetService.getCompaniesReport(companyIds,"week",start_prev,end_prev,!0).then(function(response2){$scope.lastWeek=ClientReportSvc.prep_Distributor_Weely_Report(response2,$rootScope.groupsMap,$rootScope.companiesMap),$scope.thisWeek&&$scope.lastWeek&&($scope.thisWeek=ClientReportSvc.calculateDelta($scope.thisWeek,$scope.lastWeek)),$scope.thisWeek&&($scope.data=$scope.thisWeek),$loading.finish("loading_report")})})},$scope.getDailyReport_distributor=function(start){$loading.start("loading_report");var end=start,start_prev=moment(start).add(-1,"d").format("YYYY-MM-DD"),end_prev=start_prev;$scope.fileName="Report-Daily-"+start+"-"+end;var companyIds=[];for(var key in $scope.companiesMap)companyIds.push(key);FleetService.getCompaniesReport(companyIds,"day",start,end,!0).then(function(response){$scope.today=ClientReportSvc.prep_Distributor_Daily_Report(response,$rootScope.groupsMap,$rootScope.companiesMap),FleetService.getCompaniesReport(companyIds,"day",start_prev,end_prev,!0).then(function(response2){$scope.yesterday=ClientReportSvc.prep_Distributor_Daily_Report(response2,$rootScope.groupsMap,$rootScope.companiesMap),$scope.today&&$scope.yesterday&&($scope.today=ClientReportSvc.calculateDelta($scope.today,$scope.yesterday)),$scope.today&&($scope.data=$scope.today),$loading.finish("loading_report")})})},$scope.getMothEnd=function(d){return moment(d).endOf("month").format("YYYY-MM-DD")},$scope.prep_groups=function(){$scope.groupsFilter=[];for(var i=0;i<$rootScope.groupsList.length;i++)$scope.groupsFilter.push({label:$rootScope.groupsList[i].nameWithPath,value:$rootScope.groupsList[i].id})},$scope.getFormattedDate=function(date){return moment(date).format("YYYY-MM-DD")},$scope.getWeekEnd=function(d){return moment(d,"YYYY-MM-DD").endOf("week").format("YYYY-MM-DD")},$scope.exportCsv=function(){$scope.readyCsv=!0},$scope.bindViewModel=function(thisWeek){return ClientReportSvc.generateReportData(thisWeek,$scope.usersMap,$scope.groupsMap,$scope.companiesMap)},$scope.initReport=!1}),angular.module("edriving").controller("CsrFeedbackMapCtrl",function($scope,Trips,$location){$scope.platform=new H.service.Platform({app_id:"OIaJsTEZuesnPok1454u",app_code:"vahwE3M-2sxQzuQKTiucKg",useHTTPS:!0}),$scope.platform.configure(H.map.render.panorama.RenderEngine),this.$onInit=(()=>{$scope.driverId=$scope.getParameter("driverId"),$scope.tripId=$scope.getParameter("tripId"),$scope.loadTripData();var defaultLayers=$scope.platform.createDefaultLayers();$scope.map=new H.Map(document.getElementById("mapContainer"),defaultLayers.normal.map,{zoom:10,center:{lat:37.4,lng:-122}}),$scope.ui=H.ui.UI.createDefault($scope.map,defaultLayers);var mapEvents=new H.mapevents.MapEvents($scope.map);new H.mapevents.Behavior(mapEvents).enable(H.mapevents.Behavior.WHEELZOOM)}),$scope.initializeRoute=(()=>{addPolylineToMap($scope.ui,$scope.map,null,$scope.locations,{lineWidth:10,strokeColor:"#336699"})}),$scope.drawTripRoute=(trip=>{var locations=[];let i=0;if(trip.route){for(i=0;i<trip.route.length;i++){var loc={lat:trip.route[i].latitude,lng:trip.route[i].longitude};locations.push(loc)}let center=Math.floor(locations.length/2);$scope.map.setCenter({lat:locations[center].lat,lng:locations[center].lng}),$scope.map.setZoom(13),$scope.locations=locations,$scope.initializeRoute();var icon_start=new H.map.Icon("../../img/marker-start.png"),marker_s=new H.map.Marker({lat:trip.route[0].latitude,lng:trip.route[0].longitude},{icon:icon_start});$scope.map.addObject(marker_s);var icon_end=new H.map.Icon("../../img/marker-end.png"),marker_e=new H.map.Marker({lat:trip.route[i-1].latitude,lng:trip.route[i-1].longitude},{icon:icon_end});$scope.map.addObject(marker_e)}}),$scope.saveEditedValue=(()=>{var val=document.getElementById("speed-limit-update").value,eventInstanceId=$("#evtInstanceId").val(),rsList=[];console.log("eventInstanceId"),console.log(eventInstanceId),console.log("eventRoadSegments"),console.log(eventRoadSegments);var roadSegmentSpeedLimits=eventRoadSegments.get(eventInstanceId);if(roadSegmentSpeedLimits){for(var roadSegmentId of roadSegmentSpeedLimits.keys()){var speedLimit=roadSegmentSpeedLimits.get(roadSegmentId).speedLimit;console.log("speedLimit"),console.log(speedLimit),speedLimit<val&&(console.log(val),rsList.push(roadSegmentId))}for(var arr=[],i=0;i<rsList.length;i++)arr.push({roadSegmentId:rsList[i],speedLimit:val,uom:$scope.units});Trips.updateSpeed($scope.tripId,arr).then(function(response){saveEditedValueResponseHandler(response),$("#closeModal").click()})}}),$scope.getParameter=(name=>{return $location.search()[name]}),$scope.initUnits=(()=>{var units=$scope.getParameter("units");UOM=!units||"METRIC"!=units&&"IMPERIAL"!=units?"IMPERIAL":units}),$scope.loadTripData=(()=>{$scope.initUnits(),$scope.callTripApi()}),$scope.callTripApi=(()=>{Trips.getDriverTrip($scope.driverId,$scope.tripId).then(res=>{console.log(res.data),$scope.collectRoadSegments(res.data),$scope.drawTripDetails(res.data),$scope.collectRoadSegments(res.data)})}),$scope.collectRoadSegments=(trip=>{if(trip.events&&trip.route){eventRoadSegments=new Map;for(let e of trip.events)if("SPEEDING"==e.eventType){let segments=new Map;for(let r of trip.route)r.timestamp>=e.startTimestamp&&r.timestamp<=e.endTimestamp&&segments.set(r.roadSegmentId,r);eventRoadSegments.set(e.eventInstanceId,segments);var arr=Array.from(segments.keys()),units=e.units;units||(units="MPH"),$scope.units=units,Trips.getSpeedLimit(arr,units).then(res=>{console.log("getSpeedLimit"),res.data&&(res.data.forEach(function(a){let seg=segments.get(a.roadSegmentId);a.speedLimit&&(console.log("seg speed limit"+a.speedLimit),seg.speedLimit=a.speedLimit,seg.speedLimit&&("IMPERIAL"==UOM?"MPH"!=units.toUpperCase()&&(seg.speedLimit=kmhToMph(seg.speedLimit)):"METRIC"==UOM&&"MPH"==units.toUpperCase()&&(seg.speedLimit=mphToKmh(seg.speedLimit)))),segments.set(seg.roadSegmentId,seg)}),eventRoadSegments.set(e.eventInstanceId,segments))})}}}),$scope.drawTripDetails=(trip=>{$scope.drawTripSummary(trip),$scope.drawTripRoute(trip),$scope.drawTripEvents(trip)}),$scope.drawTripEvents=(trip=>{if($scope.detectedEvents=[],trip.events){var counts={};for(let i in trip.events){var key=trip.events[i].eventType;DO_NOT_DISPLAY.includes(key)||(trip.events[i].eventInstanceId||(trip.events[i].eventInstanceId="seq-"+i),$scope.detectedEvents.push(trip.events[i]),counts[key]=(counts[key]||0)+1)}$scope.groupEvents()}}),$scope.groupedEvents={},$scope.allEvents=[],$scope.groupEvents=(()=>{for(let i=0;i<$scope.detectedEvents.length;i++)$scope.groupedEvents[$scope.detectedEvents[i].eventType]?($scope.groupedEvents[$scope.detectedEvents[i].eventType][0]+=1,$scope.groupedEvents[$scope.detectedEvents[i].eventType][1].push($scope.detectedEvents[i])):$scope.groupedEvents[$scope.detectedEvents[i].eventType]=[1,[$scope.detectedEvents[i]]];for(let prop in $scope.groupedEvents){let obj={name:prop,count:$scope.groupedEvents[prop][0],events:$scope.groupedEvents[prop][1]};$scope.allEvents.push(obj)}}),$scope.handleEvent=(evt=>{$scope.initializeRoute($scope.locations),evt.events.forEach(event=>{let info=createEventInfo($scope.ui,event),locations=[];for(let i=0;i<$scope.locations.length;i++)if($scope.locations[i].lat==event.startLocation.latitude&&$scope.locations[i].lng==event.startLocation.longitude)for(;i<$scope.locations.length&&(locations.push($scope.locations[i]),$scope.locations[i].lat!=event.endLocation.latitude||$scope.locations[i].lng!=event.endLocation.longitude);)i++;1==locations.length&&locations.push(locations[0]),setTimeout(function(){addPolylineToMap($scope.ui,$scope.map,info,locations,{lineWidth:10,strokeColor:"Red"})},100)})}),$scope.drawTripSummary=(trip=>{var formattedDuration=secondsToHoursMinutes((trip.endTimestamp-trip.startTimestamp)/1e3);if($scope.trip_duration=formattedDuration,$scope.trip_distance=Number(metersToMiles(trip.distance)).toFixed(2)+" miles",$scope.trip_transportation_mode=trip.transportationMode,$scope.trip_drive_mode=trip.driveMode,$scope.trip_status=trip.status,"insufficient data"===$scope.trip_status.trim().toLowerCase()&&($scope.trip_status="Short Trip"),"unsupported mode"===$scope.trip_status.trim().toLowerCase()&&($scope.trip_status="N/A"),"unknown"===$scope.trip_status.trim().toLowerCase()&&($scope.trip_status="N/A"),$scope.startTimestamp=trip.startTimestamp,$scope.timeZoneId=trip.timeZoneId,trip.scores)for(var i=0;i<trip.scores.length;i++)"TOTAL"==trip.scores[i].category&&($scope.trip_score=trip.scores[i].rating+" / "+trip.scores[i].value)})});var eventInstanceId,eventLocations=new Map,eventRoadSegments=new Map,addPolylineToMap=(ui,map,info,locs,style)=>{var lineString=new H.geo.LineString;locs.forEach(loc=>{lineString.pushPoint({lat:loc.lat,lng:loc.lng})});let polyline=new H.map.Polyline(lineString,{style:style});map.addObject(polyline),info&&addInfoBubble(ui,info,polyline,{lat:locs[0].lat,lng:locs[0].lng})},createEventInfo=(ui,tripEvent)=>{if(tripEvent){bubbles.forEach(function(e){ui.removeBubble(e)});var info="<div  class='event_info'>";if(info+="<h3 class='event_info_title'>",info+=tripEvent.eventType,info+="</h3>",info+="<dl class='event_info_content'>",tripEvent.maxSpeed&&(info+="<dt class='event_info_content_label'>",info+="max: ",info+="</dt>",info+="<dd class='event_info_content_value'>",info+=convertAndFormatSpeed(tripEvent.maxSpeed),info+="</dd>","SPEEDING"==tripEvent.eventType&&tripEvent.speedContexts&&tripEvent.speedContexts.length>0))for(var i=0;i<tripEvent.speedContexts.length;i++){var speedContext=tripEvent.speedContexts[i];info+="<dl class='event_info_content'>",speedContext.speedLimit&&(info+="<dt class='event_info_content_label'>",info+="limit: ",info+="</dt>",info+="<dd class='event_info_content_value'>",info+=convertAndFormatSpeed(speedContext.speedLimit),info+="</dd>")}return tripEvent.maxAcceleration&&(info+="<dt class='event_info_content_label'>",info+="Max: ",info+="</dt>",info+="<dd class='event_info_content_value'>",info+=formatAcceleration(tripEvent.maxAcceleration),info+="</dd>"),info+="<dt class='event_info_content_label'>",info+="Duration: ",info+="</dt>",info+="<dd class='event_info_content_value'>",info+=(tripEvent.endTimestamp-tripEvent.startTimestamp)/1e3+"sec",info+="</dd>",info+="</dl>","SPEEDING"==tripEvent.eventType&&tripEvent.speedContexts&&tripEvent.speedContexts.length>0?info+="<span id='expand_content_button'  onclick='javascript:expandControlWithSpeeding(\""+tripEvent.eventInstanceId+"\");'>--<button class='btn btn-link'>more</button>--</span>":info+="<span id='expand_content_button'  onclick='javascript:expandControl(\"extra_content\", \"expand_content_button\", \"collapse_content_button\");'>--<button class='btn btn-link'>more</button>--</span>",info+="<span id='collapse_content_button' style='display: none;' onclick='javascript:collapseControl(\"extra_content\", \"expand_content_button\", \"collapse_content_button\");'>--<button class='btn btn-link'>less</button>--</span>",info+="<dl id='extra_content' style='display: none;'>",info+="<dt class='event_info_content_label'>",info+="Start: ",info+="</dt>",info+="<dd class='event_info_content_value'>",info+=tripEvent.startLocation.latitude+","+ +tripEvent.startLocation.longitude,info+="</dd>",info+="<dt class='event_info_content_label'>",info+="End: ",info+="</dt>",info+="<dd class='event_info_content_value'>",info+=tripEvent.endLocation.latitude+","+ +tripEvent.endLocation.longitude,info+="</dd>",info+="</dl>",info+="<dl id='speed_limit_breakdown' style='display:none;'/>",info+="</div>"}},bubbles=[];function addInfoBubble(ui,content,polyline,position){polyline.setData(content),polyline.addEventListener("tap",function(evt){bubbles.forEach(function(e){ui.removeBubble(e)});var bubble=new H.ui.InfoBubble(position,{content:evt.target.getData()});bubbles.push(bubble),ui.addBubble(bubble)},!1)}function expandControlWithSpeeding(eventInstanceId){update(eventInstanceId),expandControl("extra_content","expand_content_button","collapse_content_button")}function expandControl(elementId,moreButtonId,lessButtonId){displayElement(elementId),hideElement(moreButtonId),displayElement(lessButtonId)}function collapseControl(elementId,moreButtonId,lessButtonId){hideElement(elementId),displayElement(moreButtonId),hideElement(lessButtonId)}function displayElement(elementId){changeElementDisplay(elementId,"block")}function hideElement(elementId){changeElementDisplay(elementId,"none")}function changeElementDisplay(elementId,display){var element=document.getElementById(elementId);element&&(element.style.display=display)}function update(eventInstanceId){eventRoadSegments.has(eventInstanceId)&&drawSpeedLimitUpdateTable(eventInstanceId)}function googleSpeedLimitHandler(speedLimitsResponse,eventInstanceId){collectRoadSegmentsData(eventInstanceId,speedLimitsResponse)}function drawSpeedLimitUpdateTable(eventInstanceId){var roadSegmentSpeedLimits=eventRoadSegments.get(eventInstanceId);if(roadSegmentSpeedLimits){var counts=new Map;for(var roadSegmentId of roadSegmentSpeedLimits.keys()){var key="key-"+roadSegmentSpeedLimits.get(roadSegmentId).speedLimit;counts.set(key,(counts.get(key)||0)+1)}var htmlStr="";for(var key of counts.keys()){var speedLimit=key.split("-")[1];htmlStr+="<h3 class='event_info_title'>",htmlStr+="Found "+counts.get(key)+" road segments </h3>",htmlStr+="<dl></dl><dt class='event_info_content_label'>",htmlStr+="Posted speed:",htmlStr+="</dt>",htmlStr+="<dd class='event_info_content_value'>",htmlStr+=formatSpeed(speedLimit),htmlStr+="</dd></dl>"}htmlStr+=`\n    <form class="form-inline" id ='update_panel'>\n    <h3>Update to</h3>\n    <div class="form-group">\n      <label for="update_panel" class="sr-only">Speed</label>\n      <input type="number" class="" id= 'speed-limit-update' style='width:150px; color:black'>\n      <label for="update_panel" class="sr-only">${getSpeedUom()}</label>\n    </div>\n    <button type="button" onclick='confirmEditedValue("${eventInstanceId}")' data-toggle="modal" data-target="#exampleModalCenter" class="btn btn-primary mb-2">Save</button>\n  </form>\n    `;var dDiv=document.getElementById("speed_limit_breakdown");dDiv.innerHTML=htmlStr,dDiv.style.display="block",setEnterClick("speed-limit-update","update_button")}}function confirmEditedValue(eventInstanceId){$("#evtInstanceId").val(eventInstanceId);var units=getSpeedUom(),continueUpdate="Are you sure you want to update speed limit to "+document.getElementById("speed-limit-update").value+units+"?";$("#txtConfirm").text(continueUpdate)}function setEnterClick(panel,button){document.getElementById(panel).addEventListener("keyup",function(event){event.preventDefault(),13===event.keyCode&&document.getElementById(button).click()})}function triggerSaveEditedValue(){$("#saveButton").click()}function saveEditedValueResponseHandler(resp,eventInstanceId){osmSpeedLimitHandler(resp,eventInstanceId),alert("Saved!")}function osmSpeedLimitHandler(osmSpeedLimitsResponse,eventInstanceId){if(osmSpeedLimitsResponse){for(var roadSegmentSpeedLimits=eventRoadSegments.get(eventInstanceId),i=0;i<osmSpeedLimitsResponse.length;i++){var roadSegmentId=osmSpeedLimitsResponse[i].roadSegmentId,speedLimit=osmSpeedLimitsResponse[i].speedLimit,units=osmSpeedLimitsResponse[i].units;speedLimit&&("IMPERIAL"==UOM?"MPH"!=units.toUpperCase()&&(speedLimit=kmhToMph(speedLimit)):"METRIC"==UOM&&"MPH"==units.toUpperCase()&&(speedLimit=mphToKmh(speedLimit))),speedLimit=Math.max(roadSegmentSpeedLimits.get(roadSegmentId).speedLimit,speedLimit);let sg=roadSegmentSpeedLimits.get(roadSegmentId);sg.speedLimit=speedLimit,roadSegmentSpeedLimits.set(roadSegmentId,sg)}drawSpeedLimitUpdateTable(eventInstanceId)}else drawSpeedLimitUpdateTable(eventInstanceId)}function secondsToHoursMinutes(d){d=Number(d);var h=Math.floor(d/3600),m=Math.floor(d%3600/60),s=Math.floor(d%3600%60);return(h>0?h+" h ":"")+(m>0?m+" min ":"")+(s>0?s+" sec ":"")}const MILES_TO_METERS=1609.34,METERS_TO_MILES=1/1609.34,KILOMETERS_TO_METERS=1e3,METERS_TO_KILOMETERS=.001,HOUR_TO_SECONDS=3600,SECONDS_TO_HOUR=1/3600,MS_TO_MPH=2.2369418519393047,MS_TO_KMH=3.6,KILOMETERS_TO_MILES=1/1609.34*1e3,MILES_TO_KILOMETERS=1/(1/1609.34*1e3),G_TO_MSS=9.80665,MSS_TO_G=1/9.80665;var UOM,convertAndFormatSpeed=speed=>0=="IMPERIAL".localeCompare(UOM)?Number(msToMph(speed)).toFixed(2)+"mph":Number(msToKmh(speed)).toFixed(2)+"km/h",formatAcceleration=acc=>0=="IMPERIAL".localeCompare(UOM)?Number(mssToG(acc)).toFixed(2)+"g":Number(acc).toFixed(2)+"m/s^2",formatSpeed=speed=>0=="IMPERIAL".localeCompare(UOM)?Number(speed).toFixed(2)+"mph":Number(speed).toFixed(2)+"km/h",getSpeedUom=()=>0=="IMPERIAL".localeCompare(UOM)?"mph":"km/h",metersToMiles=meters=>meters*(1/1609.34),msToMph=speedMs=>speedMs*MS_TO_MPH,msToKmh=speedMs=>3.6*speedMs,kmhToMph=speedKmh=>speedKmh*(1/1609.34*1e3),mphToKmh=speedMph=>speedMph*(1/(1/1609.34*1e3)),mssToG=accMss=>accMss*MSS_TO_G;const DO_NOT_DISPLAY=["START","STOP","LEFT_TURN","RIGHT_TURN","SPEEDING_ABOVE_POSTED_SPEED","SPEEDING_0_10","SPEEDING_10_15","SPEEDING_15_20","SPEEDING_20_PLUS","IDLING","TIRE_PRESSURE_LOW"];angular.module("edriving").factory("StoreSvc",function($http){return{getStoreTrans:function(start,end,productId,lang){return $http.get($apiBaseUrl+"v1/fleetstore/orders?start="+start+"&end="+end+"&productId="+productId+"&lang="+lang)},getStoreProducts:function(){return $http.get($apiBaseUrl+"v1/fleetstore/products")}}}),angular.module("edriving").factory("Account",function($http){return{getProfile:function(){return $http.get($apiBaseUrl+"v1/me")},updateProfile:function(userId,profileData){return $http.patch($apiBaseUrl+"v1//users/"+userId,profileData)},resetPassword:function(email){return $http.get($apiBaseUrl+"v1/resetPassword?email="+window.encodeURIComponent(email))},updatePassword:function(password,token){return $http.post($apiBaseUrl+"v1/updatePassword",{password:password,token:token})}}}),window.addEventListener("load",()=>{window["moment-range"].extendMoment(moment)});const VALUE_COLORS={RISKY:"rgb(225, 87, 89)",POOR:"rgb(242, 142, 43)",AVERAGE:"rgb(237, 201, 72)",GOOD:"rgb(140, 209, 125)",GREAT:"rgb(89, 161, 79)"},VALUE_LABELS={RISKY:"Risky",POOR:"Poor",AVERAGE:"Average",GOOD:"Good",GREAT:"Great"},MONTHS_LABEL=["GEN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SET","OCT","NOV","DEC"],SEATBELTS_LABEL={ZERO:"ZERO",ZERO_OR_ONE:"ZERO_OR_ONE",WITHIN_FOUR:"WITHIN_FOUR",MORE_THAN_FOUR:"MORE_THAN_FOUR"},CHARTS_CONFIGURATION={scoreDistrib:{filterData:"__filterData_dsp",groupSetsBy:"__groupsSetsBy_value",map:"__mapData__scoreDistrib"},scoreDistribBySingleDsp:{filterData:"__filterData_dsp",groupSetsBy:"__groupsSetsBy_value",map:"__mapData__scoreDistribBySingleDsp"},scoreDistribOverTimeByDsp:{filterData:"__filterData_dsp",groupSetsBy:"__groupsSetsBy_month",map:"__mapData__scoreDistribOverTimeByDsp"},scoreDistribBySeatbelts:{filterData:"__filterData_dsp",groupSetsBy:"__groupsSetsBy_seatbelts",map:"__mapData__scoreDistribBySeatbelts"}};let getColorByHash;angular.module("edriving").factory("FicoScoreRating",($auth,FleetService,$stateParams)=>({async getUsers(){const{data:users}=await FleetService.getUsers(window.sessionStorage.companyId,!1,!0);return users},async getCompanies(){let companies;if("distributor"===$stateParams.client)({data:companies}=await FleetService.getCompaniesByDistributor($auth.getPayload().distributor));else{const{data:data}=await FleetService.getCompany(window.sessionStorage.companyId);companies=[data]}return companies},async getStations(companies){const companiesIdString=companies.map(company=>company.id).join(",");let stations;if("distributor"===$stateParams.client){const{data:data}=await FleetService.getCompaniesGroup(companiesIdString);stations=data.reduce((array,station)=>[...array,...station])}else({data:stations}=await FleetService.getGroups(companiesIdString));return stations},async getCompaniesReport(companies,dateStart,dateEnd){const companiesIdString=companies.map(company=>company.id).join(",");let records;return"distributor"===$stateParams.client?({data:records}=await FleetService.getCompaniesReport(companiesIdString,"month",dateStart,dateEnd)):({data:records}=await FleetService.getDriversReport(companiesIdString,"month",dateStart,dateEnd)),records},async __aggregateCompaniesData(selectedInterval,selectedCompanies=null){selectedInterval||(selectedInterval={startDate:moment().set("date",1).subtract(1,"months"),endDate:moment().set("date",moment().endOf("month").format("DD")).subtract(1,"months")});const dateStart=selectedInterval.startDate.format("YYYY-MM-DD"),dateEnd=selectedInterval.endDate.format("YYYY-MM-DD"),companies=await this.getCompanies();let users;"fleet_amzl"===$stateParams.client&&(users=await this.getUsers()),selectedCompanies||(selectedCompanies=companies);const[stations,records]=await Promise.all([this.getStations(selectedCompanies),this.getCompaniesReport(selectedCompanies,dateStart,dateEnd)]),groupsMap={};for(const station of stations){const stationId=station.id.toString();groupsMap.hasOwnProperty(stationId)||(groupsMap[stationId]={name:station.name,companyId:station.companyId.toString()})}const items=[];for(const record of records){if(!record.monthlyStats||!record.monthlyStats.length)continue;let dsp,station,stationName,companyId,driver;const{recordKey:recordKey}=record;if("GROUP"===record.recordType){if(station=recordKey,!groupsMap.hasOwnProperty(station))continue;const group=groupsMap[station];companyId=group.companyId,stationName=group.name}else if("COMPANY"===record.recordType)companyId=recordKey;else if("DRIVER"===record.recordType){companyId=selectedCompanies.length&&selectedCompanies[0].id.toString();const driverUserId=record.recordKey;if(driver=users.find(({user:user})=>user&&user.UserId.toString()===driverUserId)){driver.id=driver.id.toString();const stationId=driver.driverGroupId&&driver.driverGroupId.toString();if(groupsMap.hasOwnProperty(stationId)){const group=groupsMap[stationId];station=stationId,stationName=group.name}}}const dspObj=companies.find(company=>company.id.toString()===companyId);if(dspObj){dsp={id:dspObj.id.toString(),name:dspObj.name};for(const monthStats of record.monthlyStats){if(!monthStats.scores)continue;const scoreRecord=monthStats.scores.find(score=>"TOTAL"===score.scoreCategory&&score.score&&score.rating);if(!scoreRecord)continue;const value=scoreRecord&&scoreRecord.rating;let seatbeltEvents;if(monthStats.events){const event=monthStats.events.find(event=>"SEAT_BELT_OFF"===event.eventType);event&&(seatbeltEvents=event.count)}items.push({dsp:dsp,driver:driver,station:station,stationName:stationName,value:value,startDate:moment(monthStats.fromDate),endDate:moment(monthStats.toDate),seatbeltEvents:seatbeltEvents})}}}return items},__filterData_dsp(data,filters,groupSetsByMethod){const filterInterval=filters.interval,filterDsp=filters.dsp||[],filterDrivers=filters.driver||[],filterStations=filters.station||[],filterValues=filters.value||[];let filteredData=angular.copy(data);if(filterInterval){const filterIntervalRange=moment.range(filterInterval.startDate,filterInterval.endDate);filteredData=filteredData.filter(dataItem=>{const range=moment.range(dataItem.startDate,dataItem.endDate);return filterIntervalRange.overlaps(range)})}const labels=[];(filteredData=filteredData.filter(dataItem=>!filterDsp.length||filterDsp.some(dsp=>dsp===dataItem.dsp.id)).filter(dataItem=>!filterDrivers.length||filterDrivers.some(driver=>driver===dataItem.driver.id)).filter(dataItem=>!filterStations.length||filterStations.some(station=>!dataItem.station||station===dataItem.station)).filter(dataItem=>!filterValues.length||filterValues.some(value=>value===dataItem.value))).length&&filteredData.reduce((obj,item)=>(obj[item.dsp.id]||(labels.push(item.dsp.name),obj[item.dsp.id]=!0),obj),{});const datasets=this[groupSetsByMethod](labels,filteredData);return{labels:labels,datasets:datasets}},__groupsSetsBy_value(labels,filteredData){const datasetsLabels=Object.values(VALUE_LABELS),datasets=datasetsLabels.reduce((obj,label)=>({...obj,[label]:[]}),{});for(const label of labels){const dataItems=filteredData.filter(item=>item.dsp.name===label);if(dataItems.length)for(const datasetLabel of datasetsLabels){const datasetLabelUpper=datasetLabel.toUpperCase();datasets[datasetLabel].push((100/dataItems.length*dataItems.filter(dataItem=>dataItem.value===datasetLabelUpper).length).toFixed(2))}}return datasets},__groupsSetsBy_month(labels,filteredData){const datasetsLabels=MONTHS_LABEL,datasets=[];for(const label of labels){const dataItems=filteredData.filter(driver=>driver.dsp.name===label);if(!dataItems.length)continue;const dataset={label:label,data:[],backgroundColor:getColorByHash(label,"300").backgroundColor};datasets.push(dataset);for(const datasetLabel of datasetsLabels)dataset.data.push((100/dataItems.length*dataItems.filter(dataItem=>dataItem.startDate.format("MMMM").slice(0,3).toUpperCase()===datasetLabel).length).toFixed(2))}return datasets},__groupsSetsBy_seatbelts(labels,filteredData){const datasets=Object.values(SEATBELTS_LABEL).reduce((obj,label)=>({...obj,[label]:[]}),{}),groupedItemsByDsp={};for(const label of labels){const dataItems=filteredData.filter(item=>item.dsp.name===label);for(const item of dataItems)groupedItemsByDsp.hasOwnProperty(item.dsp.name)?item.seatbeltEvents&&(groupedItemsByDsp[item.dsp.name]+=item.seatbeltEvents):groupedItemsByDsp[item.dsp.name]=0}for(const label of labels){const groupedItem=groupedItemsByDsp[label],groupedItemZero=groupedItem<2?groupedItem:0,groupedItemZeroOrOne=0===groupedItem?groupedItem:0,groupedItemWithinFour=groupedItem>0&&groupedItem<5?groupedItem:0,groupedItemMoreThanFour=groupedItem>4?groupedItem:0;datasets[SEATBELTS_LABEL.ZERO].push(groupedItemZero),datasets[SEATBELTS_LABEL.ZERO_OR_ONE].push(groupedItemZeroOrOne),datasets[SEATBELTS_LABEL.WITHIN_FOUR].push(groupedItemWithinFour),datasets[SEATBELTS_LABEL.MORE_THAN_FOUR].push(groupedItemMoreThanFour)}return datasets},__mapData__scoreDistrib:(labels,datasets)=>({labels:labels,datasets:[{label:VALUE_LABELS.RISKY,data:datasets.Risky,backgroundColor:VALUE_COLORS.RISKY},{label:VALUE_LABELS.POOR,data:datasets.Poor,backgroundColor:VALUE_COLORS.POOR},{label:VALUE_LABELS.AVERAGE,data:datasets.Average,backgroundColor:VALUE_COLORS.AVERAGE},{label:VALUE_LABELS.GOOD,data:datasets.Good,backgroundColor:VALUE_COLORS.GOOD},{label:VALUE_LABELS.GREAT,data:datasets.Great,backgroundColor:VALUE_COLORS.GREAT}]}),__mapData__scoreDistribBySingleDsp:(labels,datasets)=>({labels:Object.values(VALUE_LABELS),datasets:[{data:[...datasets.Risky,...datasets.Poor,...datasets.Average,...datasets.Good,...datasets.Great],backgroundColor:[VALUE_COLORS.RISKY,VALUE_COLORS.POOR,VALUE_COLORS.AVERAGE,VALUE_COLORS.GOOD,VALUE_COLORS.GREAT]}]}),__mapData__scoreDistribOverTimeByDsp:(labels,datasets)=>({labels:MONTHS_LABEL,datasets:datasets}),__mapData__scoreDistribBySeatbelts:(labels,datasets)=>({labels:labels,datasets:[{label:"0 instances",data:datasets[SEATBELTS_LABEL.ZERO],backgroundColor:VALUE_COLORS.GREAT},{label:"0-1 instances",data:datasets[SEATBELTS_LABEL.ZERO_OR_ONE],backgroundColor:VALUE_COLORS.GOOD},{label:"1-4 instances",data:datasets[SEATBELTS_LABEL.WITHIN_FOUR],backgroundColor:VALUE_COLORS.AVERAGE},{label:">5 instances",data:datasets[SEATBELTS_LABEL.MORE_THAN_FOUR],backgroundColor:VALUE_COLORS.POOR}]}),async getChartDataByFilters(chartId,selectedFilters){const chartConfig=CHARTS_CONFIGURATION[chartId],{filterData:filterDataMethod,groupSetsBy:groupSetsByMethod,map:mapDataMethod}=chartConfig,companies=selectedFilters.dsp&&selectedFilters.dsp.map(company=>({id:company})),data=await this.__aggregateCompaniesData(selectedFilters.interval,companies),{labels:labels,datasets:datasets}=this[filterDataMethod](data,selectedFilters,groupSetsByMethod);return this[mapDataMethod](labels,datasets)},async getDetailsItems(dsp,value,interval){const data=await this.__aggregateCompaniesData(interval,[{id:dsp}]),valueUpper=value.toUpperCase();return data.filter(item=>item.dsp.id===dsp&&item.value===valueUpper).map(item=>({...item,dsp:item.dsp.name,driverId:item.driver&&item.driver.user.UserId,driverName:item.driver&&`${item.driver.user.FirstName} ${item.driver.user.LastName||""}`,station:item.stationName,interval:`${item.startDate.format("DD MMMM YYYY")} - ${item.endDate.format("DD MMMM YYYY")}`}))}})),angular.module("edriving").factory("userDriving",function($http){return{getDrivingDetail:function(userId){return $http.get($apiBaseUrl+"drivers/"+userId+"/summary")},getDriverHistoryDaily:function(userId,startDate){return $http.get($apiBaseUrl+"drivers/"+userId+"/driverIndexHistory/daily?startTime="+startDate+"&endTime="+startDate)},getDriverHistoryWeekly:function(userId,startDate,endDate){return $http.get($apiBaseUrl+"drivers/"+userId+"/driverIndexHistory/weekly?startTime="+startDate+"&endTime="+endDate)}}}),angular.module("edriving").factory("Trips",function($http){return{getTrips:function(userId){return $http.get($apiBaseUrl+"drivers/"+userId+"/trips")},getTripDetails:function(userId,tripId){let url=$apiBaseUrl+"trips/"+tripId;return console.log("url: "+url),$http.get(url)},getDriverTrip:function(driverId,tripId){let url=$apiBaseDomain+"/mentor-csr/api/v2"+"/drivers/"+driverId+"/trips/"+tripId+"?facet=all";return console.log("url: "+url),console.log("tripId: "+tripId),$http.get(url)},getSpeedLimit:function(arr,unit){var delimiterSeparated=arr.join(",");var url=$apiBaseDomain+"/mentor-csr/api/v2/roads/speed_limits"+"/"+delimiterSeparated+"?unit="+unit;return $http.get(url)},updateSpeed:function(tripId,arr){const SPEED_BASE_URL=$apiBaseDomain+"/mentor-csr/api/v2/roads/speed_limits?tripId="+tripId;return $http.post(SPEED_BASE_URL,arr)}}}),angular.module("edriving").factory("FeedBack",function($http){return{postFeedback:function(report){return $http.post($apiBaseUrl+"feedbacks",report)}}}),angular.module("edriving").factory("CourseService",function($http){return{getCourses:function(userId,forceRefresh){return $http.get($apiBaseUrl+"v1/users/"+userId+"/modules",{cache:!forceRefresh})},getCoursesSummary:function(userId,forceRefresh){return $http.get($apiBaseUrl+"v1/users/"+userId+"/modulesSummary",{cache:!forceRefresh})},getCourses2:function(userId,forceRefresh){return $http.get($apiBaseUrl+"v2/users/"+userId+"/modules",{cache:!forceRefresh})},getCoursesSummary2:function(userId,forceRefresh){return $http.get($apiBaseUrl+"v2/users/"+userId+"/modulesSummary",{cache:!forceRefresh})},getCoursesDiff:function(userId,forceRefresh){return $http.get($apiBaseUrl+"v2/users/"+userId+"/modules?includeV1=true",{cache:!forceRefresh})},getOms:function(userId,forceRefresh){return $http.get($apiBaseUrl+"v1/users/"+userId+"/oms",{cache:!forceRefresh})},getOmsProgress:function(userId,forceRefresh){return $http.get($apiBaseUrl+"v1/users/"+userId+"/oms/progress?detail=true",{cache:!forceRefresh})}}}),angular.module("edriving").factory("InvitationService",function($http){return{getInvitations:function(userId,forceRefresh){return $http.get($apiBaseUrl+"users/"+userId+"/invitations")},createInvitation:function(userId,email){return $http.post($apiBaseUrl+"users/"+userId+"/invitations?email="+email)},resendInvitation:function(userId,email){return $http.get($apiBaseUrl+"users/"+userId+"/invitations/resend?email="+email)}}}),angular.module("edriving").factory("CircleService",function($http){return{getCircles:function(){return $http.get($apiBaseUrl+"circles")},getCircle:function(circleId){return $http.get($apiBaseUrl+"circles/"+circleId)},deleteCircle:function(circleId){return $http.delete($apiBaseUrl+"circles/"+circleId)},deleteCircleUser:function(circleId,userId){return $http.delete($apiBaseUrl+"circles/"+circleId+"/users/"+userId)},updateCircleUser:function(circleId,userId,setting){return $http.put($apiBaseUrl+"circles/"+circleId+"/users/"+userId+"?setting="+setting)},getCircleUserSummary:function(circleId,userId){return $http.get($apiBaseUrl+"circles/"+circleId+"/users/"+userId+"/summary")},getCircleUserTrend:function(circleId,userId,period){return $http.get($apiBaseUrl+"circles/"+circleId+"/users/"+userId+"/trend/"+period)},getCircleUserTrips:function(circleId,userId){return $http.get($apiBaseUrl+"circles/"+circleId+"/users/"+userId+"/summary")},createCircle:function(name){return $http.post($apiBaseUrl+"circles?name="+name)},updateCircleName:function(circleId,name){return $http.put($apiBaseUrl+"circles/"+circleId+"?name="+name)},joinCircleWithCode:function(code){return $http.get($apiBaseUrl+"joinCircle?code="+code)}}}),angular.module("edriving").factory("httpRequestInterceptor",function(jwtHelper){return{request:function(config){return config.headers.client_info="web,consumer_portal",config.headers.ed_app="mentor_web",config},response:function(response){return 401==response.status&&$rootScope.logout(),response||$q.when(response)}}}),angular.module("edriving").factory("Session",function($window){var localStorage=$window.localStorage;return{getItem:function(key){return angular.fromJson(localStorage.getItem(key))},setItem:function(key,value){return localStorage.setItem(key,angular.toJson(value))},removeItem:function(key){return localStorage.removeItem(key)}}}),angular.module("edriving").factory("FleetService",function($http){return{getUsers:function(companyId,excludeUser,excludeUserProducts,forceRefresh){var excludesParam=[];return excludeUser&&excludesParam.push("cdbUser"),(excludeUserProducts||233==companyId)&&excludesParam.push("cdbUserProduct"),$http.get($apiBaseUrl+"v1/companies/"+companyId+"/users",{params:{excludes:excludesParam.join(",")},cache:!forceRefresh})},getGroups:function(companyId,forceRefresh){return $http.get($apiBaseUrl+"v1/companies/"+companyId+"/groups",{cache:!forceRefresh})},getCompany:function(companyId,forceRefresh){return $http.get($apiBaseUrl+"v1/companies/"+companyId,{cache:!forceRefresh})},getCompanyMentorProfile:function(companyId,forceRefresh){return $http.get($apiBaseUrl+"v1/companies/"+companyId+"/appProfile",{cache:!forceRefresh})},getCompaniesMentorProfile:function(companyIds,forceRefresh){return $http.get($apiBaseUrl+"v1/appProfiles?companyId="+companyIds,{cache:!forceRefresh})},patchCompanyMentorProfile:function(companyId,appProfile){return $http.patch($apiBaseUrl+"v1/companies/"+companyId+"/appProfile",appProfile)},getUserMentorProfile:function(userId,forceRefresh){return $http.get($apiBaseUrl+"v1/users/"+userId+"/appProfile",{cache:!forceRefresh})},getCompanyUserPackages:function(companyId,forceRefresh){return $http.get($apiBaseUrl+"v1/companies/"+companyId+"/fleetDriverPackages",{cache:!forceRefresh})},getPackagesDefinition:function(companyId,forceRefresh){return $http.get($apiBaseUrl+"v1/fleetDriverPackagesDefinition",{cache:!forceRefresh})},createCompanyUserPackages:function(companyId,packageCode,quantity){return $http.post($apiBaseUrl+"v1/companies/"+companyId+"/fleetDriverPackages",{packageCode:packageCode,quantity:quantity})},getUserTrends:function(companyId,userIds,start,end,forceRefresh){return $http.get($apiBaseUrl+"v1/companies/"+companyId+"/usersTrendReportData",{params:{userIds:userIds,start:start,end:end},cache:!forceRefresh})},getUserReport:function(companyId,userId,start,end,interval,forceRefresh){return $http.get($apiBaseUrl+"v1/drivers/"+userId+"/report",{params:{start:start,end:end,interval:interval},cache:!forceRefresh})},getUsersReport:function(companyId,userIds,start,end,forceRefresh){return $http.get($apiBaseUrl+"v1/companies/"+companyId+"/usersReport",{params:{userIds:userIds,start:start,end:end}},{cache:!forceRefresh})},getGroupsReport:function(companyId,start,end,interval,forceRefresh){return $http.get($apiBaseUrl+"v1/companies/"+companyId+"/report",{params:{start:start,end:end,interval:interval}},{cache:!forceRefresh})},getUserReportData:function(companyId,forceRefresh){return $http.get($apiBaseUrl+"v1/companies/"+companyId+"/usersReportData",{cache:!forceRefresh})},getDriversLatestReport:function(companyId,forceRefresh){return $http.get($apiBaseUrl+"v1/companies/"+companyId+"/driversLatestReport",{cache:!forceRefresh})},getDvcrReport:function(id,userIds,start,end,forceRefresh,type){return id||type?"group"==type?$http.get($apiBaseUrl+"v1/dvirSummaries/station/"+id,{params:{startTime:start,endTime:end,fetchReportDetail:"TRUE"}},{cache:!forceRefresh}):$http.get($apiBaseUrl+"v1/dvirSummaries/company/"+id,{params:{startTime:start,endTime:end,fetchReportDetail:"TRUE"}},{cache:!forceRefresh}):$http.post($apiBaseUrl+"v1/getDvirSummaries?startTime="+start+"&endTime="+end+"&fetchReportDetail=TRUE",{userIds:userIds})},getDvcrAttachment:function(dvirId,forceRefresh){return $http.get($apiBaseUrl+"v1/dvir/"+dvirId+"/zip")},getDvcrStatus:function(companyId,start,end,forceRefresh){return $http.get($apiBaseUrl+"v1/dvirStat",{params:{companyId:companyId,startTime:start,endTime:end}},{cache:!forceRefresh})},getDriversReport:function(companyId,interval,start,end,forceRefresh){return $http.get($apiBaseUrl+"v1/companies/"+companyId+"/driversHistoryReport",{params:{interval:interval,start:start,end:end},cache:!forceRefresh})},loginCognito:function(code){return $http.post($apiBaseUrl+"v1/amzl/cognitoAuth",{code:code})},getCompaniesReport:function(companyIds,interval,start,end,forceRefresh){return $http.get($apiBaseUrl+"v1/companies/"+companyIds+"/report",{params:{interval:interval,start:start,end:end},cache:!forceRefresh})},getCompaniesByDistributor:function(distributor){return $http.get($apiBaseUrl+"v1/companies",{params:{distributor:distributor},cache:!0})},getCompaniesGroup:function(companyIds){return $http.get($apiBaseUrl+"v1/companies_batch/"+companyIds+"/groups",{cache:!0})},getDriversFirstLogin:function(companyId,forceRefresh){return $http.get($apiBaseUrl+"v1/companies/"+companyId+"/driversFirstLogin",{cache:!forceRefresh})},getLoginStatByCompanyId:function(companyId,forceRefresh){return $http.get($apiBaseUrl+"v1/loginStat/company/"+companyId,{cache:!forceRefresh})},getLoginStatByUserIds:function(userIds){return $http.post($apiBaseUrl+"v1/loginStat/users",userIds)},getDriverEventDef:function(){return $http.get("http://localhost:9021/driverindex/api/v1/driverindex/event_def",{cache:!0})},getUserDriverIndex:function(companyId,userIds,start,end,forceRefresh){return $http.get("http://localhost:9021/driverindex/api/v1/users/1054803/driverindex",{cache:!forceRefresh})},getUserDriverIndexTrends:function(companyId,userIds,start,end,forceRefresh){return $http.get("http://localhost:9021/driverindex/api/v1/users/1054803/driverindex/history",{cache:!forceRefresh})},getUserActivities:function(userId){return $http.get($apiBaseUrl+"v1/users/"+userId+"/activities_test")},getUserTrips:function(userId,offset,limit){var params={offset:offset||0,limit:limit||30};return $http.get($apiBaseUrl+"v2/drivers/"+userId+"/trips",{params:params})},getUserScores:function(userId,startDate,endDate){var params;return params=startDate||endDate?{startDate:startDate,endDate:endDate}:{offset:0,limit:30},$http.get($apiBaseUrl+"v2/drivers/"+userId+"/scores",{params:params})},getUserSummary:function(userId){return $http.get($apiBaseUrl+"v2/drivers/"+userId+"/stats")},getGroupReportData:function(companyId,forceRefresh){return $http.get($apiBaseUrl+"v1/companies/"+companyId+"/groupsReportData_test",{cache:!forceRefresh})},addGroup:function(companyId,newGroup){return $http.post($apiBaseUrl+"v1/companies/"+companyId+"/groups",newGroup)},updateGroup:function(companyId,groupId,group){return $http.patch($apiBaseUrl+"v1/companies/"+companyId+"/groups/"+groupId,group)},deleteGroup:function(companyId,groupId){return $http.delete($apiBaseUrl+"v1/companies/"+companyId+"/groups/"+groupId)},getCompanies:function(company,forceRefresh){return $http.get($apiBaseUrl+"v1/companies",{cache:!forceRefresh})},createCompany:function(company){return $http.post($apiBaseUrl+"v1/companies",company)},updateCompany:function(company,id){return $http.patch($apiBaseUrl+"v1/companies/"+id,company)},createUser:function(companyId,userDetails){return $http.post($apiBaseUrl+"v1/companies/"+companyId+"/users",userDetails)},updateCompanyUser:function(companyId,userId,companyUserUpdates,forceRefresh){return $http.patch($apiBaseUrl+"v1/companies/"+companyId+"/users/"+userId,companyUserUpdates,{cache:!forceRefresh})},updateUserInfo:function(userId,data){return $http.put($apiBaseUrl+"v1/Users/"+userId,data)},updateUserProfile:function(userId,appProfile){return $http.patch($apiBaseUrl+"v1/users/"+userId+"/appProfile",appProfile)},updateCompanyProfile:function(companyId,companyUserUpdates,forceRefresh){return $http.patch($apiBaseUrl+"v1/companies/"+companyId+"/appProfile",companyUserUpdates,{cache:!forceRefresh})},patchCompanyMentorProfile:function(companyId,appProfile){return $http.patch($apiBaseUrl+"v1/companies/"+companyId+"/appProfile",appProfile)},deleteUser:function(companyId,companyUserId,userId){return $http.delete($apiBaseUrl+"v1/companies/"+companyId+"/users/"+companyUserId,{params:{userId:userId}})},getActivation:function(token,forceRefresh){return $http.get($apiBaseUrl+"v1/activation",{params:{token:token}},{cache:!forceRefresh})},activateUser:function(password,token){return $http.post($apiBaseUrl+"v1/activate",{password:password,token:token})},isAudit:function(company,companyProfile){return!0},getUserProductByProfile:function(billing,applicationCode,language,countryCode){var userProducts;return"Mentor_AMZL"==applicationCode?userProducts=[{ProductCode:"MENTOR_AMZL"},{ProductCode:"VRM-OMS-US-EN-0001"}]:"Mentor_Audit"==applicationCode?userProducts=[{ProductCode:"MENTOR_AMZL"}]:"Mentor_Business"==applicationCode?userProducts="NORMAL"==billing?[{ProductCode:"MENTOR_BUSINESS"}]:[{ProductCode:"MENTOR_BUSINESS_INTERNAL"}]:"Mentor_Consumer"==applicationCode?userProducts="NORMAL"==billing?[{ProductCode:"MENTOR_CONSUMER"}]:[{ProductCode:"MENTOR_CONSUMER_INTERNAL"}]:"OMS_Web"==applicationCode?"en"==language&&"GB"==countryCode?userProducts=[{ProductCode:"VRM-OMS-UK-EN-0001"}]:"en"==language&&"US"==countryCode?userProducts=[{ProductCode:"VRM-OMS-US-EN-0001"}]:"es"==language&&"ES"==countryCode?userProducts=[{ProductCode:"VRM-OMS-es-150-0001"}]:"it"==language&&"IT"==countryCode?userProducts=[{ProductCode:"VRM-OMS-it-150-0001"}]:"es"==language&&"419"==countryCode?userProducts=[{ProductCode:"VRM-OMS-es-419-0001"}]:"pt"==language&&"BR"==countryCode?userProducts=[{ProductCode:"VRM-OMS-pt-BR-0001"}]:"de"==language&&"DE"==countryCode?userProducts=[{ProductCode:"VRM-OMS-de-150-0001"}]:"fr"==language&&"FR"==countryCode&&(userProducts=[{ProductCode:"VRM-OMS-fr-150-0001"}]):"AMZL_DA_TRAINING"==applicationCode&&("en"==language&&"GB"==countryCode?userProducts=[{ProductCode:"VRM-OMS-Journeys-en-GB-0001"}]:"en"==language&&"US"==countryCode?userProducts=[{ProductCode:"VRM-OMS-Journeys-en-US-0001"}]:"es"==language&&"ES"==countryCode?userProducts=[{ProductCode:"VRM-OMS-Journeys-es-150-0001"}]:"it"==language&&"IT"==countryCode?userProducts=[{ProductCode:"VRM-OMS-Journeys-it-150-0001"}]:"es"==language&&"419"==countryCode?userProducts=[{ProductCode:"VRM-OMS-Journeys-es-419-0001"}]:"pt"==language&&"BR"==countryCode?userProducts=[{ProductCode:"VRM-OMS-Journeys-pt-BR-0001"}]:"de"==language&&"DE"==countryCode?userProducts=[{ProductCode:"VRM-OMS-Journeys-de-150-0001"}]:"fr"==language&&"FR"==countryCode&&(userProducts=[{ProductCode:"VRM-OMS-Journeys-fr-150-0001"}])),userProducts}}}),angular.module("edriving").factory("CsrService",function($http){return{queryUserByEmail:function(email,forceRefresh){return $http.get($apiBaseUrl+"v1/User?query_type=EMAIL&query="+window.encodeURIComponent(email),{cache:!forceRefresh})},loginCognito:function(code){return $http.post($apiBaseUrl+"v1/cognitoAuth",{code:code})},queryUserByCdbId:function(cdbId,forceRefresh){return $http.get($apiBaseUrl+"v1/Users/"+cdbId,{cache:!forceRefresh})},queryVrmUserByCdbId:function(cdbId,forceRefresh){return $http.get($apiBaseUrl+"v1/users/"+cdbId,{cache:!forceRefresh})},queryFleetProvisionCompanyUserByCdbId:function(cdbId,forceRefresh){return $http.get($apiBaseUrl+"v1/companyUsers?userId="+cdbId,{cache:!forceRefresh})},getCompany:function(companyId,forceRefresh){return $http.get($apiBaseUrl+"v1/companies/"+companyId,{cache:!forceRefresh})},getLoginSessions:function(userId,forceRefresh){return $http.get($apiBaseUrl+"v1/users/"+userId+"/loginSessions",{cache:!forceRefresh})},getUserFeedbacks:function(userId,forceRefresh){return $http.get($apiBaseUrl+"v1/users/"+userId+"/feedbacks",{cache:!forceRefresh})},getFeedbacks:function(start,end,forceRefresh){return $http.get($apiBaseUrl+"v1/feedbacks?start="+start+"&end="+end,{cache:!forceRefresh})},queryFeedbackByZendesk:function(zendeskId,forceRefresh){return $http.get($apiBaseUrl+"v1/feedbacks/zendesk/"+zendeskId,{cache:!forceRefresh})},getDvcrSummary:function(start,end,userId,forceRefresh){return $http.get($apiBaseUrl+"v1/dvirSummaries?userIds="+userId+"&startTime="+start+"&endTime="+end,{cache:!forceRefresh})},getDvcrSummaryByVin:function(start,end,vin,forceRefresh){return $http.get($apiBaseUrl+"v1/dvirSummaries?vin="+vin+"&startTime="+start+"&endTime="+end,{cache:!forceRefresh})},getCircle:function(cId,forceRefresh){return $http.get($apiBaseUrl+"v2/circles/"+cId+"/dataWithoutUserName",{cache:!forceRefresh})},getUserProfiles:function(userIds,forceRefresh){return $http.get($apiBaseUrl+"v2/userProfiles/"+userIds,{cache:!forceRefresh})},getDvcrSummaryByVin:function(start,end,vin,forceRefresh){return $http.get($apiBaseUrl+"v1/dvirSummaries?vin="+vin+"&startTime="+start+"&endTime="+end,{cache:!forceRefresh})},deleteLoginSession:function(userId,token){return $http.delete($apiBaseUrl+"v1/users/"+userId+"/loginSessions/"+token)},resendActivation:function(email){return $http.get($apiBaseUrl+"v1/sendActivation?email="+window.encodeURIComponent(email))},updateEmail:function(userId,email){return $http.post($apiBaseUrl+"UpdateEmail/"+userId,{Email:email})},moveUser:function(companyId,userId,new_companyId,new_group_id){return $http.post($apiFleetInternal+`/v1/companies/${companyId}/users/${userId}/move`,`{"companyId": ${new_companyId},"driverGroupId": ${new_group_id}}`)}}}),angular.module("edriving").factory("RulesEngineService",function($http){return{getSequence:function(name){return $http.get($apiBaseUrl+"v1/mgmt/rulesEngineSequence/"+name)},getUlmsModules:function(name){return $http.get($apiBaseUrl+"v1/mgmt/ulmsAvailableModules")}}}),angular.module("edriving").service("LocaleService",function($translate,LOCALES,$rootScope,tmhDynamicLocale){"use strict";var localesObj=LOCALES.locales,_LOCALES=Object.keys(localesObj);_LOCALES&&0!==_LOCALES.length||console.error("There are no _LOCALES provided");var _LOCALES_DISPLAY_NAMES=[];_LOCALES.forEach(function(locale){_LOCALES_DISPLAY_NAMES.push(localesObj[locale])});var currentLocale=$translate.proposedLanguage(),setLocale=function(locale){!function(locale){return-1!==_LOCALES.indexOf(locale)}(locale)?console.error('Locale name "'+locale+'" is invalid'):($html.addClass(LOADING_CLASS),currentLocale=locale,$translate.use(locale))},$html=angular.element("html"),LOADING_CLASS="app-loading";return $rootScope.$on("$translateChangeSuccess",function(event,data){document.documentElement.setAttribute("lang",data.language),console.log(data.language),tmhDynamicLocale.set(data.language.toLowerCase().replace(/_/g,"-"))}),$rootScope.$on("$localeChangeSuccess",function(){$html.removeClass(LOADING_CLASS)}),{getLocaleDisplayName:function(){return localesObj[currentLocale]},setLocaleByDisplayName:function(localeDisplayName){setLocale(_LOCALES[_LOCALES_DISPLAY_NAMES.indexOf(localeDisplayName)])},getLocalesDisplayNames:function(){return _LOCALES_DISPLAY_NAMES},setBrowserLocale:function(locale){console.log("Browser Language called in service:"+locale),console.log(localesObj),$translate.use(locale)}}}),angular.module("edriving").factory("ClientReportSvc",function($rootScope){var app=$rootScope.app,nSorting=function(a,b){a||(a="0"),b||(b="0");var a_num=a.replace(/^\D+/g,""),b_num=b.replace(/^\D+/g,"");return(a_num=parseFloat(a))<(b_num=parseFloat(b))?-1:a_num>b_num?1:0},rSorting=function(a,b){var a_num,b_num;if(a){var a_nums=a.split("/");a_num=parseFloat(a_nums[0])/parseFloat(a_nums[1])*100}else a_num=0;if(b){var b_nums=b.split("/");b_num=parseFloat(b_nums[0])/parseFloat(b_nums[1])*100}else b_num=0;return a_num<b_num?-1:a_num>b_num?1:0};var compareCellClass=function(grid,row,col,rowRenderIndex,colRenderIndex){if(grid.getCellValue(row,col)){var n=parseFloat(grid.getCellValue(row,col));if(n>0)return"ui-grid-cell-positive";if(n<0)return"ui-grid-cell-negative"}},ficoChartMarkerFormatter=function(ficoScore){return{fillColor:ficoScore<560?"#9C2023":ficoScore<710?"#F0C330":"#528f1f"}},compareCellClassR=function(grid,row,col,rowRenderIndex,colRenderIndex){if(grid.getCellValue(row,col)){var n=parseFloat(grid.getCellValue(row,col));if(n<0)return"ui-grid-cell-positive";if(n>0)return"ui-grid-cell-negative"}};function createVm(el,usersMap,groupsMap,companiesMap){var vm={};if(vm.app=app,vm.companyId=0,vm.userId=0,vm.groupId=0,"DRIVER"==el.recordType){if(vm.recordKey=el.recordKey,!usersMap[el.recordKey])return;return vm.groupId=usersMap[el.recordKey].driverGroupId,vm.group=usersMap[el.recordKey].driverGroupId,groupsMap&&groupsMap[vm.groupId]&&(vm.groupName=groupsMap[vm.group].code),vm.first_name=usersMap[el.recordKey].user.FirstName,vm.last_name=usersMap[el.recordKey].user.LastName,vm.full_name=vm.first_name+" "+vm.last_name,vm.userId=el.recordKey,vm}if("COMPANY"==el.recordType||"GROUP"==el.recordType){if("COMPANY"==el.recordType)vm.full_name=companiesMap[el.recordKey].code,vm.companyId=el.recordKey;else if("GROUP"==el.recordType){if(!groupsMap[el.recordKey])return null;var companyName=companiesMap[groupsMap[el.recordKey].companyId].code;vm.full_name=companyName+" - "+groupsMap[el.recordKey].nameWithPath,vm.companyId=groupsMap[el.recordKey].companyId,vm.groupId=el.recordKey}else vm.companyId=usersMap[el.recordKey].companyId,vm.groupId=usersMap[el.recordKey].driverGroupId,vm.userId=el.recordKey;return groupsMap&&groupsMap[vm.groupId]&&(vm.groupName=groupsMap[vm.groupId].code),vm.recordKey=el.recordKey,vm}}function bindVm(el,vm){if(vm.SHOW_NA_FOR_NON_GEOTAB=!1,vm.SHOW_NA_FOR_GEOTAB_BUT_FAULTY_SENSOR=!1,"geotab"==el.tripStats.sourceBreakdown[0].key)if(0==el.tripStats.sourceBreakdown[0].count)vm.SHOW_NA_FOR_NON_GEOTAB=!0;else if(el.faultySensors)for(let sensor of el.faultySensors)"SEAT_BELT"==sensor.faultySensor&&sensor.tripCount>0&&(vm.SHOW_NA_FOR_GEOTAB_BUT_FAULTY_SENSOR=!0);if(vm&&el){if(el.fromDate&&(vm.fromDate=el.fromDate,vm.fromDate=moment(vm.fromDate).format("MM/DD/YYYY")),el.toDate&&(vm.toDate=el.toDate,vm.toDate=moment(vm.toDate).format("MM/DD/YYYY")),el.tripStats){if(el.tripStats.driverWithTripCount&&(vm.driver_count=el.tripStats.driverWithTripCount),el.tripStats.tripCount&&(vm.trip_count=el.tripStats.tripCount),el.tripStats.drivingModeBreakdown&&(el.tripStats.drivingModeBreakdown.find(function(el){"passenger"!=el.key||(vm.passenger_trips=el.count)}),el.tripStats.drivingModeBreakdown.find(function(el){"personal"!=el.key||(vm.personal_trips=el.count)})),!isNaN(vm.personal_trips)&&!isNaN(vm.passenger_trips)){vm.passenger_personal_trip_count=vm.personal_trips+vm.passenger_trips;Math.round(vm.passenger_personal_trip_count/vm.trip_count*100);vm.passenger_personal_trip_rate=1}vm.mileage=Math.round(621371e-9*el.tripStats.distance),vm.distance=Math.round(621371e-9*el.tripStats.distance),vm.duration=el.tripStats.duration,vm.mpg=el.tripStats.fuelConsumption?Math.round(235214e-11*el.tripStats.distance/el.tripStats.fuelConsumption):0}if(el.trainingStats&&(vm.training_count=el.trainingStats.completeCount+" / "+el.trainingStats.assignedCount),el.scores){var fico=el.scores.find(function(sc){return"TOTAL"===sc.scoreCategory});fico&&(vm.fico=fico.score)}if(el.events){var speeding=el.events.find(function(evt){return"SPEEDING"===evt.eventType});speeding?(vm.speeding_count=speeding.count,vm.speeding_per_100_miles=parseInt(100*speeding.count/vm.distance)):(vm.speeding_count=0,vm.speeding_per_100_miles=0);var distractions=el.events.filter(function(evt){return"CALL_INCOMING"===evt.eventType||"CALL_OUTGOING"===evt.eventType||"PHONE_MANIPULATION"===evt.eventType});distractions&&(vm.distraction_count=0,vm.distraction_duration=0,distractions.forEach(function(item){vm.distraction_count+=item.count,vm.distraction_duration+=item.duration}),vm.distraction_per_100_miles=parseInt(100*vm.distraction_count/vm.distance));var accel_count=el.events.find(function(evt){return"HARD_ACCELERATION"===evt.eventType});accel_count?(vm.accel_count=accel_count.count,vm.accel_per_100_miles=parseInt(100*vm.accel_count/vm.distance)):(vm.accel_count=0,vm.accel_per_100_miles=0);var breaking_count=el.events.find(function(evt){return"HARD_BRAKING"===evt.eventType});breaking_count?(vm.breaking_count=breaking_count.count,vm.breaking_per_100_miles=parseInt(100*vm.breaking_count/vm.distance)):(vm.breaking_count=0,vm.breaking_per_100_miles=0);var conering_count=el.events.find(function(evt){return"HARD_CORNERING"===evt.eventType});conering_count?(vm.cornering_count=conering_count.count,vm.cornering_per_100_miles=parseInt(100*vm.cornering_count/vm.distance)):(vm.cornering_count=0,vm.cornering_per_100_miles=0);var seat_belt_off=el.events.find(function(evt){return"SEAT_BELT_OFF"===evt.eventType});seat_belt_off?(vm.seat_belt_off_count=seat_belt_off.count,vm.seat_belt_off_per_100_miles=parseInt(100*vm.seat_belt_off_count/vm.distance),vm.SHOW_NA_FOR_NON_GEOTAB&&(vm.seat_belt_off_count="N/A",vm.seat_belt_off_per_100_miles="N/A"),vm.SHOW_NA_FOR_GEOTAB_BUT_FAULTY_SENSOR&&(vm.seat_belt_off_count="NULL",vm.seat_belt_off_per_100_miles="NULL")):(vm.seat_belt_off_count=0,vm.seat_belt_off_per_100_miles=0,vm.SHOW_NA_FOR_NON_GEOTAB&&(vm.seat_belt_off_count="N/A",vm.seat_belt_off_per_100_miles="N/A"),vm.SHOW_NA_FOR_GEOTAB_BUT_FAULTY_SENSOR&&(vm.seat_belt_off_count="NULL",vm.seat_belt_off_per_100_miles="NULL"));var reverse=el.events.find(function(evt){return"REVERSE"===evt.eventType});reverse?(vm.reverse_count=reverse.count,vm.reverse_count_per_100_miles=parseInt(100*vm.reverse_count/vm.distance),vm.SHOW_NA_FOR_NON_GEOTAB&&(vm.reverse_count="N/A",vm.reverse_count_per_100_miles="N/A")):(vm.reverse_count=0,vm.reverse_count_per_100_miles=0,vm.SHOW_NA_FOR_NON_GEOTAB&&(vm.reverse_count="N/A",vm.reverse_count_per_100_miles="N/A"));var idling=el.events.find(function(evt){return"IDLING"===evt.eventType});idling?(vm.idling_percentage=Math.round(100*idling.duration/el.tripStats.duration)+"%",vm.SHOW_NA_FOR_NON_GEOTAB&&(vm.idling_percentage="N/A")):(vm.idling_percentage="N/A",vm.SHOW_NA_FOR_NON_GEOTAB&&(vm.idling_percentage="N/A"));var engine_off=el.events.find(function(evt){return"ENGINE_OFF"===evt.eventType});engine_off?(vm.engine_off_count=engine_off.count,vm.SHOW_NA_FOR_NON_GEOTAB&&(vm.engine_off_count="N/A")):(vm.engine_off_count=0,vm.SHOW_NA_FOR_NON_GEOTAB&&(vm.engine_off_count="N/A"))}return vm}}return{prep_Amzl_Weely_Report:function(response,usersMap,isGrp,groupsMap,companyName){for(var gridData=[],i=0;i<response.data.length;i++){var reportItem=response.data[i];if(reportItem.recordKey){var dsp,full_name="",groupName="",companyId=0,groupId=0,userId=0;if("COMPANY"==reportItem.recordType)full_name=companyName,dsp=companyName,companyId=reportItem.recordKey;else if("GROUP"==reportItem.recordType){if(groupId=reportItem.recordKey,groupsMap&&!groupsMap[groupId])continue;groupsMap[reportItem.recordKey]&&(companyId=groupsMap[reportItem.recordKey].companyId,groupName=groupsMap[reportItem.recordKey].code,full_name=companyName+"/"+groupsMap[reportItem.recordKey].code)}else"DRIVER"==reportItem.recordType&&(userId=reportItem.recordKey,usersMap[reportItem.recordKey]&&(groupId=usersMap[reportItem.recordKey].driverGroupId,groupsMap&&groupId>0&&(groupName=groupsMap[groupId].code),companyId=usersMap[reportItem.recordKey].companyId));if(response.data[i].weeklyStats&&response.data[i].weeklyStats[0]&&response.data[i].weeklyStats[0].tripStats&&response.data[i].weeklyStats[0].tripStats.distance){var rowData={scores:{},firstName:isGrp?null:usersMap[response.data[i].recordKey].user.FirstName,lastName:isGrp?null:usersMap[response.data[i].recordKey].user.LastName,userName:isGrp?null:usersMap[response.data[i].recordKey].user.FirstName+" "+usersMap[response.data[i].recordKey].user.LastName,full_name:isGrp?full_name:usersMap[response.data[i].recordKey].user.FirstName+" "+usersMap[response.data[i].recordKey].user.LastName,group:isGrp?null:usersMap[response.data[i].recordKey].driverGroupId,recordKey:response.data[i].recordKey,companyId:companyId,groupId:groupId,userId:userId,groupName:groupName,dsp:dsp},d=response.data[i].weeklyStats[0];if(bindVm(d,rowData),rowData.tripStats=d.tripStats,rowData.tripStats.mpg=rowData.tripStats.fuelConsumption?Math.round(235214e-11*d.tripStats.distance/d.tripStats.fuelConsumption):"N/A",rowData.SHOW_NA_FOR_NON_GEOTAB&&(rowData.mpg="N/A"),rowData.tripStats.distance=Math.round(621371e-9*rowData.tripStats.distance),d.inspectionStats?(rowData.tripStats.dvir_pre=d.inspectionStats.preInspectionCount>0?d.inspectionStats.preInspectionCount:0,rowData.tripStats.dvir_post=d.inspectionStats.postInspectionCount>0?d.inspectionStats.postInspectionCount:0):(rowData.tripStats.dvir_pre=0,rowData.tripStats.dvir_post=0),d.trainingStats&&(rowData.tripStats.training=d.trainingStats.completeCount+" / "+d.trainingStats.assignedCount,rowData.tripStats.training_completeCount=d.trainingStats.completeCount,rowData.tripStats.training_assignedCount=d.trainingStats.assignedCount),d.scores)for(var j=0;j<d.scores.length;j++)rowData.scores[d.scores[j].scoreCategory]=d.scores[j].score;rowData.app=app,gridData.push(rowData)}}}return console.log(gridData),gridData},prep_Amzl_Daily_Report:function(response,usersMap,isGrp,groupsMap,companyName){for(var gridData=[],dsp=companyName,i=0;i<response.data.length;i++)if(response.data[i].recordKey){var full_name="",companyId=0,groupId=0,userId=0,groupName="";if("COMPANY"==response.data[i].recordType)full_name=companyName,companyId=response.data[i].recordKey;else if("GROUP"==response.data[i].recordType){if(groupId=response.data[i].recordKey,groupsMap&&!groupsMap[groupId])continue;groupId>0&&(companyId=groupsMap[groupId].companyId),full_name=companyName+"/"+groupsMap[response.data[i].recordKey].code,groupName=groupsMap[response.data[i].recordKey].code}else"DRIVER"==response.data[i].recordType&&(userId=response.data[i].recordKey,usersMap[response.data[i].recordKey]&&(groupId=usersMap[response.data[i].recordKey].driverGroupId,groupsMap&&groupId>0&&(groupName=groupsMap[groupId].code),companyId=usersMap[response.data[i].recordKey].companyId));if(response.data[i].dailyStats&&response.data[i].dailyStats[0]&&response.data[i].dailyStats[0].tripStats&&response.data[i].dailyStats[0].tripStats.distance){var rowData={scores:{},firstName:isGrp?null:usersMap[response.data[i].recordKey].user.FirstName,lastName:isGrp?null:usersMap[response.data[i].recordKey].user.LastName,userName:isGrp?null:usersMap[response.data[i].recordKey].user.FirstName+" "+usersMap[response.data[i].recordKey].user.LastName,full_name:isGrp?full_name:usersMap[response.data[i].recordKey].user.FirstName+" "+usersMap[response.data[i].recordKey].user.LastName,group:isGrp?null:usersMap[response.data[i].recordKey].driverGroupId,recordKey:response.data[i].recordKey,companyId:companyId,groupId:groupId,userId:userId,groupName:groupName,dsp:dsp},d=response.data[i].dailyStats[0];if(bindVm(d,rowData),rowData.tripStats=d.tripStats,rowData.tripStats.mpg=rowData.tripStats.fuelConsumption?Math.round(235214e-11*d.tripStats.distance/d.tripStats.fuelConsumption):"N/A",rowData.tripStats.distance=Math.round(621371e-9*rowData.tripStats.distance),rowData.SHOW_NA_FOR_NON_GEOTAB&&(rowData.mpg="N/A"),d.inspectionStats?(rowData.tripStats.dvir_pre=d.inspectionStats.preInspectionCount>0?d.inspectionStats.preInspectionCount:0,rowData.tripStats.dvir_post=d.inspectionStats.postInspectionCount>0?d.inspectionStats.postInspectionCount:0):(rowData.tripStats.dvir_pre=0,rowData.tripStats.dvir_post=0),d.trainingStats&&(rowData.tripStats.training=d.trainingStats.completeCount+" / "+d.trainingStats.assignedCount,rowData.tripStats.training_completeCount=d.trainingStats.completeCount,rowData.tripStats.training_assignedCount=d.trainingStats.assignedCount),d.scores)for(var j=0;j<d.scores.length;j++)rowData.scores[d.scores[j].scoreCategory]=d.scores[j].score;rowData.app=app,gridData.push(rowData)}}return gridData},prep_Amzl_Monthly_Report:function(response,usersMap,isGrp,groupsMap,companyName){for(var dsp=companyName,gridData=[],i=0;i<response.data.length;i++)if(response.data[i].recordKey){var full_name="",groupName="",companyId=0,groupId=0,userId=0;if("COMPANY"==response.data[i].recordType)full_name=companyName,companyId=response.data[i].recordKey;else if("GROUP"==response.data[i].recordType){if(groupId=response.data[i].recordKey,groupsMap&&!groupsMap[groupId])continue;companyId=groupsMap[groupId].companyId,full_name=companyName+"/"+groupsMap[response.data[i].recordKey].name,groupName=groupsMap[response.data[i].recordKey].code}else"DRIVER"==response.data[i].recordType&&(userId=response.data[i].recordKey,usersMap[response.data[i].recordKey]&&(groupId=usersMap[response.data[i].recordKey].driverGroupId,groupsMap&&groupId>0&&(groupName=groupsMap[groupId].code),companyId=usersMap[response.data[i].recordKey].companyId));if(response.data[i].monthlyStats&&response.data[i].monthlyStats[0]&&response.data[i].monthlyStats[0].tripStats&&response.data[i].monthlyStats[0].tripStats.distance){var rowData={scores:{},firstName:isGrp?null:usersMap[response.data[i].recordKey].user.FirstName,lastName:isGrp?null:usersMap[response.data[i].recordKey].user.LastName,userName:isGrp?null:usersMap[response.data[i].recordKey].user.FirstName+" "+usersMap[response.data[i].recordKey].user.LastName,full_name:isGrp?full_name:usersMap[response.data[i].recordKey].user.FirstName+" "+usersMap[response.data[i].recordKey].user.LastName,group:isGrp?null:usersMap[response.data[i].recordKey].driverGroupId,recordKey:response.data[i].recordKey,companyId:companyId,groupId:groupId,userId:userId,groupName:groupName,dsp:dsp},d=response.data[i].monthlyStats[0];if(bindVm(d,rowData),rowData.tripStats=d.tripStats,rowData.tripStats.mpg=rowData.tripStats.fuelConsumption?Math.round(235214e-11*d.tripStats.distance/d.tripStats.fuelConsumption):"N/A",rowData.tripStats.distance=Math.round(621371e-9*rowData.tripStats.distance),rowData.SHOW_NA_FOR_NON_GEOTAB&&(rowData.mpg="N/A"),d.inspectionStats?(rowData.tripStats.dvir_pre=d.inspectionStats.preInspectionCount>0?d.inspectionStats.preInspectionCount:0,rowData.tripStats.dvir_post=d.inspectionStats.postInspectionCount>0?d.inspectionStats.postInspectionCount:0):(rowData.tripStats.dvir_pre=0,rowData.tripStats.dvir_post=0),d.trainingStats&&(rowData.tripStats.training=d.trainingStats.completeCount+" / "+d.trainingStats.assignedCount,rowData.tripStats.training_completeCount=d.trainingStats.completeCount,rowData.tripStats.training_assignedCount=d.trainingStats.assignedCount),d.scores)for(var j=0;j<d.scores.length;j++)rowData.scores[d.scores[j].scoreCategory]=d.scores[j].score;rowData.app=app,gridData.push(rowData)}}return gridData},prep_Distributor_Weely_Report:function(response,groupsMap,companiesMap){for(var gridData=[],companiesReport={},h=0;h<response.data.length;h++)"COMPANY"==response.data[h].recordType&&(companiesReport[response.data[h].recordKey]||(companiesReport[response.data[h].recordKey]=[]),companiesReport[response.data[h].recordKey].push(response.data[h]));for(h=0;h<response.data.length;h++)if("GROUP"==response.data[h].recordType){var g=groupsMap[response.data[h].recordKey];g&&companiesReport[g.companyId].push(response.data[h])}for(var companyId in companiesReport)for(var companyReport=companiesReport[companyId],i=0;i<companyReport.length;i++){var groupId=0,groupName="",dsp="",fullName="";if(companyReport[i].weeklyStats&&companyReport[i].weeklyStats[0]&&companyReport[i].weeklyStats[0].tripStats&&companyReport[i].weeklyStats[0].tripStats.distance){"COMPANY"==companyReport[i].recordType?companiesMap&&(companiesMap&&(fullName=companiesMap[companyReport[i].recordKey].code),dsp=fullName):"GROUP"==companyReport[i].recordType&&(groupsMap&&(groupName=groupsMap[companyReport[i].recordKey].code),dsp=companiesMap[companyId].code,groupId=companyReport[i].recordKey);var rowData={scores:{},full_name:fullName,dsp:dsp,groupName:groupName,recordKey:companyReport[i].recordKey,companyId:companyId,groupId:groupId},d=companyReport[i].weeklyStats[0];if(bindVm(d,rowData),rowData.tripStats=d.tripStats,rowData.tripStats.mpg=rowData.tripStats.fuelConsumption?Math.round(235214e-11*d.tripStats.distance/d.tripStats.fuelConsumption):"N/A",rowData.tripStats.distance=Math.round(621371e-9*rowData.tripStats.distance),rowData.SHOW_NA_FOR_NON_GEOTAB&&(rowData.mpg="N/A"),d.inspectionStats?(rowData.tripStats.dvir_pre=d.inspectionStats.preInspectionCount>0?d.inspectionStats.preInspectionCount:0,rowData.tripStats.dvir_post=d.inspectionStats.postInspectionCount>0?d.inspectionStats.postInspectionCount:0):(rowData.tripStats.dvir_pre=0,rowData.tripStats.dvir_post=0),d.trainingStats&&(rowData.tripStats.training=d.trainingStats.completeCount+" / "+d.trainingStats.assignedCount,rowData.tripStats.training_completeCount=d.trainingStats.completeCount,rowData.tripStats.training_assignedCount=d.trainingStats.assignedCount),d.scores)for(var j=0;j<d.scores.length;j++)rowData.scores[d.scores[j].scoreCategory]=d.scores[j].score;rowData.app=app,gridData.push(rowData)}}return gridData},prep_Distributor_Monthly_Report:function(response,groupsMap,companiesMap){for(var gridData=[],companiesReport={},h=0;h<response.data.length;h++)"COMPANY"==response.data[h].recordType&&(companiesReport[response.data[h].recordKey]||(companiesReport[response.data[h].recordKey]=[]),companiesReport[response.data[h].recordKey].push(response.data[h]));for(h=0;h<response.data.length;h++)if("GROUP"==response.data[h].recordType){var g=groupsMap[response.data[h].recordKey];g&&companiesReport[g.companyId].push(response.data[h])}for(var companyId in companiesReport)for(var companyReport=companiesReport[companyId],i=0;i<companyReport.length;i++){var groupId=0,groupName="",dsp="",fullName="";if(companyReport[i].monthlyStats&&companyReport[i].monthlyStats[0]&&companyReport[i].monthlyStats[0].tripStats&&companyReport[i].monthlyStats[0].tripStats.distance){"COMPANY"==companyReport[i].recordType?(companiesMap&&(fullName=companiesMap[companyReport[i].recordKey].code),dsp=fullName):"GROUP"==companyReport[i].recordType&&(groupsMap&&(groupName=groupsMap[companyReport[i].recordKey].code),dsp=companiesMap[companyId].code,groupId=companyReport[i].recordKey);var rowData={scores:{},full_name:fullName,recordKey:companyReport[i].recordKey,companyId:companyId,groupName:groupName,groupId:groupId,dsp:dsp},d=companyReport[i].monthlyStats[0];if(bindVm(d,rowData),rowData.tripStats=d.tripStats,rowData.tripStats.mpg=rowData.tripStats.fuelConsumption?Math.round(235214e-11*d.tripStats.distance/d.tripStats.fuelConsumption):"N/A",rowData.tripStats.distance=Math.round(621371e-9*rowData.tripStats.distance),rowData.SHOW_NA_FOR_NON_GEOTAB&&(rowData.mpg="N/A"),d.inspectionStats?(rowData.tripStats.dvir_pre=d.inspectionStats.preInspectionCount>0?d.inspectionStats.preInspectionCount:0,rowData.tripStats.dvir_post=d.inspectionStats.postInspectionCount>0?d.inspectionStats.postInspectionCount:0):(rowData.tripStats.dvir_pre=0,rowData.tripStats.dvir_post=0),d.trainingStats&&(rowData.tripStats.training=d.trainingStats.completeCount+" / "+d.trainingStats.assignedCount,rowData.tripStats.training_completeCount=d.trainingStats.completeCount,rowData.tripStats.training_assignedCount=d.trainingStats.assignedCount),d.scores)for(var j=0;j<d.scores.length;j++)rowData.scores[d.scores[j].scoreCategory]=d.scores[j].score;rowData.app=app,gridData.push(rowData)}}return gridData},prep_Distributor_Daily_Report:function(response,groupsMap,companiesMap){for(var gridData=[],companiesReport={},h=0;h<response.data.length;h++)"COMPANY"==response.data[h].recordType&&(companiesReport[response.data[h].recordKey]||(companiesReport[response.data[h].recordKey]=[]),companiesReport[response.data[h].recordKey].push(response.data[h]));for(h=0;h<response.data.length;h++)if("GROUP"==response.data[h].recordType){var g=groupsMap[response.data[h].recordKey];g&&companiesReport[g.companyId].push(response.data[h])}for(var companyId in companiesReport)for(var companyReport=companiesReport[companyId],i=0;i<companyReport.length;i++){var groupId=0,groupName="",dsp="",fullName="";if(companyReport[i].dailyStats&&companyReport[i].dailyStats[0]&&companyReport[i].dailyStats[0].tripStats&&companyReport[i].dailyStats[0].tripStats.distance){"COMPANY"==companyReport[i].recordType?(companiesMap&&(fullName=companiesMap[companyReport[i].recordKey].code),dsp=fullName):"GROUP"==companyReport[i].recordType&&(groupsMap&&(fullName=groupsMap[companyReport[i].recordKey].code),groupName=fullName,groupId=companyReport[i].recordKey,dsp=companiesMap[companyId].code);var rowData={scores:{},full_name:fullName,recordKey:companyReport[i].recordKey,companyId:companyId,groupId:groupId,groupName:groupName,dsp:dsp},d=companyReport[i].dailyStats[0];if(bindVm(d,rowData),rowData.tripStats=d.tripStats,rowData.tripStats.mpg=rowData.tripStats.fuelConsumption?Math.round(235214e-11*d.tripStats.distance/d.tripStats.fuelConsumption):"N/A",rowData.tripStats.distance=Math.round(621371e-9*rowData.tripStats.distance),rowData.SHOW_NA_FOR_NON_GEOTAB&&(rowData.mpg="N/A"),d.inspectionStats?(rowData.tripStats.dvir_pre=d.inspectionStats.preInspectionCount>0?d.inspectionStats.preInspectionCount:0,rowData.tripStats.dvir_post=d.inspectionStats.postInspectionCount>0?d.inspectionStats.postInspectionCount:0):(rowData.tripStats.dvir_pre=0,rowData.tripStats.dvir_post=0),d.trainingStats&&(rowData.tripStats.training=d.trainingStats.completeCount+" / "+d.trainingStats.assignedCount,rowData.tripStats.training_completeCount=d.trainingStats.completeCount,rowData.tripStats.training_assignedCount=d.trainingStats.assignedCount),d.scores)for(var j=0;j<d.scores.length;j++)rowData.scores[d.scores[j].scoreCategory]=d.scores[j].score;rowData.app=app,gridData.push(rowData)}}return gridData},set_DistributorGridOption:function($scope,isGrp){$scope.gridOptions={visible:!1,enableSorting:!0,enableGridMenu:!1,exporterMenuCsv:!0,exporterMenuPdf:!1,exporterMenuExcel:!1,exporterMenuVisibleData:!1,exporterCsvFilename:"dist_weekly_report_.csv",exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location")),gridMenuShowHideColumns:!1,enableColumnMenus:!1,enableFiltering:!0,enableHorizontalScrollbar:!0,enableColumnResizing:!0,rowHeight:42,category:[{name:"A",visible:!0}],columnDefs:[{category:"None",name:"DSP",field:"dsp",width:"15%",visible:!!isGrp,enableFiltering:!1},{category:"A",displayName:"STATION",field:"groupName",enableFiltering:!1,width:"15%",cellTemplate:'<div style="padding:5px"><a href="#!/{{row.entity.app}}/fleet-report-trend/{{row.entity.companyId}}/{{row.entity.groupId}}/{{row.entity.userId}}">{{row.entity.groupName}}</a></div>'},{category:"A",name:"Drivers",field:"tripStats.driverWithTripCount",enableFiltering:!1,visible:!1},{category:"A",name:"Trips",field:"tripStats.tripCount",enableFiltering:!1,type:"number"},{category:"A",name:"Miles",field:"tripStats.distance",enableFiltering:!1,type:"number"},{category:"B",name:"Mileage change",field:"mileage_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClass},{category:"A",name:"Time",field:"tripStats.duration",cellFilter:"duration",enableFiltering:!1,type:"number",width:"6%"},{category:"A",name:"FICO",field:"scores.TOTAL",enableFiltering:!1,type:"number"},{category:"B",name:"FICO change",field:"fico_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClass},{category:"A",name:"Accel",field:"accel_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/acceleration.svg" tooltips tooltip-template="Acceleration" tooltip-class="short" tooltip-append-to-body="true" height="22px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Braking",field:"breaking_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/braking.svg" tooltips tooltip-template="Braking" tooltip-class="short" tooltip-append-to-body="true" height="23px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Braking per 100 miles",field:"breaking_per_100_miles",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/braking.svg" tooltips tooltip-template="Braking per 100 Miles" tooltip-class="short" tooltip-append-to-body="true" height="23px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"B",name:"Breaking changes",field:"breaking_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClassR},{category:"A",name:"Cornering",field:"cornering_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/cornering.svg" tooltips tooltip-template="Cornering" tooltip-class="short" tooltip-append-to-body="true" height="21px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Speeding",field:"speeding_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/speed.svg" tooltips tooltip-template="Speeding" tooltip-class="short" tooltip-append-to-body="true" height="20px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Speeding per 100 miles",field:"speeding_per_100_miles",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/speed.svg" tooltips tooltip-template="Speeding per 100 Miles" tooltip-class="short" tooltip-append-to-body="true" height="20px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"B",name:"Speeding change",field:"speeding_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClassR},{category:"A",name:"Distraction",field:"distraction_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/distraction.svg" tooltips tooltip-template="Distraction" tooltip-class="short" tooltip-append-to-body="true" height="25px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Distraction per 100 miles",field:"distraction_per_100_miles",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/distraction.svg" tooltips tooltip-template="Distraction per 100 Miles" tooltip-class="long" tooltip-append-to-body="true" height="25px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"B",name:"Distraction change",field:"distraction_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClassR},{category:"A",name:"Seatbelt",field:"seat_belt_off_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/seatbelt.svg"  tooltips tooltip-template="Seatbelt Off" tooltip-class="short" tooltip-append-to-body="true"  height="25px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Seatbelt off for 100 miles",field:"seat_belt_off_per_100_miles",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/seatbelt.svg"  tooltips tooltip-template="Seatbelt Off per 100 Miles" tooltip-class="long" tooltip-append-to-body="true"  height="25px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"B",name:"Seatbelt off change",field:"seat_belt_off_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClassR},{category:"A",name:"Back up",field:"reverse_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/backup.svg"  tooltips tooltip-template="Back Up" tooltip-class="short" tooltip-append-to-body="true" height="25px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Back up per 100 miles",field:"reverse_count_per_100_miles",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/backup.svg"  tooltips tooltip-template="Back Up per 100 Miles" tooltip-class="short" tooltip-append-to-body="true" height="25px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"B",name:"Back up changes",field:"reverse_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClassR},{category:"A",name:"MPG",field:"mpg",enableFiltering:!1,type:"number"},{category:"B",name:"MPG changes",field:"mpg_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClass},{category:"A",name:"Idling",field:"idling_percentage",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting},{category:"A",name:"Engine Off",field:"engine_off_count",enableFiltering:!1,type:"number"},{category:"A",name:"Pre DVCR",displayName:"Pre DVCR",field:"tripStats.dvir_pre",enableFiltering:!1,type:"number"},{category:"A",name:"Post DVCR",displayName:"Post DVCR",field:"tripStats.dvir_post",enableFiltering:!1,type:"number"},{category:"A",name:"Training assigned",field:"tripStats.training_assignedCount",enableFiltering:!1,type:"number"},{category:"A",name:"Training completed",field:"tripStats.training_completeCount",enableFiltering:!1,type:"number"}],onRegisterApi:function(gridApi){gridApi.core.on.renderingComplete($scope,function(){}),$scope.gridApi=gridApi}}},set_AmzlGridOption:function($scope,isGrp){$scope.gridOptions={visible:!1,enableSorting:!0,enableGridMenu:!1,exporterMenuCsv:!0,exporterMenuPdf:!1,exporterMenuExcel:!1,exporterMenuVisibleData:!1,exporterCsvFilename:"amzl_weekly_report_.csv",exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location")),gridMenuShowHideColumns:!1,enableColumnMenus:!1,enableFiltering:!0,enableHorizontalScrollbar:!0,enableColumnResizing:!0,rowHeight:42,category:[{name:"A",visible:!0}],columnDefs:[{category:"None",name:"DSP",field:"dsp",width:"15%",visible:!!isGrp,enableFiltering:!1},{category:"A",displayName:isGrp?"STATION":"Driver Name",field:isGrp?"groupName":"full_name",enableFiltering:!1,width:"15%",cellTemplate:isGrp?'<div style="padding:5px"><a href="#!/{{row.entity.app}}/fleet-report-trend/{{row.entity.companyId}}/{{row.entity.groupId}}/{{row.entity.userId}}">{{row.entity.groupName}}</a></div>':'<div style="padding:5px"><a href="#!/{{row.entity.app}}/fleet-report-trend/{{row.entity.companyId}}/{{row.entity.groupId}}/{{row.entity.userId}}">{{row.entity.full_name}}</a></div>'},{category:"A",name:"Drivers",field:"tripStats.driverWithTripCount",enableFiltering:!1,visible:!1},{category:"A",name:"Trips",field:"tripStats.tripCount",enableFiltering:!1,type:"number"},{category:"A",name:"Miles",field:"tripStats.distance",enableFiltering:!1,type:"number"},{category:"B",name:"Mileage change",field:"mileage_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClass},{category:"A",name:"Time",field:"tripStats.duration",cellFilter:"duration",enableFiltering:!1,type:"number",width:"6%"},{category:"A",name:"FICO",field:"scores.TOTAL",enableFiltering:!1,type:"number"},{category:"B",name:"FICO change",field:"fico_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClass},{category:"A",name:"Accel",field:"accel_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/acceleration.svg" tooltips tooltip-template="Acceleration" tooltip-class="short" tooltip-append-to-body="true" height="22px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Braking",field:"breaking_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/braking.svg" tooltips tooltip-template="Braking" tooltip-class="short" tooltip-append-to-body="true" height="23px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Braking per 100 miles",field:"breaking_per_100_miles",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/braking.svg" tooltips tooltip-template="Braking per 100 Miles" tooltip-class="short" tooltip-append-to-body="true" height="23px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"B",name:"Breaking changes",field:"breaking_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClassR},{category:"A",name:"Cornering",field:"cornering_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/cornering.svg" tooltips tooltip-template="Cornering" tooltip-class="short" tooltip-append-to-body="true" height="21px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Speeding",field:"speeding_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/speed.svg" tooltips tooltip-template="Speeding" tooltip-class="short" tooltip-append-to-body="true" height="20px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Speeding per 100 miles",field:"speeding_per_100_miles",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/speed.svg" tooltips tooltip-template="Speeding per 100 Miles" tooltip-class="short" tooltip-append-to-body="true" height="20px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"B",name:"Speeding change",field:"speeding_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClassR},{category:"A",name:"Distraction",field:"distraction_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/distraction.svg" tooltips tooltip-template="Distraction" tooltip-class="short" tooltip-append-to-body="true" height="25px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Distraction per 100 miles",field:"distraction_per_100_miles",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/distraction.svg" tooltips tooltip-template="Distraction per 100 Miles" tooltip-class="long" tooltip-append-to-body="true" height="25px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"B",name:"Distraction change",field:"distraction_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClassR},{category:"A",name:"Seatbelt",field:"seat_belt_off_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/seatbelt.svg"  tooltips tooltip-template="Seatbelt Off" tooltip-class="short" tooltip-append-to-body="true"  height="25px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Seatbelt off for 100 miles",field:"seat_belt_off_per_100_miles",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/seatbelt.svg"  tooltips tooltip-template="Seatbelt Off per 100 Miles" tooltip-class="long" tooltip-append-to-body="true"  height="25px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"B",name:"Seatbelt off change",field:"seat_belt_off_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClassR},{category:"A",name:"Back up",field:"reverse_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/backup.svg"  tooltips tooltip-template="Back Up" tooltip-class="short" tooltip-append-to-body="true" height="25px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"A",name:"Back up per 100 miles",field:"reverse_count_per_100_miles",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/backup.svg"  tooltips tooltip-template="Back Up per 100 Miles" tooltip-class="short" tooltip-append-to-body="true" height="25px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"B",name:"Back up changes",field:"reverse_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClassR},{category:"A",name:"MPG",field:"mpg",enableFiltering:!1,type:"number"},{category:"B",name:"MPG changes",field:"mpg_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClass},{category:"A",name:"Idling",field:"idling_percentage",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting},{category:"A",name:"Engine Off",field:"engine_off_count",enableFiltering:!1,type:"number"},{category:"A",name:"Pre DVCR",displayName:"Pre DVCR",field:"tripStats.dvir_pre",enableFiltering:!1,type:"number"},{category:"A",name:"Post DVCR",displayName:"Post DVCR",field:"tripStats.dvir_post",enableFiltering:!1,type:"number"},{category:"A",name:"Training assigned",field:"tripStats.training_assignedCount",enableFiltering:!1,type:"number"},{category:"A",name:"Training completed",field:"tripStats.training_completeCount",enableFiltering:!1,type:"number"},{category:"A",name:"GroupId",field:"groupId",enableFiltering:!0,type:"number",visible:!1}],onRegisterApi:function(gridApi){gridApi.core.on.renderingComplete($scope,function(){}),$scope.gridApi=gridApi}}},set_GridOption:function($scope,isGrp){$scope.gridOptions={visible:!1,enableSorting:!0,enableGridMenu:!1,exporterMenuCsv:!0,exporterMenuPdf:!1,exporterMenuExcel:!1,exporterMenuVisibleData:!1,exporterCsvFilename:"driver_daily_report_.csv",exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location")),gridMenuShowHideColumns:!1,enableColumnMenus:!1,enableFiltering:!0,enableHorizontalScrollbar:!0,enableColumnResizing:!0,rowHeight:42,category:[{name:"PII",visible:!0},{name:"Performance Summary",visible:!0},{name:"Events",visible:!0},{name:"Training",visible:!0},{name:"Comparison by Percentage",visible:!0}],columnDefs:[{category:"None",name:"Group",field:"groupName",enableFiltering:!1,visible:!!isGrp},{category:"PII",name:isGrp?"FLEET/GROUP":"Driver Name",field:"full_name",enableFiltering:!1,width:"20%",cellTemplate:'<div style="padding:5px"><a href="#!/{{row.entity.app}}/fleet-report-trend/{{row.entity.companyId}}/{{row.entity.groupId}}/{{row.entity.userId}}">{{row.entity.full_name}}</a></div>'},{category:"PII",name:"Last Name",field:"last_name",visible:!1},{category:"Performance Summary",name:"FICO",field:"fico",enableFiltering:!1,type:"number"},{category:"Comparison by Percentage",name:"FICO change in %",field:"fico_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClass},{category:"Performance Summary",name:"Miles",field:"mileage",enableFiltering:!1,type:"number"},{category:"Comparison by Percentage",name:"Mileage change",field:"mileage_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClass},{category:"Performance Summary",name:"Time",cellFilter:"duration",field:"duration",enableFiltering:!1,type:"number"},{category:"Comparison by Percentage",name:"Speeding per 100 miles",field:"speeding_per_100_miles",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/speed.svg" tooltips tooltip-template="Speeding per 100 Miles" tooltip-class="long" tooltip-append-to-body="true" height="20px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"Comparison by Percentage",name:"Speeding change",field:"speeding_delta",enableFiltering:!1,sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClassR},{category:"Comparison by Percentage",name:"Distraction per 100 miles",field:"distraction_per_100_miles",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/distraction.svg" tooltips tooltip-template="Distraction per 100 Miles" tooltip-class="long" tooltip-append-to-body="true" height="25px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"Comparison by Percentage",name:"Distraction change",field:"distraction_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClassR},{category:"Performance Summary",name:"Trips",field:"trip_count",enableFiltering:!1,type:"number"},{category:"Performance Summary",name:"Passenger",field:"passenger_trips",enableFiltering:!1,type:"number"},{category:"Performance Summary",name:"Personal",field:"personal_trips",enableFiltering:!1,type:"number"},{category:"Events",name:"Speeding",field:"speeding_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/speed.svg" tooltips tooltip-template="Speeding" tooltip-class="short" tooltip-append-to-body="true" height="20px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"Events",name:"Distraction",field:"distraction_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/distraction.svg" tooltips tooltip-template="Distraction" tooltip-class="short" tooltip-append-to-body="true" height="25px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"Events",name:"Accel",field:"accel_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/acceleration.svg" tooltips tooltip-template="Acceleration" tooltip-class="short" tooltip-append-to-body="true" height="22px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"Events",name:"Breaking",field:"breaking_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/braking.svg" tooltips tooltip-template="Braking" tooltip-class="short" tooltip-append-to-body="true" height="23px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"Events",name:"Cornering",field:"cornering_count",enableFiltering:!1,type:"number",headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/cornering.svg" tooltips tooltip-template="Cornering" tooltip-class="short" tooltip-append-to-body="true" height="21px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"Training",name:"Training",field:"training_count",enableFiltering:!1,type:"number",sortingAlgorithm:rSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/play-icon.png" tooltips tooltip-template="Modules Completed/Assigned" tooltip-class="long" tooltip-append-to-body="true" height="21px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>'},{category:"Comparison by Percentage",name:"Trip change %",field:"trip_count_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClass},{category:"Comparison by Percentage",name:"P/P trips",field:"passenger_personal_trip_count",enableFiltering:!1,type:"number"},{category:"Comparison by Percentage",name:"PP trip %",field:"passenger_personal_trip_delta",enableFiltering:!1,type:"number",sortingAlgorithm:nSorting,headerCellTemplate:'<div ng-class="{ \'sortable\': sortable }"><div class="ui-grid-vertical-bar">&nbsp;</div><div class="ui-grid-cell-contents" col-index="renderIndex"><img  src="/img/v2/arrow-up.png" tooltip="triangle with all three sides equal" height="10px" width="" /><span ui-grid-visible="col.sort.direction" ng-class="{ \'ui-grid-icon-up-dir\': col.sort.direction == asc, \'ui-grid-icon-down-dir\': col.sort.direction == desc, \'ui-grid-icon-blank\': !col.sort.direction }">&nbsp;</span></div><div class="ui-grid-column-menu-button" ng-if="grid.options.enableColumnMenus && !col.isRowHeader  && col.colDef.enableColumnMenu !== false" class="ui-grid-column-menu-button" ng-click="toggleMenu($event)"><i class="ui-grid-icon-angle-down">&nbsp;</i></div><div ng-if="filterable" class="ui-grid-filter-container" ng-repeat="colFilter in col.filters"><input type="text" class="ui-grid-filter-input" ng-model="colFilter.term" ng-click="$event.stopPropagation()" ng-attr-placeholder="{{colFilter.placeholder || \'\'}}" /><div class="ui-grid-filter-button" ng-click="colFilter.term = null"><i class="ui-grid-icon-cancel" ng-show="!!colFilter.term">&nbsp;</i> \x3c!-- use !! because angular interprets \'f\' as false --\x3e</div></div></div>',cellClass:compareCellClassR}],onRegisterApi:function(gridApi){gridApi.core.on.renderingComplete($scope,function(){}),$scope.gridApi=gridApi}}},getReportCategories:function(){return[{name:"FICO",titles:"FICO",fields:"fico",visible:!0,chartStyle:{marker:ficoChartMarkerFormatter}},{name:"MILES",titles:"MILES",fields:"distance",visible:!0},{name:"EVENTS PER 100 MILES",titles:"SPEEDINGS,DISTRACTIONS,HARD BRAKINGS, HARD CORNERINGS, HARD ACCELERATIONS",fields:"speeding_per_100_miles,distraction_per_100_miles,breaking_per_100_miles,cornering_per_100_miles,accel_per_100_miles",visible:!0},{name:"TRIPS",titles:"TRIPS, P/P TRIPS",fields:"trip_count,passenger_personal_trip_count",visible:!0},{name:"DRIVERS",titles:"DRIVER",fields:"driver_count",visible:!1},{name:"MPG",titles:"MPG",fields:"mpg",visible:!0}]},getCategoryDataOnly:function(list,category){if(list){for(var series=[],fields=category.fields.split(","),titles=category.titles.split(","),i=0;i<fields.length;i++){var item={};item.name=titles[i],item.data=list.reduce(function(acc,el){if(el)return el[fields[i]]&&el[fields[i]]>0?acc.push({y:el[fields[i]],marker:category.chartStyle&&category.chartStyle.marker?category.chartStyle.marker(el[fields[i]]):null}):acc.push(null),acc},[]),series.push(item)}return series}},calculatePeriod:function(period){var min,max,tick,interval;return"this week"==period?(min=1e3*moment().startOf("week").unix(),max=1e3*moment().endOf("week").startOf("day").unix(),tick=864e5,interval="day"):"last week"==period?(min=1e3*moment().subtract(1,"week").startOf("week").unix(),max=1e3*moment().subtract(1,"week").endOf("week").startOf("day").unix(),tick=864e5,interval="day"):"last 30 days"==period?(min=1e3*moment().subtract(30,"day").unix(),max=1e3*moment().unix(),tick=864e5,interval="day"):"this month"==period?(min=1e3*moment().startOf("month").startOf("day").unix(),max=1e3*moment().endOf("month").startOf("day").unix(),tick=864e5,interval="day"):"last month"==period?(min=1e3*moment().subtract(1,"month").startOf("month").startOf("day").unix(),max=1e3*moment().subtract(1,"month").endOf("month").startOf("day").unix(),tick=864e5,interval="day"):"last 6 weeks"==period?(min=1e3*moment().subtract(6,"week").startOf("week").unix(),max=1e3*moment().subtract(1,"week").endOf("week").unix(),interval="week"):"last 6 months"==period?(min=1e3*moment().subtract(6,"month").startOf("month").unix(),max=1e3*moment().subtract(1,"month").endOf("month").unix(),interval="week"):"this year"==period?(min=1e3*moment().startOf("year").startOf("day").unix(),max=1e3*moment().endOf("year").startOf("day").unix(),interval="week"):"last year"==period&&(min=1e3*moment().subtract(1,"year").startOf("year").startOf("day").unix(),max=1e3*moment().subtract(1,"year").endOf("year").startOf("day").unix(),interval="month"),{periodStart:moment(min).format("YYYY-MM-DD"),periodEnd:moment(max).format("YYYY-MM-DD"),interval:interval,xAxis:{min:min,max:max,tick:tick}}},calculateDelta:function(thisPeriod,prevPeriod){return thisPeriod.forEach(function(el){var pre=prevPeriod.find(function(pre_el){return!(!pre_el||!el)&&pre_el.recordKey==el.recordKey});if(pre){if(!isNaN(el.fico)&&!isNaN(pre.fico)&&pre.fico>0){var d=Math.round((el.fico-pre.fico)/pre.fico*100);el.fico_delta=(d<0?"":"+")+d+"%"}else el.fico_delta="N/A";if(!isNaN(el.passenger_personal_trip_count)&&!isNaN(pre.passenger_personal_trip_count)&&pre.passenger_personal_trip_count>0){d=Math.round((el.passenger_personal_trip_count-pre.passenger_personal_trip_count)/pre.passenger_personal_trip_count*100);el.passenger_personal_trip_delta=(d<0?"":"+")+d+"%"}else el.passenger_personal_trip_delta="N/A";if(!isNaN(el.distance)&&!isNaN(pre.distance)&&pre.distance>0){d=Math.round((el.distance-pre.distance)/pre.distance*100);el.mileage_delta=(d<0?"":"+")+d+"%"}else el.mileage_delta="N/A";if(!isNaN(el.speeding_per_100_miles)&&!isNaN(pre.speeding_per_100_miles)&&pre.speeding_per_100_miles>0){d=Math.round((el.speeding_per_100_miles-pre.speeding_per_100_miles)/pre.speeding_per_100_miles*100);el.speeding_delta=(d<0?"":"+")+d+"%"}else el.speeding_delta="N/A";if(!isNaN(el.distraction_per_100_miles)&&!isNaN(pre.distraction_per_100_miles)&&pre.distraction_per_100_miles>0){d=Math.round((el.distraction_per_100_miles-pre.distraction_per_100_miles)/pre.distraction_per_100_miles*100);el.distraction_delta=(d<0?"":"+")+d+"%"}else el.distraction_delta="N/A";if(!isNaN(el.trip_count)&&!isNaN(pre.trip_count)&&pre.trip_count>0){d=Math.round((el.trip_count-pre.trip_count)/pre.trip_count*100);el.trip_count_delta=(d<0?"":"+")+d+"%"}else el.trip_count_delta="N/A";if(!isNaN(el.seat_belt_off_per_100_miles)&&!isNaN(pre.seat_belt_off_per_100_miles)&&pre.seat_belt_off_per_100_miles>0){d=Math.round((el.seat_belt_off_per_100_miles-pre.seat_belt_off_per_100_miles)/pre.seat_belt_off_per_100_miles*100);el.seat_belt_off_delta=(d<0?"":"+")+d+"%"}else el.seat_belt_off_delta="N/A";if(!isNaN(el.reverse_count_per_100_miles)&&!isNaN(pre.reverse_count_per_100_miles)&&pre.reverse_count_per_100_miles>0){d=Math.round((el.reverse_count_per_100_miles-pre.reverse_count_per_100_miles)/pre.reverse_count_per_100_miles*100);el.reverse_delta=(d<0?"":"+")+d+"%"}else el.reverse_delta="N/A";if(!isNaN(el.breaking_per_100_miles)&&!isNaN(pre.breaking_per_100_miles)&&pre.breaking_per_100_miles>0){d=Math.round((el.reverse_count_per_100_miles-pre.reverse_count_per_100_miles)/pre.reverse_count_per_100_miles*100);el.breaking_delta=(d<0?"":"+")+d+"%"}else el.breaking_delta="N/A";if(el.tripStats)if(!isNaN(el.tripStats.mpg)&&!isNaN(pre.tripStats.mpg)&&pre.tripStats.mpg>0){d=Math.round((el.tripStats.mpg-pre.tripStats.mpg)/pre.tripStats.mpg*100);el.mpg_delta=(d<0?"":"+")+d+"%"}else el.mpg_delta="N/A"}}),thisPeriod},generateReportData:function(dataList,usersMap,groupsMap,companiesMap){if(!dataList)return[];var consolidated=[];return Array.isArray(dataList)?(dataList.map(function(el){el.weeklyStats?el.weeklyStats.forEach(function(e){var vm=createVm(el,usersMap,groupsMap,companiesMap);vm&&(vm=bindVm(e,vm),consolidated.push(vm))}):el.dailyStats?el.dailyStats.forEach(function(e){var vm=createVm(el,usersMap,groupsMap,companiesMap);vm&&(vm=bindVm(e,vm),consolidated.push(vm))}):el.monthlyStats&&el.monthlyStats.forEach(function(e){var vm=createVm(el,usersMap,groupsMap,companiesMap);vm&&(vm=bindVm(e,vm),consolidated.push(vm))})}),consolidated):[]}}}),angular.module("edriving.shared.filters",[]),angular.module("edriving.shared.filters").filter("duration2",[function(){"use strict";return function(seconds){var sec_num=parseInt(seconds,10),hours=Math.floor(sec_num/3600),minutes=Math.floor((sec_num-3600*hours)/60),time=(seconds=sec_num-3600*hours-60*minutes,"");return 0==hours&&0==minutes&&(time="0 min"),hours>0&&(time+=hours+" hr"),minutes>0&&(time+=" "+minutes+" min"),time}}]),angular.module("edriving.shared.filters").filter("humantime",function(moment){return function(dateString){return null==dateString?"":(angular.isNumber(dateString)?moment.unix(dateString/1e3):moment(dateString)).calendar(null,{sameDay:"[Today] h:mmA",nextDay:"[Tomorrow] h:mmA",nextWeek:"dddd h:mmA",lastDay:"[Yesterday] h:mmA",lastWeek:"[Last] dddd h:mmA",sameElse:"L h:mmA"})}}),angular.module("edriving.shared.filters").filter("duration",function(moment){return function(sec_num){if(!sec_num)return"";var hours=Math.floor(sec_num/3600),minutes=Math.floor((sec_num-3600*hours)/60),seconds=sec_num-3600*hours-60*minutes;return hours<10&&(hours="0"+hours),minutes<10&&(minutes="0"+minutes),seconds<10&&(seconds="0"+seconds),hours+":"+minutes}}),angular.module("edriving.shared.filters").filter("cdbAddress",function(){return function(address){if(!address)return"";var str="";return address.Line1&&(str+=address.Line1),address.Line2&&(str+=", "+address.Line2),address.City&&(str+=(""==str?"":", ")+address.City),address.State&&(str+=", "+address.State),address.ZipCode&&(str+=" "+address.ZipCode),address.Country&&(str+=", "+address.Country),str}}),(()=>{const materialColors=[{shades:{50:"#FFEBEE",100:"#FFCDD2",200:"#EF9A9A",300:"#E57373",400:"#EF5350",500:"#F44336",600:"#E53935",700:"#D32F2F",800:"#C62828",900:"#B71C1C"},name:"Red",whiteBreakpoint:400},{shades:{50:"#F3E5F5",100:"#E1BEE7",200:"#CE93D8",300:"#BA68C8",400:"#AB47BC",500:"#9C27B0",600:"#8E24AA",700:"#7B1FA2",800:"#6A1B9A",900:"#4A148C"},name:"Purple",whiteBreakpoint:300},{shades:{50:"#EDE7F6",100:"#D1C4E9",200:"#B39DDB",300:"#9575CD",400:"#7E57C2",500:"#673AB7",600:"#5E35B1",700:"#512DA8",800:"#4527A0",900:"#311B92"},name:"Deep Purple",whiteBreakpoint:300},{shades:{50:"#E8EAF6",100:"#C5CAE9",200:"#9FA8DA",300:"#7986CB",400:"#5C6BC0",500:"#3F51B5",600:"#3949AB",700:"#303F9F",800:"#283593",900:"#1A237E"},name:"Indigo",whiteBreakpoint:300},{shades:{50:"#E3F2FD",100:"#BBDEFB",200:"#90CAF9",300:"#64B5F6",400:"#42A5F5",500:"#2196F3",600:"#1E88E5",700:"#1976D2",800:"#1565C0",900:"#0D47A1"},name:"Blue",whiteBreakpoint:500},{shades:{50:"#E1F5FE",100:"#B3E5FC",200:"#81D4FA",300:"#4FC3F7",400:"#29B6F6",500:"#03A9F4",600:"#039BE5",700:"#0288D1",800:"#0277BD",900:"#01579B"},name:"Light Blue",whiteBreakpoint:600},{shades:{50:"#E0F2F1",100:"#B2DFDB",200:"#80CBC4",300:"#4DB6AC",400:"#26A69A",500:"#009688",600:"#00897B",700:"#00796B",800:"#00695C",900:"#004D40"},name:"Teal",whiteBreakpoint:500},{shades:{50:"#E8F5E9",100:"#C8E6C9",200:"#A5D6A7",300:"#81C784",400:"#66BB6A",500:"#4CAF50",600:"#43A047",700:"#388E3C",800:"#2E7D32",900:"#1B5E20"},name:"Green",whiteBreakpoint:600},{shades:{50:"#F1F8E9",100:"#DCEDC8",200:"#C5E1A5",300:"#AED581",400:"#9CCC65",500:"#8BC34A",600:"#7CB342",700:"#689F38",800:"#558B2F",900:"#33691E"},name:"Light Green",whiteBreakpoint:600},{shades:{50:"#FFFDE7",100:"#FFF9C4",200:"#FFF59D",300:"#FFF176",400:"#FFEE58",500:"#FFEB3B",600:"#FDD835",700:"#FBC02D",800:"#F9A825",900:"#F57F17"},name:"Yellow",whiteBreakpoint:9999},{shades:{50:"#FFF8E1",100:"#FFECB3",200:"#FFE082",300:"#FFD54F",400:"#FFCA28",500:"#FFC107",600:"#FFB300",700:"#FFA000",800:"#FF8F00",900:"#FF6F00"},name:"Amber",whiteBreakpoint:9999},{shades:{50:"#FFF3E0",100:"#FFE0B2",200:"#FFCC80",300:"#FFB74D",400:"#FFA726",500:"#FF9800",600:"#FB8C00",700:"#F57C00",800:"#EF6C00",900:"#E65100"},name:"Orange",whiteBreakpoint:800},{shades:{50:"#FBE9E7",100:"#FFCCBC",200:"#FFAB91",300:"#FF8A65",400:"#FF7043",500:"#FF5722",600:"#F4511E",700:"#E64A19",800:"#D84315",900:"#BF360C"},name:"Deep Orange",whiteBreakpoint:500},{shades:{50:"#EFEBE9",100:"#D7CCC8",200:"#BCAAA4",300:"#A1887F",400:"#8D6E63",500:"#795548",600:"#6D4C41",700:"#5D4037",800:"#4E342E",900:"#3E2723"},name:"Brown",whiteBreakpoint:300}],availableShades=["50","100","200","300","400","500","600","700","800","900"];getColorByHash=((text,shade="500")=>{if(!availableShades.includes(shade))throw new Error("Shade not available");const hashedText=(str=>{let hash=5381,i=str.length;for(;i;)hash=33*hash^str.charCodeAt(--i);return hash>>>0})(text),colorObj=materialColors[hashedText%materialColors.length];return{backgroundColor:colorObj.shades[shade],color:parseInt(shade,10)>=colorObj.whiteBreakpoint?"rgba(255, 255, 255, 1)":"rgba(0, 0, 0, 0.87)",materialColorName:colorObj.name}})})();class DspChartCtrl{constructor($rootScope,$timeout){this.ngOnInit=this.ngOnInit.bind(this),this.handleChartClick=this.handleChartClick.bind(this),this.$rootScope=$rootScope,$timeout(()=>this.ngOnInit())}ngOnInit(){const ctx=document.querySelector(`canvas#${this.id}`).getContext("2d");this.chart&&this.chart.destroy();let scales={};this.hideXLabels||(scales.xAxes=[{position:"top"}]),this.hideYLabels||(scales.yAxes=[{scaleLabel:{display:!0,labelString:this.yLabelText||"% of drivers"},ticks:{beginAtZero:!0,callback:value=>(this.noLabelsPercentage||(value+="%"),value)}}]),this.chart=new Chart(ctx,{type:this.type,options:{onClick:this.handleChartClick,legend:{position:"bottom"},tooltips:{callbacks:{label:(tooltipItem,data)=>{let label,value;return"pie"!==this.type?((label=data.datasets[tooltipItem.datasetIndex].label||"")&&(label+=": "),label+=Math.round(100*tooltipItem.yLabel)/100,this.noLabelsPercentage||(label+="%"),label):(value=data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index]||"",label=data.labels[tooltipItem.index]+": "+Math.round(100*value)/100,this.noLabelsPercentage||(label+="%"),label)}}},scales:scales,plugins:{datalabels:{color:"black",font:{weight:"bold"},textShadowBlur:2,textShadowColor:"white",formatter:value=>"0.00"===value?"":(value=Math.round(value),this.noLabelsPercentage||(value+="%"),value)}}}}),this.$rootScope.$on("DSP_CHART_UPDATE_DATA",(ev,{chartId:chartId,data:data})=>{if(!data)return;const{labels:labels,datasets:datasets}=data;if(chartId===this.id){this.chart.data.labels.length=0,this.chart.data.datasets.length=0;for(const label of labels)this.chart.data.labels.push(label);for(const dataset of datasets)this.chart.data.datasets.push(dataset);this.chart.update()}})}handleChartClick(event){if(this.disableDetailsPage)return;const element=this.chart.getElementAtEvent(event);if(!element.length)return;const[activePoint]=element,{_datasetIndex:_datasetIndex,_index:selectedBar}=activePoint,label=this.chart.data.labels[selectedBar],dataset=this.chart.data.datasets[_datasetIndex],dsp="pie"!==this.type?label:null,value="pie"!==this.type?dataset.label:label;this.$rootScope.$emit("DSP_CHART_OPEN_DETAILS_PAGE",{chartId:this.id,dsp:dsp,value:value})}}angular.module("edriving").component("dspChart",{restrict:"E",bindings:{id:"@",type:"@",chooseSingleDsp:"@",hideXLabels:"@",hideYLabels:"@",disableDetailsPage:"@",hideFilterStation:"@",hideFilterDsp:"@",hideFilterDriver:"@",yLabelText:"@",noLabelsPercentage:"@"},controller:DspChartCtrl,templateUrl:"views/components/DspChart/template.html"});class DspChartFiltersCtrl{constructor($rootScope,$scope,$timeout,$loading,$state,$stateParams,FicoScoreRating,FleetService,toastr){this.ngOnInit=this.ngOnInit.bind(this),this.onFiltersChange=this.onFiltersChange.bind(this),this.$rootScope=$rootScope,this.$scope=$scope,this.$timeout=$timeout,this.$loading=$loading,this.$state=$state,this.$stateParams=$stateParams,this.FicoScoreRating=FicoScoreRating,this.FleetService=FleetService,this.toastr=toastr,this.filters={interval:{title:"Interval"},dsp:{title:"DSP",options:[]},driver:{title:"Driver",options:[]},station:{title:"Station",options:[]},value:{title:"FICO Score",options:[{value:"RISKY",text:"Risky"},{value:"POOR",text:"Poor"},{value:"AVERAGE",text:"Average"},{value:"GOOD",text:"Good"},{value:"GREAT",text:"Great"}]}},this.selectedFilters={},this.datePicker={date:{startDate:null,endDate:null},options:{autoApply:!0,changeCallback:({picker:{startDate:startDate,endDate:endDate}})=>{this.selectedFilters.interval={startDate:startDate,endDate:endDate},this.onFiltersChange()},locale:{format:"DD MMMM YYYY"}}},$timeout(()=>this.ngOnInit())}async ngOnInit(){this.hideFilterStation&&delete this.filters.station,"true"===this.hideFilterDsp&&delete this.filters.dsp,"true"===this.hideFilterDriver?delete this.filters.driver:this.getDrivers(),this.$rootScope.$on("DSP_CHART_OPEN_DETAILS_PAGE",(ev,{chartId:chartId,dsp:dsp,value:value})=>{chartId===this.chartId&&(dsp=dsp?this.filters.dsp&&this.filters.dsp.options.find(option=>option.text===dsp).value:this.selectedFilters.dsp&&this.selectedFilters.dsp.length&&this.selectedFilters.dsp[0],this.$timeout(()=>{this.$state.go("^.analytics__details",{dsp:dsp,value:value,startDate:this.selectedFilters.interval&&this.selectedFilters.interval.startDate,endDate:this.selectedFilters.interval&&this.selectedFilters.interval.endDate})}))}),$(".selectpicker").selectpicker().on("changed.bs.select",ev=>{if(this.chartId!==ev.target.dataset.chartId)return;let values=$(ev.target).selectpicker("val");values="string"==typeof values?[values]:values,this.selectedFilters[ev.target.dataset.filterId]=values,this.onFiltersChange()});try{const companies=await this.getCompanies();this.hideFilterStation||await this.getStations(companies)}catch(err){return console.error(err),this.toastr.error(`${err.status} ${err.data&&err.data.message||err.message}`)}this.filters.dsp&&this.filters.dsp.options.length&&(this.chooseSingleDsp?$(`#${this.chartId}__filters-dsp`).selectpicker("val",this.filters.dsp.options[0].value):$(`#${this.chartId}__filters-dsp`).selectpicker("val",this.filters.dsp.options.slice(0,2).map(opt=>opt.value))),"fleet_amzl"===this.$stateParams.client&&this.onFiltersChange()}getCompanies(){return new Promise(async resolve=>{let companies;try{companies=await this.FicoScoreRating.getCompanies()}catch(err){return console.error(err),this.toastr.error(`${err.status} ${err.data&&err.data.message||err.message}`)}this.filters.dsp&&(this.filters.dsp.options=companies.map(dsp=>({value:dsp.id.toString(),text:dsp.name}))),this.$timeout(()=>{$(".selectpicker").selectpicker("refresh"),resolve(companies)})})}getStations(companies){return new Promise(async resolve=>{let groups;try{groups=await this.FicoScoreRating.getStations(companies)}catch(err){return console.error(err),this.toastr.error(`${err.status} ${err.data&&err.data.message||err.message}`)}this.filters.station.options=groups.map(station=>({value:station.id.toString(),text:station.name})),this.$timeout(()=>{$(".selectpicker").selectpicker("refresh"),resolve()})})}async getDrivers(){let drivers;try{({data:drivers}=await this.FleetService.getUsers(window.sessionStorage.companyId,!1,!0))}catch(err){return console.error(err),this.toastr.error(`${err.status} ${err.data&&err.data.message||err.message}`)}this.filters.driver.options=drivers.filter(driver=>driver.user&&driver.user.FirstName).map(driver=>({value:driver.id.toString(),text:driver.user&&`${driver.user.FirstName} ${driver.user.LastName||""}`})),this.$timeout(()=>{$(".selectpicker").selectpicker("refresh")})}async onFiltersChange(){try{this.$loading.start("loading_report");const data=await this.FicoScoreRating.getChartDataByFilters(this.chartId,this.selectedFilters);this.$rootScope.$emit("DSP_CHART_UPDATE_DATA",{chartId:this.chartId,data:data}),this.$loading.finish("loading_report")}catch(err){console.error(err),this.toastr.error(err.message)}}}angular.module("edriving").component("dspChartFilters",{restrict:"E",bindings:{chartId:"@",chartType:"@",chooseSingleDsp:"@",hideFilterStation:"@",hideFilterDsp:"@",hideFilterDriver:"@"},controller:DspChartFiltersCtrl,templateUrl:"views/components/DspChartFilters/template.html"});